(self.webpackChunkreact_map_components_maplibre_lab=self.webpackChunkreact_map_components_maplibre_lab||[]).push([[674],{48055:(t,e,n)=>{"use strict";n.d(e,{T:()=>o});let r=1,i=1;class o{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(t){const{delay:e=0,duration:n=Number.POSITIVE_INFINITY,rate:i=1,repeat:o=1}=t,s=r++,a={time:0,delay:e,duration:n,rate:i,repeat:o};return this._setChannelTime(a,this.time),this.channels.set(s,a),s}removeChannel(t){this.channels.delete(t);for(const[e,n]of this.animations)n.channel===t&&this.detachAnimation(e)}isFinished(t){const e=this.channels.get(t);return void 0!==e&&this.time>=e.delay+e.duration*e.repeat}getTime(t){if(void 0===t)return this.time;const e=this.channels.get(t);return void 0===e?-1:e.time}setTime(t){this.time=Math.max(0,t);const e=this.channels.values();for(const t of e)this._setChannelTime(t,this.time);const n=this.animations.values();for(const t of n){const{animation:e,channel:n}=t;e.setTime(this.getTime(n))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(t,e){const n=i++;return this.animations.set(n,{animation:t,channel:e}),t.setTime(this.getTime(e)),n}detachAnimation(t){this.animations.delete(t)}update(t){this.playing&&(-1===this.lastEngineTime&&(this.lastEngineTime=t),this.setTime(this.time+(t-this.lastEngineTime)),this.lastEngineTime=t)}_setChannelTime(t,e){const n=e-t.delay;n>=t.duration*t.repeat?t.time=t.duration*t.rate:(t.time=Math.max(0,n)%t.duration,t.time*=t.rate)}}},453982:(t,e,n)=>{"use strict";n.d(e,{Z:()=>s});var r=n(574538),i=n(822525);const o={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class s{static get DRAW_MODE(){return o}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{id:e=(0,r.hQ)("geometry"),drawMode:n=o.TRIANGLES,attributes:i={},indices:s=null,vertexCount:a=null}=t;this.id=e,this.drawMode=0|n,this.attributes={},this.userData={},this._setAttributes(i,s),this.vertexCount=a||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(t){return"Geometry ".concat(this.id," attribute ").concat(t)}_setAttributes(t,e){e&&(this.indices=ArrayBuffer.isView(e)?{value:e,size:1}:e);for(const e in t){let n=t[e];n=ArrayBuffer.isView(n)?{value:n}:n,(0,i.h)(ArrayBuffer.isView(n.value),"".concat(this._print(e),": must be typed array or object with value as typed array")),"POSITION"!==e&&"positions"!==e||n.size||(n.size=3),"indices"===e?((0,i.h)(!this.indices),this.indices=n):this.attributes[e]=n}return this.indices&&void 0!==this.indices.isIndexed&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(t,e){if(e)return e.value.length;let n=1/0;for(const e in t){const r=t[e],{value:i,size:o,constant:s}=r;!s&&i&&o>=1&&(n=Math.min(n,i.length/o))}return(0,i.h)(Number.isFinite(n)),n}}},829902:(t,e,n)=>{"use strict";n.d(e,{Z:()=>f});var r=n(739450),i=n(149835),o=n(822525),s=n(787577),a=n(844211),c=n(106948);class u extends s.Z{get[Symbol.toStringTag](){return"Query"}static isSupported(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const n=(0,r.D0)(t),i=(0,a.ag)(t,c.h.TIMER_QUERY);let s=n||i;for(const t of e)switch(t){case"queries":s=s&&n;break;case"timers":s=s&&i;break;default:(0,o.h)(!1)}return s}constructor(t){super(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(35007)}beginOcclusionQuery(){let{conservative:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.begin(t?36202:35887)}beginTransformFeedbackQuery(){return this.begin(35976)}begin(t){return this._queryPending||(this.target=t,this.gl2.beginQuery(this.target,this.handle)),this}end(){return this._queryPending||this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this}isResultAvailable(){if(!this._queryPending)return!1;const t=this.gl2.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.gl2.getParameter(36795)}getResult(){return this.gl2.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let e=0;return this._pollingPromise=new Promise(((n,r)=>{const i=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):e++>t?(r("Timed out"),this._pollingPromise=null):requestAnimationFrame(i)};requestAnimationFrame(i)})),this._pollingPromise}_createHandle(){return u.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}var l=n(53849);const h=(0,n(693370).Z)()&&"undefined"!=typeof document;let d=0;class f{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{onCreateContext:e=(t=>(0,r.s9)(t)),onAddHTML:n=null,onInitialize:o=(()=>{}),onRender:s=(()=>{}),onFinalize:a=(()=>{}),onError:c,gl:u=null,glOptions:l={},debug:h=!1,createFramebuffer:f=!1,autoResizeViewport:g=!0,autoResizeDrawingBuffer:p=!0,stats:m=i.lR.get("animation-loop-".concat(d++))}=t;let{useDevicePixels:b=!0}=t;"useDevicePixelRatio"in t&&(r.cM.deprecated("useDevicePixelRatio","useDevicePixels")(),b=t.useDevicePixelRatio),this.props={onCreateContext:e,onAddHTML:n,onInitialize:o,onRender:s,onFinalize:a,onError:c,gl:u,glOptions:l,debug:h,createFramebuffer:f},this.gl=u,this.needsRedraw=null,this.timeline=null,this.stats=m,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:g,autoResizeDrawingBuffer:p,useDevicePixels:b}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(t){return(0,o.h)("string"==typeof t),this.needsRedraw=this.needsRedraw||t,this}setProps(t){return"autoResizeViewport"in t&&(this.autoResizeViewport=t.autoResizeViewport),"autoResizeDrawingBuffer"in t&&(this.autoResizeDrawingBuffer=t.autoResizeDrawingBuffer),"useDevicePixels"in t&&(this.useDevicePixels=t.useDevicePixels),this}start(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._running)return this;this._running=!0;const e=this._getPageLoadPromise().then((()=>!this._running||this._initialized?null:(this._createWebGLContext(t),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=u.isSupported(this.gl,["timers"])?new u(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps)))).then((t=>{this._running&&(this._addCallbackData(t||{}),!1!==t&&this._startLoop())}));return this.props.onError&&e.catch(this.props.onError),this}redraw(){return this.isContextLost()||(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers()),this}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(t){return this.timeline=t,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise((t=>{this._resolveNextFrame=t}))),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=document.getElementById(t);return n?Number(n.value):e}setViewParameters(){return r.cM.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const t=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(t))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(t)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=h?new Promise(((t,e)=>{h&&"complete"===document.readyState?t(document):window.addEventListener("load",(()=>{t(document)}))})):Promise.resolve({})),this._pageLoadPromise}_setDisplay(t){this.display&&(this.display.delete(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}_cancelAnimationFrame(t){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(t):(e=t,"undefined"!=typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e));var e}_requestAnimationFrame(t){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(t):(e=t,"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60));var e}_renderFrame(){this.display?this.display._renderFrame(...arguments):this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:t,height:e,aspect:n}=this._getSizeAndAspect();t===this.animationProps.width&&e===this.animationProps.height||this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=t,this.animationProps.height=e,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(t){"object"==typeof t&&null!==t&&(this.animationProps=Object.assign({},this.animationProps,t))}_createWebGLContext(t){if(this.offScreen=t.canvas&&"undefined"!=typeof OffscreenCanvas&&t.canvas instanceof OffscreenCanvas,t=Object.assign({},t,this.props.glOptions),this.gl=this.props.gl?(0,r.yW)(this.props.gl,t):this.onCreateContext(t),!(0,r.UF)(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");(0,r.kL)(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";const e=document.createElement("div");e.style.position="absolute",e.style.left="10px",e.style.bottom="10px",e.style.width="300px",e.style.background="white",t.appendChild(this.gl.canvas),t.appendChild(e);const n=this.props.onAddHTML(e);n&&(e.innerHTML=n)}}_getSizeAndAspect(){const t=this.gl.drawingBufferWidth,e=this.gl.drawingBufferHeight;let n=1;const{canvas:r}=this.gl;return r&&r.clientHeight?n=r.clientWidth/r.clientHeight:t>0&&e>0&&(n=t/e),{width:t,height:e,aspect:n}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&(0,r.aQ)(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new l.Z(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:t}=this.gl;t&&(t.addEventListener("mousemove",this._onMousemove),t.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(t){this.animationProps._mousePosition=[t.offsetX,t.offsetY]}_onMouseleave(t){this.animationProps._mousePosition=null}}},339769:(t,e,n)=>{"use strict";n.d(e,{Z:()=>P});var r=n(739450),i=n(600358),o=n(574538),s=n(822525),a=n(526047),c=n(807944),u=n(714072),l=n(53478),h=n(787577);let d=null;var f=n(203485);class g extends h.Z{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(t){return!(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).constantAttributeZero||(0,r.D0)(t)||"Chrome"===(0,f.Z)()}static getDefaultArray(t){return t.luma=t.luma||{},t.luma.defaultVertexArray||(t.luma.defaultVertexArray=new g(t,{handle:null,isDefaultArray:!0})),t.luma.defaultVertexArray}static getMaxAttributes(t){return g.MAX_ATTRIBUTES=g.MAX_ATTRIBUTES||t.getParameter(34921),g.MAX_ATTRIBUTES}static setConstant(t,e,n){switch(n.constructor){case Float32Array:g._setConstantFloatArray(t,e,n);break;case Int32Array:g._setConstantIntArray(t,e,n);break;case Uint32Array:g._setConstantUintArray(t,e,n);break;default:(0,s.h)(!1)}}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=e.id||e.program&&e.program.id;super(t,Object.assign({},e,{id:n})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=e.isDefaultArray||!1,this.gl2=t,this.initialize(e),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return g.getMaxAttributes(this.gl)}initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.setProps(t)}setProps(t){return this}setElementBuffer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return(0,s.h)(!t||34963===t.target,"elements must be GL.ELEMENT_ARRAY_BUFFER"),this.bind((()=>{this.gl.bindBuffer(34963,t?t.handle:null)})),this}setBuffer(t,e,n){if(34963===e.target)return this.setElementBuffer(e,n);const{size:i,type:o,stride:a,offset:c,normalized:u,integer:l,divisor:h}=n,{gl:d,gl2:f}=this;return t=Number(t),this.bind((()=>{d.bindBuffer(34962,e.handle),l?((0,s.h)((0,r.D0)(d)),f.vertexAttribIPointer(t,i,o,a,c)):d.vertexAttribPointer(t,i,o,u,a,c),d.enableVertexAttribArray(t),f.vertexAttribDivisor(t,h||0)})),this}enable(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return!e&&0===t&&!g.isSupported(this.gl,{constantAttributeZero:!0})||(t=Number(t),this.bind((()=>e?this.gl.enableVertexAttribArray(t):this.gl.disableVertexAttribArray(t)))),this}getConstantBuffer(t,e){const n=this._normalizeConstantArrayValue(e),r=n.byteLength*t,i=n.length*t;let o=!this.buffer;if(this.buffer=this.buffer||new l.Z(this.gl,r),o=o||this.buffer.reallocate(r),o=o||!this._compareConstantArrayValues(n,this.bufferValue),o){const t=function(t,e){var n;return new t((n=t.BYTES_PER_ELEMENT*e,(!d||d.byteLength<n)&&(d=new ArrayBuffer(n)),d),0,e)}(e.constructor,i);!function(t){let{target:e,source:n,start:r=0,count:i=1}=t;const o=n.length,s=i*o;let a=0;for(let t=r;a<o;a++)e[t++]=n[a];for(;a<s;)a<s-a?(e.copyWithin(r+a,r,r+a),a*=2):(e.copyWithin(r+a,r,r+s-a),a=s)}({target:t,source:n,start:0,count:i}),this.buffer.subData(t),this.bufferValue=e}return this.buffer}_normalizeConstantArrayValue(t){return Array.isArray(t)?new Float32Array(t):t}_compareConstantArrayValues(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}static _setConstantFloatArray(t,e,n){switch(n.length){case 1:t.vertexAttrib1fv(e,n);break;case 2:t.vertexAttrib2fv(e,n);break;case 3:t.vertexAttrib3fv(e,n);break;case 4:t.vertexAttrib4fv(e,n);break;default:(0,s.h)(!1)}}static _setConstantIntArray(t,e,n){switch((0,s.h)((0,r.D0)(t)),n.length){case 1:t.vertexAttribI1iv(e,n);break;case 2:t.vertexAttribI2iv(e,n);break;case 3:t.vertexAttribI3iv(e,n);break;case 4:t.vertexAttribI4iv(e,n);break;default:(0,s.h)(!1)}}static _setConstantUintArray(t,e,n){switch((0,s.h)((0,r.D0)(t)),n.length){case 1:t.vertexAttribI1uiv(e,n);break;case 2:t.vertexAttribI2uiv(e,n);break;case 3:t.vertexAttribI3uiv(e,n);break;case 4:t.vertexAttribI4uiv(e,n);break;default:(0,s.h)(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(t){return this.gl2.deleteVertexArray(t),[this.elements]}_bindHandle(t){this.gl2.bindVertexArray(t)}_getParameter(t,e){let{location:n}=e;return(0,s.h)(Number.isFinite(n)),this.bind((()=>34373===t?this.gl.getVertexAttribOffset(n,t):this.gl.getVertexAttrib(n,t)))}}var p=n(737469);const m=/^(.+)__LOCATION_([0-9]+)$/,b=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class _{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=e.id||e.program&&e.program.id;this.id=n,this.gl=t,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new g(t),(0,p.F)(this,"VertexArray","v6.0",b),this.initialize(e),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(t)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:t}=this.vertexArrayObject;return this.values=new Array(t).fill(null),this.accessors=new Array(t).fill(null),this.unused={},this.drawParams=null,this}setProps(t){return"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"attributes"in t&&this.setAttributes(t.attributes),"elements"in t&&this.setElementBuffer(t.elements),"bindOnUse"in t&&(t=t.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(t){return Object.assign(this.attributes,t),this.vertexArrayObject.bind((()=>{for(const e in t){const n=t[e];this._setAttribute(e,n)}this.gl.bindBuffer(34962,null)})),this}setElementBuffer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.elements=t,this.elementsAccessor=e,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(t,e),this}setBuffer(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(34963===e.target)return this.setElementBuffer(e,n);const{location:r,accessor:i}=this._resolveLocationAndAccessor(t,e,e.accessor,n);return r>=0&&(this.values[r]=e,this.accessors[r]=i,this.clearDrawParams(),this.vertexArrayObject.setBuffer(r,e,i)),this}setConstant(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{location:r,accessor:i}=this._resolveLocationAndAccessor(t,e,Object.assign({size:e.length},n));return r>=0&&(e=this.vertexArrayObject._normalizeConstantArrayValue(e),this.values[r]=e,this.accessors[r]=i,this.clearDrawParams(),this.vertexArrayObject.enable(r,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind((()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new l.Z(this.gl,{accessor:{size:4}});for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)this.values[t]instanceof l.Z&&(this.gl.disableVertexAttribArray(t),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(t,1,5126,!1,0,0))})),this}bindBuffers(){return this.vertexArrayObject.bind((()=>{this.elements&&this.setElementBuffer(this.elements);for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++){const e=this.values[t];e instanceof l.Z&&this.setBuffer(t,e)}})),this}bindForDraw(t,e,n){let r;return this.vertexArrayObject.bind((()=>{this._setConstantAttributes(t,e),r=n()})),r}_resolveLocationAndAccessor(t,e,n,i){const o={location:-1,accessor:null},{location:a,name:c}=this._getAttributeIndex(t);if(!Number.isFinite(a)||a<0)return this.unused[t]=e,r.cM.once(3,(()=>"unused value ".concat(t," in ").concat(this.id)))(),o;const l=this._getAttributeInfo(c||a);if(!l)return o;const h=this.accessors[a]||{},d=u.Z.resolve(l.accessor,h,n,i),{size:f,type:g}=d;return(0,s.h)(Number.isFinite(f)&&Number.isFinite(g)),{location:a,accessor:d}}_getAttributeInfo(t){return this.configuration&&this.configuration.getAttributeInfo(t)}_getAttributeIndex(t){const e=Number(t);if(Number.isFinite(e))return{location:e};const n=m.exec(t),r=n?n[1]:t,i=n?Number(n[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(r)+i,name:r}:{location:-1}}_setAttribute(t,e){if(e instanceof l.Z)this.setBuffer(t,e);else if(Array.isArray(e)&&e.length&&e[0]instanceof l.Z){const n=e[0],r=e[1];this.setBuffer(t,n,r)}else if(ArrayBuffer.isView(e)||Array.isArray(e)){const n=e;this.setConstant(t,n)}else{if(!(e.buffer instanceof l.Z))throw new Error("VertexArray: attributes must be Buffers or constants (i.e. typed array)");{const n=e;this.setBuffer(t,n.buffer,n)}}}_setConstantAttributes(t,e){const n=Math.max(0|t,0|e);let r=this.values[0];ArrayBuffer.isView(r)&&this._setConstantAttributeZero(r,n);for(let t=1;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)r=this.values[t],ArrayBuffer.isView(r)&&this._setConstantAttribute(t,r)}_setConstantAttributeZero(t,e){if(g.isSupported(this.gl,{constantAttributeZero:!0}))return void this._setConstantAttribute(0,t);const n=this.vertexArrayObject.getConstantBuffer(e,t);this.vertexArrayObject.setBuffer(0,n,this.accessors[0])}_setConstantAttribute(t,e){g.setConstant(this.gl,t,e)}_updateDrawParams(){const t={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this._updateDrawParamsForLocation(t,e);return this.elements&&(t.elementCount=this.elements.getElementCount(this.elements.accessor),t.isIndexed=!0,t.indexType=this.elementsAccessor.type||this.elements.accessor.type,t.indexOffset=this.elementsAccessor.offset||0),t.indexCount===1/0&&(t.indexCount=0),t.vertexCount===1/0&&(t.vertexCount=0),t.instanceCount===1/0&&(t.instanceCount=0),t}_updateDrawParamsForLocation(t,e){const n=this.values[e],r=this.accessors[e];if(!n)return;const{divisor:i}=r,o=i>0;if(t.isInstanced=t.isInstanced||o,n instanceof l.Z){const e=n;if(o){const n=e.getVertexCount(r);t.instanceCount=Math.min(t.instanceCount,n)}else{const n=e.getVertexCount(r);t.vertexCount=Math.min(t.vertexCount,n)}}}setElements(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r.cM.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(t,e)}}var v=n(151053),y=n(779579),A=n(738522);function x(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{isInteger:n=!1}=e;if(Array.isArray(t)||ArrayBuffer.isView(t))return function(t,e){const{maxElts:n=16,size:r=1}=e;let i="[";for(let o=0;o<t.length&&o<n;++o)o>0&&(i+=",".concat(o%r==0?" ":"")),i+=x(t[o],e);const o=t.length>n?"...":"]";return"".concat(i).concat(o)}(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<1e-16)return n?"0":"0.";if(n)return t.toFixed(0);if(Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);const r=t.toPrecision(2);return r.indexOf(".0")===r.length-2?r.slice(0,-1):r}function E(t,e,n,r){const{gl:i}=t;if(!e)return{[r]:"null","Format ":"N/A"};let o,s,a,c="NOT PROVIDED",u=1,h=0,d=0;if(n&&(c=n.type,u=n.size,c=String(c).replace("Array",""),o=-1!==c.indexOf("nt")),e instanceof l.Z){const t=e,{data:l,changed:f}=t.getDebugData();let g;if(s=f?"*":"",a=l,d=t.byteLength,h=d/l.BYTES_PER_ELEMENT/u,n){const t=n.divisor>0;g="".concat(t?"I ":"P "," ").concat(h," (x").concat(u,"=").concat(d," bytes ").concat((0,y.km)(i,c),")")}else o=!0,g="".concat(d," bytes");return{[r]:"".concat(s).concat(x(a,{size:u,isInteger:o})),"Format ":g}}return a=e,u=e.length,c=String(e.constructor.name).replace("Array",""),o=-1!==c.indexOf("nt"),{[r]:"".concat(x(a,{size:u,isInteger:o})," (constant)"),"Format ":"".concat(u,"x").concat(c," (constant)")}}function T(t,e){const{type:n,size:r}=e,i=(0,A.jG)(n,r);return i?"".concat(t," (").concat(i.name,")"):t}function w(t){let{header:e="Uniforms",program:n,uniforms:r,undefinedOnly:i=!1}=t;(0,s.h)(n);const o=".*Matrix",a=n._uniformSetters,c={},u=Object.keys(a).sort();let l=0;for(const t of u)t.match(".*_.*")||t.match(o)||C({table:c,header:e,uniforms:r,uniformName:t,undefinedOnly:i})&&l++;for(const t of u)t.match(o)&&C({table:c,header:e,uniforms:r,uniformName:t,undefinedOnly:i})&&l++;for(const t of u)c[t]||C({table:c,header:e,uniforms:r,uniformName:t,undefinedOnly:i})&&l++;let h=0;const d={};if(!i)for(const t in r){const n=r[t];c[t]||(h++,d[t]={Type:"NOT USED: ".concat(n),[e]:x(n)})}return{table:c,count:l,unusedTable:d,unusedCount:h}}function C(t){let{table:e,header:n,uniforms:r,uniformName:i,undefinedOnly:o}=t;const s=r[i],a=function(t){return null!=t}(s);return!(o&&a||(e[i]={[n]:a?x(s):"N/A","Uniform Type":a?s:"NOT PROVIDED"},0))}function S(t){const{type:e,size:n}=t.accessor,r=(0,A.jG)(e,n);return r?"".concat(r.name," ").concat(t.name):t.name}const L={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function O(t,e){const{attributeMap:n=L}=e||{};return n&&n[t]||t}function I(t,e){let n;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors"}switch(n){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2}(0,s.h)(Number.isFinite(e.size),"attribute ".concat(t," needs size"))}const M=()=>{},F={};class P{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{id:n=(0,o.hQ)("model")}=e;(0,s.h)((0,r.UF)(t)),this.id=n,this.gl=t,this.id=e.id||(0,o.hQ)("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(e)}initialize(t){this.props={},this.programManager=t.programManager||i.Z.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:e=null,vs:n,fs:r,modules:o,defines:a,inject:c,varyings:u,bufferMode:l,transpileToGLSL100:h}=t;this.programProps={program:e,vs:n,fs:r,modules:o,defines:a,inject:c,varyings:u,bufferMode:l,transpileToGLSL100:h},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(t.moduleSettings))),this.drawMode=void 0!==t.drawMode?t.drawMode:4,this.vertexCount=t.vertexCount||0,this.geometryBuffers={},this.isInstanced=t.isInstanced||t.instanced||t.instanceCount>0,this._setModelProps(t),this.geometry={},(0,s.h)(void 0!==this.drawMode&&Number.isFinite(this.vertexCount),"Model needs drawMode and vertexCount")}setProps(t){this._setModelProps(t)}delete(){for(const t in this._attributes)this._attributes[t]!==this.attributes[t]&&this._attributes[t].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(t){const{program:e,vs:n,fs:r,modules:i,defines:o,inject:s,varyings:a,bufferMode:c,transpileToGLSL100:u}=t;this.programProps={program:e,vs:n,fs:r,modules:i,defines:o,inject:s,varyings:a,bufferMode:c,transpileToGLSL100:u},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(t){return this.drawMode=t,this}setVertexCount(t){return(0,s.h)(Number.isFinite(t)),this.vertexCount=t,this}setInstanceCount(t){return(0,s.h)(Number.isFinite(t)),this.instanceCount=t,this}setGeometry(t){return this.drawMode=t.drawMode,this.vertexCount=t.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=function(t,e,n){const r={};let i=e.indices;for(const n in e.attributes){const o=e.attributes[n],s=O(n,undefined);if("indices"===n)i=o;else if(o.constant)r[s]=o.value;else{const e=o.value,i={...o};delete i.value,r[s]=[new l.Z(t,e),i],I(n,i)}}if(i){const e=i.value||i;(0,s.h)(e instanceof Uint16Array||e instanceof Uint32Array,'attribute array for "indices" must be of integer type');const n={size:1,isIndexed:void 0===i.isIndexed||i.isIndexed};r.indices=[new l.Z(t,{data:e,target:34963}),n]}return r}(this.gl,t),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if((0,o.nK)(t))return this;const e={};for(const n in t){const r=t[n];e[n]=r.getValue?r.getValue():r}return this.vertexArray.setAttributes(e),this}setUniforms(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign(this.uniforms,t),this}getModuleUniforms(t){this._checkProgram();const e=this.programManager.getUniforms(this.program);return e?e(t):{}}updateModuleSettings(t){const e=this.getModuleUniforms(t||{});return this.setUniforms(e)}clear(t){return(0,a.Z)(this.program.gl,t),this}draw(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._checkProgram();const{moduleSettings:e=null,framebuffer:n,uniforms:i={},attributes:o={},transformFeedback:s=this.transformFeedback,parameters:a={},vertexArray:c=this.vertexArray}=t;let u;this.setAttributes(o),this.updateModuleSettings(e),this.setUniforms(i),r.cM.priority>=2&&(u=this._logDrawCallStart(2));const l=this.vertexArray.getDrawParams(),{isIndexed:h=l.isIndexed,indexType:d=l.indexType,indexOffset:f=l.indexOffset,vertexArrayInstanced:g=l.isInstanced}=this.props;g&&!this.isInstanced&&r.cM.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:p,instanceCount:m}=this,{onBeforeRender:b=M,onAfterRender:_=M}=this.props;b(),this.program.setUniforms(this.uniforms);const v=this.program.draw(Object.assign(F,t,{logPriority:u,uniforms:null,framebuffer:n,parameters:a,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:c,transformFeedback:s,isIndexed:h,indexType:d,isInstanced:p,instanceCount:m,offset:h?f:0}));return _(),r.cM.priority>=2&&this._logDrawCallEnd(u,c,n),v}transform(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{discard:e=!0,feedbackBuffers:n,unbindModels:r=[]}=t;let{parameters:i}=t;n&&this._setFeedbackBuffers(n),e&&(i=Object.assign({},i,{35977:e})),r.forEach((t=>t.vertexArray.unbindBuffers()));try{this.draw(Object.assign({},t,{parameters:i}))}finally{r.forEach((t=>t.vertexArray.bindBuffers()))}return this}render(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r.cM.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(t).draw()}_setModelProps(t){Object.assign(this.props,t),"uniforms"in t&&this.setUniforms(t.uniforms),"pickable"in t&&(this.pickable=t.pickable),"instanceCount"in t&&(this.instanceCount=t.instanceCount),"geometry"in t&&this.setGeometry(t.geometry),"attributes"in t&&this.setAttributes(t.attributes),"_feedbackBuffers"in t&&this._setFeedbackBuffers(t._feedbackBuffers)}_checkProgram(){if(!this._programDirty&&this.programManager.stateHash===this._programManagerState)return;let{program:t}=this.programProps;if(t)this._managedProgram=!1;else{const{vs:e,fs:n,modules:r,inject:i,defines:o,varyings:s,bufferMode:a,transpileToGLSL100:c}=this.programProps;t=this.programManager.get({vs:e,fs:n,modules:r,inject:i,defines:o,varyings:s,bufferMode:a,transpileToGLSL100:c}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}(0,s.h)(t instanceof c.Z,"Model needs a program"),this._programDirty=!1,t!==this.program&&(this.program=t,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new _(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const t in this.geometryBuffers){const e=this.geometryBuffers[t][0]||this.geometryBuffers[t];e instanceof l.Z&&e.delete()}}_setAnimationProps(t){this.animated&&(0,s.h)(t,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if((0,o.nK)(t))return this;const{gl:e}=this.program;return this.transformFeedback=this.transformFeedback||new v.Z(e,{program:this.program}),this.transformFeedback.setBuffers(t),this}_logDrawCallStart(t){const e=t>3?0:1e4;if(!(Date.now()-this.lastLogTime<e))return this.lastLogTime=Date.now(),r.cM.group(2,">>> DRAWING MODEL ".concat(this.id),{collapsed:r.cM.level<=2})(),t}_logDrawCallEnd(t,e,n,i){if(void 0===t)return;const o=function(t){let{vertexArray:e,header:n="Attributes"}=t;if(!e.configuration)return{};const r={};e.elements&&(r.ELEMENT_ARRAY_BUFFER=E(e,e.elements,null,n));const i=e.values;for(const t in i){const o=e._getAttributeInfo(t);if(o){let s="".concat(t,": ").concat(o.name);const a=e.accessors[o.location];a&&(s="".concat(t,": ").concat(T(o.name,a))),r[s]=E(e,i[t],a,n)}}return r}({vertexArray:e,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:s,unusedTable:a,unusedCount:c}=w({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,n)}),{table:u,count:l}=w({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,n),undefinedOnly:!0});l>0&&r.cM.log("MISSING UNIFORMS",Object.keys(u))(),c>0&&r.cM.log("UNUSED UNIFORMS",Object.keys(a))();const h=function(t){const e={},n="Accessors for ".concat(t.id);for(const r of t.attributeInfos)if(r){const t=S(r);e["in ".concat(t)]={[n]:JSON.stringify(r.accessor)}}for(const r of t.varyingInfos)if(r){const t=S(r);e["out ".concat(t)]={[n]:JSON.stringify(r.accessor)}}return e}(this.vertexArray.configuration);r.cM.table(t,o)(),r.cM.table(t,s)(),r.cM.table(t+1,h)(),i&&i.log({logLevel:2,message:"Rendered to ".concat(i.id)}),r.cM.groupEnd(2)()}}},600358:(t,e,n)=>{"use strict";n.d(e,{Z:()=>k});var r=n(475682),i=n(229047);const o={number:{validate:(t,e)=>Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)},array:{validate:(t,e)=>Array.isArray(t)||ArrayBuffer.isView(t)}};function s(t){let e=a(t);return"object"===e?t?"type"in t?Object.assign({},t,o[t.type]):"value"in t?(e=a(t.value),Object.assign({type:e},t,o[e])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:e,value:t},o[e])}function a(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}class c{constructor(t){let{name:e,vs:n,fs:r,dependencies:o=[],uniforms:a,getUniforms:c,deprecations:u=[],defines:l={},inject:h={},vertexShader:d,fragmentShader:f}=t;(0,i.Z)("string"==typeof e),this.name=e,this.vs=n||d,this.fs=r||f,this.getModuleUniforms=c,this.dependencies=o,this.deprecations=this._parseDeprecationDefinitions(u),this.defines=l,this.injections=function(t){const e={vs:{},fs:{}};for(const n in t){let r=t[n];"string"==typeof r&&(r={order:0,injection:r}),e[n.slice(0,2)][n]=r}return e}(h),a&&(this.uniforms=function(t){const e={};for(const n in t){const r=s(t[n]);e[n]=r}return e}(a))}getModuleSource(t){let e;switch(t){case"vs":e=this.vs||"";break;case"fs":e=this.fs||"";break;default:(0,i.Z)(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),"\n").concat(e,"// END MODULE_").concat(this.name,"\n\n")}getUniforms(t,e){return this.getModuleUniforms?this.getModuleUniforms(t,e):this.uniforms?this._defaultGetUniforms(t):{}}getDefines(){return this.defines}checkDeprecations(t,e){this.deprecations.forEach((n=>{n.regex.test(t)&&(n.deprecated?e.deprecated(n.old,n.new)():e.removed(n.old,n.new)())}))}_parseDeprecationDefinitions(t){return t.forEach((t=>{"function"===t.type?t.regex=new RegExp("\\b".concat(t.old,"\\(")):t.regex=new RegExp("".concat(t.type," ").concat(t.old,";"))})),t}_defaultGetUniforms(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e={},n=this.uniforms;for(const r in n){const o=n[r];r in t&&!o.private?(o.validate&&(0,i.Z)(o.validate(t[r],o),"".concat(this.name,": invalid ").concat(r)),e[r]=t[r]):e[r]=o.value}return e}}function u(t){return function(t){const e={},n={};return l({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort(((t,e)=>n[e]-n[t])).map((t=>e[t]))}(h(t))}function l(t){let{modules:e,level:n,moduleMap:r,moduleDepth:i}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const t of e)r[t.name]=t,(void 0===i[t.name]||i[t.name]<n)&&(i[t.name]=n);for(const t of e)t.dependencies&&l({modules:t.dependencies,level:n+1,moduleMap:r,moduleDepth:i})}function h(t,e){return t.map((t=>(t instanceof c||((0,i.Z)("string"!=typeof t,"Shader module use by name is deprecated. Import shader module '".concat(t,"' and use it directly.")),(0,i.Z)(t.name,"shader module has no name"),(t=new c(t)).dependencies=h(t.dependencies)),t)))}const d=7936,f=7937,g=7938,p=35724,m={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},b={};Object.keys(m).forEach((t=>{b[t]=t}));const _={};function v(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=m[e];if((0,i.Z)(r,e),!function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e="undefined"!=typeof window&&window.navigator||{},n=t.userAgent||e.userAgent||"",r=-1!==n.indexOf("MSIE "),i=-1!==n.indexOf("Trident/");return r||i}(n))return!0;if(e in _)return _[e];const o=r[0],s=n.behavior||"enable",a="#extension GL_".concat(o," : ").concat(s,"\nvoid main(void) {}"),c=t.createShader(35633);t.shaderSource(c,a),t.compileShader(c);const u=t.getShaderParameter(c,35713);return t.deleteShader(c),_[e]=u,u}function y(t,e){return(e=Array.isArray(e)?e:[e]).every((e=>function(t,e){const n=m[e];(0,i.Z)(n,e);const r=function(t){return"undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||Boolean(t&&2===t._version)}(t)&&n[1]||n[0],o="string"==typeof r?Boolean(t.getExtension(r)):r;return(0,i.Z)(!1===o||!0===o),o}(t,e)))}var A=n(586713);function x(t){return new RegExp("\\b".concat(t,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const E=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,"#version 300 es\n"],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],T=[...E,[x("attribute"),"in $1"],[x("varying"),"out $1"]],w=[...E,[x("varying"),"in $1"]],C=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],S=[...C,[x("in"),"attribute $1"],[x("out"),"varying $1"]],L=[...C,[x("in"),"varying $1"]],O="gl_FragColor",I=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,M=/void\s+main\s*\([^)]*\)\s*\{\n?/;function F(t,e){for(const[n,r]of e)t=t.replace(n,r);return t}const P="\n\n".concat(A.O_,"\n\n"),R={[r.H]:"vertex",[r.Y]:"fragment"};function B(t,e){let{id:n,source:o,type:s,modules:a,defines:c={},hookFunctions:u=[],inject:l={},transpileToGLSL100:h=!1,prologue:m=!0,log:_}=e;(0,i.Z)("string"==typeof o,"shader source must be a string");const x=s===r.H,E=o.split("\n");let C=100,B="",N=o;0===E[0].indexOf("#version ")?(C=300,B=E[0],N=E.slice(1).join("\n")):B="#version ".concat(C);const D={};a.forEach((t=>{Object.assign(D,t.getDefines())})),Object.assign(D,c);let k=m?"".concat(B,"\n").concat(function(t){let{id:e,source:n,type:r}=t;return e&&"string"==typeof e&&-1===n.indexOf("SHADER_NAME")?"\n#define SHADER_NAME ".concat(e,"_").concat(R[r],"\n\n"):""}({id:n,source:o,type:s}),"\n").concat(function(t){let{type:e}=t;return"\n#define SHADER_TYPE_".concat(R[e].toUpperCase(),"\n")}({type:s}),"\n").concat(function(t){const e=function(t){const e=t.getExtension("WEBGL_debug_renderer_info"),n=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||d),r=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||f);return{gpuVendor:function(t,e){return t.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}(n,r),vendor:n,renderer:r,version:t.getParameter(g),shadingLanguageVersion:t.getParameter(p)}}(t);switch(e.gpuVendor.toLowerCase()){case"nvidia":return"#define NVIDIA_GPU\n// Nvidia optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n";case"intel":return"#define INTEL_GPU\n// Intel optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"amd":return"#define AMD_GPU\n";default:return"#define DEFAULT_GPU\n// Prevent driver from optimizing away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"}}(t),"\n").concat(function(t,e,n){let r="#if (__VERSION__ > 120)\n\n# define FEATURE_GLSL_DERIVATIVES\n# define FEATURE_GLSL_DRAW_BUFFERS\n# define FEATURE_GLSL_FRAG_DEPTH\n# define FEATURE_GLSL_TEXTURE_LOD\n\n// DEPRECATED FLAGS, remove in v9\n# define FRAG_DEPTH\n# define DERIVATIVES\n# define DRAW_BUFFERS\n# define TEXTURE_LOD\n\n#endif // __VERSION\n";return y(t,b.GLSL_FRAG_DEPTH)&&(r+="\n// FRAG_DEPTH => gl_FragDepth is available\n#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n# define FEATURE_GLSL_FRAG_DEPTH\n# define FRAG_DEPTH\n# define gl_FragDepth gl_FragDepthEXT\n#endif\n"),y(t,b.GLSL_DERIVATIVES)&&v(t,b.GLSL_DERIVATIVES)&&(r+="\n// DERIVATIVES => dxdF, dxdY and fwidth are available\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n# define FEATURE_GLSL_DERIVATIVES\n# define DERIVATIVES\n#endif\n"),y(t,b.GLSL_FRAG_DATA)&&v(t,b.GLSL_FRAG_DATA,{behavior:"require"})&&(r+="\n// DRAW_BUFFERS => gl_FragData[] is available\n#ifdef GL_EXT_draw_buffers\n#extension GL_EXT_draw_buffers : require\n#define FEATURE_GLSL_DRAW_BUFFERS\n#define DRAW_BUFFERS\n#endif\n"),y(t,b.GLSL_TEXTURE_LOD)&&(r+="// TEXTURE_LOD => texture2DLod etc are available\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod : enable\n\n# define FEATURE_GLSL_TEXTURE_LOD\n# define TEXTURE_LOD\n\n#endif\n"),r}(t),"\n").concat(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=0,n="";for(const r in t){0===e&&(n+="\n// APPLICATION DEFINES\n"),e++;const i=t[r];(i||Number.isFinite(i))&&(n+="#define ".concat(r.toUpperCase()," ").concat(t[r],"\n"))}return 0===e&&(n+="\n"),n}(D),"\n").concat(x?"":"precision highp float;\n\n","\n"):"".concat(B,"\n");const U=function(t){const e={vs:{},fs:{}};return t.forEach((t=>{let n;"string"!=typeof t?(n=t,t=n.hook):n={},t=t.trim();const[r,i]=t.split(":"),o=t.replace(/\(.+/,"");e[r][o]=Object.assign(n,{signature:i})})),e}(u),V={},j={},G={};for(const t in l){const e="string"==typeof l[t]?{injection:l[t],order:0}:l[t],n=t.match(/^(v|f)s:(#)?([\w-]+)$/);if(n){const r=n[2],i=n[3];r?"decl"===i?j[t]=[e]:G[t]=[e]:V[t]=[e]}else G[t]=[e]}for(const t of a){_&&t.checkDeprecations(N,_),k+=t.getModuleSource(s,C);const e=t.injections[s];for(const t in e){const n=t.match(/^(v|f)s:#([\w-]+)$/);if(n){const r="decl"===n[2]?j:G;r[t]=r[t]||[],r[t].push(e[t])}else V[t]=V[t]||[],V[t].push(e[t])}}return k+=P,k=(0,A.ZP)(k,s,j),k+=function(t,e){let n="";for(const r in t){const i=t[r];if(n+="void ".concat(i.signature," {\n"),i.header&&(n+="  ".concat(i.header)),e[r]){const t=e[r];t.sort(((t,e)=>t.order-e.order));for(const e of t)n+="  ".concat(e.injection,"\n")}i.footer&&(n+="  ".concat(i.footer)),n+="}\n"}return n}(U[s],V),k+=N,k=(0,A.ZP)(k,s,G),k=function(t,e,n){switch(e){case 300:return n?F(t,T):function(t){const e=(t=F(t,w)).match(I);if(e){const n=e[1];t=t.replace(new RegExp("\\b".concat(O,"\\b"),"g"),n)}else{const e="fragmentColor";t=t.replace(M,(t=>"out vec4 ".concat(e,";\n").concat(t))).replace(new RegExp("\\b".concat(O,"\\b"),"g"),e)}return t}(t);case 100:return n?F(t,S):function(t){const e=(t=F(t,L)).match(I);if(e){const n=e[1];t=t.replace(I,"").replace(new RegExp("\\b".concat(n,"\\b"),"g"),O)}return t}(t);default:throw new Error("unknown GLSL version ".concat(e))}}(k,h?100:C,x),k}function N(t){return function(e){const n={};for(const r of t){const t=r.getUniforms(e,n);Object.assign(n,t)}return n}}var D=n(807944);class k{static getDefaultProgramManager(t){return t.luma=t.luma||{},t.luma.defaultProgramManager=t.luma.defaultProgramManager||new k(t),t.luma.defaultProgramManager}constructor(t){this.gl=t,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(t){this._defaultModules.find((e=>e.name===t.name))||this._defaultModules.push(t),this.stateHash++}removeDefaultModule(t){const e="string"==typeof t?t:t.name;this._defaultModules=this._defaultModules.filter((t=>t.name!==e)),this.stateHash++}addShaderHook(t,e){e&&(t=Object.assign(e,{hook:t})),this._hookFunctions.push(t),this.stateHash++}get(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{vs:e="",fs:n="",defines:i={},inject:o={},varyings:s=[],bufferMode:a=35981,transpileToGLSL100:c=!1}=t,l=this._getModuleList(t.modules),h=this._getHash(e),d=this._getHash(n),f=l.map((t=>this._getHash(t.name))).sort(),g=s.map((t=>this._getHash(t))),p=Object.keys(i).sort(),m=Object.keys(o).sort(),b=[],_=[];for(const t of p)b.push(this._getHash(t)),b.push(this._getHash(i[t]));for(const t of m)_.push(this._getHash(t)),_.push(this._getHash(o[t]));const v="".concat(h,"/").concat(d,"D").concat(b.join("/"),"M").concat(f.join("/"),"I").concat(_.join("/"),"V").concat(g.join("/"),"H").concat(this.stateHash,"B").concat(a).concat(c?"T":"");if(!this._programCache[v]){const t=function(t,e){const{vs:n,fs:i}=e,o=u(e.modules||[]);return{gl:t,vs:B(t,Object.assign({},e,{source:n,type:r.H,modules:o})),fs:B(t,Object.assign({},e,{source:i,type:r.Y,modules:o})),getUniforms:N(o)}}(this.gl,{vs:e,fs:n,modules:l,inject:o,defines:i,hookFunctions:this._hookFunctions,transpileToGLSL100:c});this._programCache[v]=new D.Z(this.gl,{hash:v,vs:t.vs,fs:t.fs,varyings:s,bufferMode:a}),this._getUniforms[v]=t.getUniforms||(t=>{}),this._useCounts[v]=0}return this._useCounts[v]++,this._programCache[v]}getUniforms(t){return this._getUniforms[t.hash]||null}release(t){const e=t.hash;this._useCounts[e]--,0===this._useCounts[e]&&(this._programCache[e].delete(),delete this._programCache[e],delete this._getUniforms[e],delete this._useCounts[e])}_getHash(t){return void 0===this._hashes[t]&&(this._hashes[t]=this._hashCounter++),this._hashes[t]}_getModuleList(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=new Array(this._defaultModules.length+t.length),n={};let r=0;for(let t=0,i=this._defaultModules.length;t<i;++t){const i=this._defaultModules[t],o=i.name;e[r++]=i,n[o]=!0}for(let i=0,o=t.length;i<o;++i){const o=t[i],s=o.name;n[s]||(e[r++]=o,n[s]=!0)}return e.length=r,e}}},263346:(t,e,n)=>{"use strict";n.d(e,{Z:()=>C});var r=n(229047);const i="out vec4 transform_output;\nvoid main() {\n  transform_output = vec4(0);\n}",o="#version 300 es\n".concat(i);function s(t,e){e=Array.isArray(e)?e:[e];const n=t.replace(/^\s+/,"").split(/\s+/),[r,i,o]=n;return e.includes(r)&&i&&o?{qualifier:r,type:i,name:o.split(";")[0]}:null}function a(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{version:e=100,input:n,inputType:s,output:a}=t;if(!n)return 300===e?o:e>300?"#version ".concat(e,"\n").concat(i):"void main() {gl_FragColor = vec4(0);}";const c=function(t,e){switch(e){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return(0,r.Z)(!1),null}}(n,s);return e>=300?"#version ".concat(e," ").concat(300===e?"es":"","\nin ").concat(s," ").concat(n,";\nout vec4 ").concat(a,";\nvoid main() {\n  ").concat(a," = ").concat(c,";\n}"):"varying ".concat(s," ").concat(n,";\nvoid main() {\n  gl_FragColor = ").concat(c,";\n}")}var c=n(739450),u=n(53478),l=n(151053),h=n(822525);class d{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.gl=t,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(e),Object.seal(this)}setupResources(t){for(const e of this.bindings)this._setupTransformFeedback(e,t)}updateModelProps(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{varyings:e}=this;return e.length>0&&(t=Object.assign({},t,{varyings:e})),t}getDrawOptions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=this.bindings[this.currentIndex],{sourceBuffers:n,transformFeedback:r}=e;return{attributes:Object.assign({},n,t.attributes),transformFeedback:r}}swap(){return!!this.feedbackMap&&(this.currentIndex=this._getNextIndex(),!0)}update(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setupBuffers(t)}getBuffer(t){const{feedbackBuffers:e}=this.bindings[this.currentIndex],n=t?e[t]:null;return n?n instanceof u.Z?n:n.buffer:null}getData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{varyingName:e}=t,n=this.getBuffer(e);return n?n.getData():null}delete(){for(const t in this.resources)this.resources[t].delete()}_initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setupBuffers(t),this.varyings=t.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&(0,h.h)((0,c.D0)(this.gl))}_getFeedbackBuffers(t){const{sourceBuffers:e={}}=t,n={};if(this.bindings[this.currentIndex]&&Object.assign(n,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const t in this.feedbackMap){const r=this.feedbackMap[t];t in e&&(n[r]=t)}Object.assign(n,t.feedbackBuffers);for(const t in n){const r=n[t];if("string"==typeof r){const i=e[r],{byteLength:o,usage:s,accessor:a}=i;n[t]=this._createNewBuffer(t,{byteLength:o,usage:s,accessor:a})}}return n}_setupBuffers(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{sourceBuffers:e=null}=t;Object.assign(this.feedbackMap,t.feedbackMap);const n=this._getFeedbackBuffers(t);this._updateBindings({sourceBuffers:e,feedbackBuffers:n})}_setupTransformFeedback(t,e){let{model:n}=e;const{program:r}=n;t.transformFeedback=new l.Z(this.gl,{program:r,buffers:t.feedbackBuffers})}_updateBindings(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this.feedbackMap){const{sourceBuffers:t,feedbackBuffers:e}=this._swapBuffers(this.bindings[this.currentIndex]),n=this._getNextIndex();this.bindings[n]=this._updateBinding(this.bindings[n],{sourceBuffers:t,feedbackBuffers:e})}}_updateBinding(t,e){return t?(Object.assign(t.sourceBuffers,e.sourceBuffers),Object.assign(t.feedbackBuffers,e.feedbackBuffers),t.transformFeedback&&t.transformFeedback.setBuffers(t.feedbackBuffers),t):{sourceBuffers:Object.assign({},e.sourceBuffers),feedbackBuffers:Object.assign({},e.feedbackBuffers)}}_swapBuffers(t){if(!this.feedbackMap)return null;const e=Object.assign({},t.sourceBuffers),n=Object.assign({},t.feedbackBuffers);for(const r in this.feedbackMap){const i=this.feedbackMap[r];e[r]=t.feedbackBuffers[i],n[i]=t.sourceBuffers[r],(0,h.h)(n[i]instanceof u.Z)}return{sourceBuffers:e,feedbackBuffers:n}}_createNewBuffer(t,e){const n=new u.Z(this.gl,e);return this.resources[t]&&this.resources[t].delete(),this.resources[t]=n,n}_getNextIndex(){return(this.currentIndex+1)%2}}var f=n(601953),g=n(904912),p=n(53849),m=n(495432);function b(t){let e=100;const n=t.match(/[^\s]+/g);if(n.length>=2&&"#version"===n[0]){const t=parseInt(n[1],10);Number.isFinite(t)&&(e=t)}return e}var _=n(586713);const v={name:"transform",vs:"attribute float transform_elementID;\nvec2 transform_getPixelSizeHalf(vec2 size) {\n  return vec2(1.) / (2. * size);\n}\n\nvec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {\n  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);\n  float xIndex = transform_elementID - (yIndex * texSize[0]);\n  return vec2(xIndex, yIndex);\n}\nvec2 transform_getTexCoord(vec2 size) {\n  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);\n  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);\n  vec2 coord = indices / size + pixelSizeHalf;\n  return coord;\n}\nvec2 transform_getPos(vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);\n  return pos;\n}\nvec4 transform_getInput(sampler2D texSampler, vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  vec4 textureColor = texture2D(texSampler, texCoord);\n  return textureColor;\n}\n",fs:null},y="transform_uSize_",A="transform_position";const x={10241:9728,10240:9728,10242:33071,10243:33071};class E{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.gl=t,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(e),Object.seal(this)}updateModelProps(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=this._processVertexShader(t);return Object.assign({},t,e)}getDrawOptions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{sourceBuffers:e,sourceTextures:n,framebuffer:r,targetTexture:i}=this.bindings[this.currentIndex],o=Object.assign({},e,t.attributes),s=Object.assign({},t.uniforms),a=Object.assign({},t.parameters);let c=t.discard;if(this.hasSourceTextures||this.hasTargetTexture){o.transform_elementID=this.elementIDBuffer;for(const t in this.samplerTextureMap){const e=this.samplerTextureMap[t];s[t]=n[e]}this._setSourceTextureParameters();const t=function(t){let{sourceTextureMap:e,targetTextureVarying:n,targetTexture:r}=t;const i={};let o,s;n&&(({width:o,height:s}=r),i["".concat(y).concat(n)]=[o,s]);for(const t in e)({width:o,height:s}=e[t]),i["".concat(y).concat(t)]=[o,s];return i}({sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:i});Object.assign(s,t)}return this.hasTargetTexture&&(c=!1,a.viewport=[0,0,r.width,r.height]),{attributes:o,framebuffer:r,uniforms:s,discard:c,parameters:a}}swap(){return!!this._swapTexture&&(this.currentIndex=this._getNextIndex(),!0)}update(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setupTextures(t)}getTargetTexture(){const{targetTexture:t}=this.bindings[this.currentIndex];return t}getData(){let{packed:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{framebuffer:e}=this.bindings[this.currentIndex],n=(0,f.z6)(e);if(!t)return n;const i=n.constructor,o=function(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return(0,r.Z)(!1),null}}(this.targetTextureType),s=new i(n.length*o/4);let a=0;for(let t=0;t<n.length;t+=4)for(let e=0;e<o;e++)s[a++]=n[t+e];return s}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{_targetTextureVarying:e,_swapTexture:n}=t;this._swapTexture=n,this.targetTextureVarying=e,this.hasTargetTexture=e,this._setupTextures(t)}_createTargetTexture(t){const{sourceTextures:e,textureOrReference:n}=t;if(n instanceof g.Z)return n;const r=e[n];return r?(this._targetRefTexName=n,this._createNewTexture(r)):null}_setupTextures(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{sourceBuffers:e,_sourceTextures:n={},_targetTexture:r}=t,i=this._createTargetTexture({sourceTextures:n,textureOrReference:r});this.hasSourceTextures=this.hasSourceTextures||n&&Object.keys(n).length>0,this._updateBindings({sourceBuffers:e,sourceTextures:n,targetTexture:i}),"elementCount"in t&&this._updateElementIDBuffer(t.elementCount)}_updateElementIDBuffer(t){if("number"!=typeof t||this.elementCount>=t)return;const e=new Float32Array(t);e.forEach(((t,e,n)=>{n[e]=e})),this.elementIDBuffer?this.elementIDBuffer.setData({data:e}):this.elementIDBuffer=new u.Z(this.gl,{data:e,accessor:{size:1}}),this.elementCount=t}_updateBindings(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this._swapTexture){const{sourceTextures:t,targetTexture:e}=this._swapTextures(this.bindings[this.currentIndex]),n=this._getNextIndex();this.bindings[n]=this._updateBinding(this.bindings[n],{sourceTextures:t,targetTexture:e})}}_updateBinding(t,e){const{sourceBuffers:n,sourceTextures:r,targetTexture:i}=e;if(t||(t={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(t.sourceTextures,r),Object.assign(t.sourceBuffers,n),i){t.targetTexture=i;const{width:e,height:n}=i,{framebuffer:r}=t;r?(r.update({attachments:{36064:i},resizeAttachments:!1}),r.resize({width:e,height:n})):t.framebuffer=new p.Z(this.gl,{id:"transform-framebuffer",width:e,height:n,attachments:{36064:i}})}return t}_setSourceTextureParameters(){const t=this.currentIndex,{sourceTextures:e}=this.bindings[t];for(const t in e)e[t].setParameters(x)}_swapTextures(t){if(!this._swapTexture)return null;const e=Object.assign({},t.sourceTextures);return e[this._swapTexture]=t.targetTexture,{sourceTextures:e,targetTexture:t.sourceTextures[this._swapTexture]}}_createNewTexture(t){const e=(0,m.h)(t,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=e,e}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{sourceTextures:e,targetTexture:n}=this.bindings[this.currentIndex],{vs:i,uniforms:o,targetTextureType:c,inject:u,samplerTextureMap:l}=function(t){let{vs:e,sourceTextureMap:n,targetTextureVarying:i,targetTexture:o}=t,a=Object.keys(n).length,c=null;const u={};let l=e,d={};if(a>0||i){const t=l.split("\n"),e=t.slice();if(t.forEach(((t,o,l)=>{if(a>0){const i=function(t,e){const n={},i=function(t){return s(t,["attribute","in"])}(t);if(!i)return null;const{type:o,name:a}=i;if(a&&e[a]){const e="// ".concat(t," => Replaced by Transform with a sampler"),{samplerName:i,sizeName:s,uniformDeclerations:c}=function(t){const e="".concat("transform_uSampler_").concat(t),n="".concat(y).concat(t);return{samplerName:e,sizeName:n,uniformDeclerations:"  uniform sampler2D ".concat(e,";\n  uniform vec2 ").concat(n,";")}}(a),u=function(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return(0,r.Z)(!1),null}}(o),l="  ".concat(o," ").concat(a," = transform_getInput(").concat(i,", ").concat(s,").").concat(u,";\n");return n[i]=a,{updatedLine:e,inject:{"vs:#decl":c,"vs:#main-start":l},samplerTextureMap:n}}return null}(t,n);if(i){const{updatedLine:t,inject:n}=i;e[o]=t,d=(0,_.Lm)([d,n]),Object.assign(u,i.samplerTextureMap),a--}}i&&!c&&(c=function(t,e){const n=s(t,["varying","out"]);return n&&n.name===e?n.type:null}(t,i))})),i){(0,h.h)(o);const t="".concat(y).concat(i),e={"vs:#decl":"uniform vec2 ".concat(t,";\n"),"vs:#main-start":"     vec2 ".concat(A," = transform_getPos(").concat(t,");\n     gl_Position = vec4(").concat(A,", 0, 1.);\n")};d=(0,_.Lm)([d,e])}l=e.join("\n")}return{vs:l,targetTextureType:c,inject:d,samplerTextureMap:u}}({vs:t.vs,sourceTextureMap:e,targetTextureVarying:this.targetTextureVarying,targetTexture:n}),d=(0,_.Lm)([t.inject||{},u]);return this.targetTextureType=c,this.samplerTextureMap=l,{vs:i,fs:t._fs||a({version:b(i),input:this.targetTextureVarying,inputType:c,output:"transform_output"}),modules:this.hasSourceTextures||this.targetTextureVarying?[v].concat(t.modules||[]):t.modules,uniforms:o,inject:d}}}var T=n(574538),w=n(339769);class C{static isSupported(t){return(0,c.D0)(t)}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.gl=t,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(e),Object.seal(this)}delete(){const{model:t,bufferTransform:e,textureTransform:n}=this;t&&t.delete(),e&&e.delete(),n&&n.delete()}run(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{clearRenderTarget:e=!0}=t,n=this._updateDrawOptions(t);e&&n.framebuffer&&n.framebuffer.clear({color:!0}),this.model.transform(n)}swap(){let t=!1;const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of e)t=t||n.swap();(0,h.h)(t,"Nothing to swap")}getBuffer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(t)}getData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of e){const e=n.getData(t);if(e)return e}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"elementCount"in t&&this.model.setVertexCount(t.elementCount);const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of e)n.update(t)}_initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{gl:e}=this;this._buildResourceTransforms(e,t),t=this._updateModelProps(t),this.model=new w.Z(e,Object.assign({},t,{fs:t.fs||a({version:b(t.vs)}),id:t.id||"transform-model",drawMode:t.drawMode||0,vertexCount:t.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(t){let e=Object.assign({},t);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const t of n)e=t.updateModelProps(e);return e}_buildResourceTransforms(t,e){(function(t){return!((0,T.nK)(t.feedbackBuffers)&&(0,T.nK)(t.feedbackMap)&&!(t.varyings&&t.varyings.length>0))})(e)&&(this.bufferTransform=new d(t,e)),function(t){return!((0,T.nK)(t._sourceTextures)&&!t._targetTexture&&!t._targetTextureVarying)}(e)&&(this.textureTransform=new E(t,e)),(0,h.h)(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(t){let e=Object.assign({},t);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const t of n)e=Object.assign(e,t.getDrawOptions(e));return e}}},739450:(t,e,n)=>{"use strict";n.d(e,{KQ:()=>h,JD:()=>l,s9:()=>J,JY:()=>W,w:()=>Z,vd:()=>u,yW:()=>$,UF:()=>a,D0:()=>c,cM:()=>r,kL:()=>z,aQ:()=>tt,dR:()=>G,s8:()=>H});const r=new(n(559109).Z)({id:"luma.gl"});function i(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const o="Invalid WebGLRenderingContext",s="Requires WebGL2";function a(t){return"undefined"!=typeof WebGLRenderingContext&&t instanceof WebGLRenderingContext||"undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||Boolean(t&&Number.isFinite(t._version))}function c(t){return"undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||Boolean(t&&2===t._version)}function u(t){return c(t)?t:null}function l(t){return i(a(t),o),t}function h(t){return i(c(t),s),t}const d={};const f=function t(e){const n=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let e=0;e<this.attribs.length;e++){const r=new t.VertexAttrib(n);this.attribs[e]=r}this.maxAttrib=0};(f.VertexAttrib=function(t){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()}).prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const g=function(t){const e=this;this.gl=t,function(t){const e=t.getError;t.getError=function(){let n;do{n=e.apply(t),0!==n&&(d[n]=!0)}while(0!==n);for(n in d)if(d[n])return delete d[n],parseInt(n,10);return 0}}(t);const n=this.original={getParameter:t.getParameter,enableVertexAttribArray:t.enableVertexAttribArray,disableVertexAttribArray:t.disableVertexAttribArray,bindBuffer:t.bindBuffer,getVertexAttrib:t.getVertexAttrib,vertexAttribPointer:t.vertexAttribPointer};t.getParameter=function(t){return t===e.VERTEX_ARRAY_BINDING_OES?e.currentVertexArrayObject===e.defaultVertexArrayObject?null:e.currentVertexArrayObject:n.getParameter.apply(this,arguments)},t.enableVertexAttribArray=function(t){const r=e.currentVertexArrayObject;return r.maxAttrib=Math.max(r.maxAttrib,t),r.attribs[t].enabled=!0,n.enableVertexAttribArray.apply(this,arguments)},t.disableVertexAttribArray=function(t){const r=e.currentVertexArrayObject;return r.maxAttrib=Math.max(r.maxAttrib,t),r.attribs[t].enabled=!1,n.disableVertexAttribArray.apply(this,arguments)},t.bindBuffer=function(t,r){switch(t){case 34962:e.currentArrayBuffer=r;break;case 34963:e.currentVertexArrayObject.elementArrayBuffer=r}return n.bindBuffer.apply(this,arguments)},t.getVertexAttrib=function(t,r){const i=e.currentVertexArrayObject.attribs[t];switch(r){case 34975:return i.buffer;case 34338:return i.enabled;case 34339:return i.size;case 34340:return i.stride;case 34341:return i.type;case 34922:return i.normalized;default:return n.getVertexAttrib.apply(this,arguments)}},t.vertexAttribPointer=function(t,r,i,o,s,a){const c=e.currentVertexArrayObject;c.maxAttrib=Math.max(c.maxAttrib,t);const u=c.attribs[t];return u.buffer=e.currentArrayBuffer,u.size=r,u.type=i,u.normalized=o,u.stride=s,u.offset=a,u.recache(),n.vertexAttribPointer.apply(this,arguments)},t.instrumentExtension&&t.instrumentExtension(this,"OES_vertex_array_object"),t.canvas&&t.canvas.addEventListener("webglcontextrestored",(()=>{globalThis.console&&globalThis.console.log&&globalThis.console.log("OESVertexArrayObject emulation library context restored"),e.reset_()}),!0),this.reset_()};g.prototype.VERTEX_ARRAY_BINDING_OES=34229,g.prototype.reset_=function(){if(void 0!==this.vertexArrayObjects)for(let t=0;t<this.vertexArrayObjects.length;++t)this.vertexArrayObjects.isAlive=!1;const t=this.gl;this.maxVertexAttribs=t.getParameter(34921),this.defaultVertexArrayObject=new f(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},g.prototype.createVertexArrayOES=function(){const t=new f(this);return this.vertexArrayObjects.push(t),t},g.prototype.deleteVertexArrayOES=function(t){t.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(t),1),this.currentVertexArrayObject===t&&this.bindVertexArrayOES(null)},g.prototype.isVertexArrayOES=function(t){return!!(t&&t instanceof f&&t.hasBeenBound&&t.ext===this)},g.prototype.bindVertexArrayOES=function(t){const e=this.gl;if(t&&!t.isAlive)return n="bindVertexArrayOES: attempt to bind deleted arrayObject",d[1282]=!0,void(void 0!==n&&(r=n,globalThis.console&&globalThis.console.error&&globalThis.console.error(r)));var n,r;const i=this.original,o=this.currentVertexArrayObject;this.currentVertexArrayObject=t||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const s=this.currentVertexArrayObject;if(o===s)return;o&&s.elementArrayBuffer===o.elementArrayBuffer||i.bindBuffer.call(e,34963,s.elementArrayBuffer);let a=this.currentArrayBuffer;const c=Math.max(o?o.maxAttrib:0,s.maxAttrib);for(let t=0;t<=c;t++){const n=s.attribs[t],r=o?o.attribs[t]:null;if(o&&n.enabled===r.enabled||(n.enabled?i.enableVertexAttribArray.call(e,t):i.disableVertexAttribArray.call(e,t)),n.enabled){let s=!1;o&&n.buffer===r.buffer||(a!==n.buffer&&(i.bindBuffer.call(e,34962,n.buffer),a=n.buffer),s=!0),(s||n.cached!==r.cached)&&i.vertexAttribPointer.call(e,t,n.size,n.type,n.normalized,n.stride,n.offset)}}this.currentArrayBuffer!==a&&i.bindBuffer.call(e,34962,this.currentArrayBuffer)};const p="OES_element_index",m="WEBGL_draw_buffers",b="WEBGL_debug_renderer_info",_=t=>c(t)?void 0:0,v={3074:t=>c(t)?void 0:36064,35723:t=>c(t)?void 0:4352,35977:_,32937:_,36795:(t,e)=>{const n=c(t)?t.getExtension("EXT_disjoint_timer_query_webgl2"):t.getExtension("EXT_disjoint_timer_query");return n&&n.GPU_DISJOINT_EXT?e(n.GPU_DISJOINT_EXT):0},37445:(t,e)=>{const n=t.getExtension(b);return e(n&&n.UNMASKED_VENDOR_WEBGL||7936)},37446:(t,e)=>{const n=t.getExtension(b);return e(n&&n.UNMASKED_RENDERER_WEBGL||7937)},34047:(t,e)=>{const n=t.luma.extensions.EXT_texture_filter_anisotropic;return n?e(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:_,35071:_,37447:_,36063:(t,e)=>{if(!c(t)){const n=t.getExtension(m);return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:_,35374:_,35377:_,34852:t=>{if(!c(t)){const e=t.getExtension(m);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},36203:t=>t.getExtension(p)?2147483647:65535,33001:t=>t.getExtension(p)?16777216:65535,33e3:t=>16777216,37157:_,35373:_,35657:_,36183:_,37137:_,34045:_,35978:_,35979:_,35968:_,35376:_,35375:_,35659:_,37154:_,35371:_,35658:_,35076:_,35077:_,35380:_},y="ANGLE_instanced_arrays",A={OES_vertex_array_object:{meta:{suffix:"OES"},createVertexArray:()=>{i(!1,"VertexArray requires WebGL2 or OES_vertex_array_object extension")},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[y]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(t,e){i(0===e,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},WEBGL_draw_buffers:{meta:{suffix:"WEBGL"},drawBuffers:()=>{i(!1)}},EXT_disjoint_timer_query:{meta:{suffix:"EXT"},createQuery:()=>{i(!1)},deleteQuery:()=>{i(!1)},beginQuery:()=>{i(!1)},endQuery:()=>{},getQuery(t,e){return this.getQueryObject(t,e)},getQueryParameter(t,e){return this.getQueryObject(t,e)},getQueryObject:()=>{}}},x={readBuffer:(t,e,n)=>{c(t)&&e(n)},getVertexAttrib:(t,e,n,r)=>{const{webgl2:i,ext:o}=function(t,e){return{webgl2:c(t),ext:t.getExtension(e)}}(t,y);let s;switch(r){case 35069:s=!!i&&void 0;break;case 35070:s=i||o?void 0:0}return void 0!==s?s:e(n,r)},getProgramParameter:(t,e,n,r)=>{if(!c(t))switch(r){case 35967:return 35981;case 35971:case 35382:return 0}return e(n,r)},getInternalformatParameter:(t,e,n,r,i)=>c(t)||32937!==i?t.getInternalformatParameter(n,r,i):new Int32Array([0]),getTexParameter(t,e,n,r){if(34046===r){const{extensions:e}=t.luma,n=e.EXT_texture_filter_anisotropic;r=n&&n.TEXTURE_MAX_ANISOTROPY_EXT||34046}return e(n,r)},getParameter:function(t,e,n){const r=v[n],i="function"==typeof r?r(t,e,n):r;return void 0!==i?i:e(n)},hint:(t,e,n,r)=>e(n,r)};function E(t,e){let{extension:n,target:r,target2:o}=e;const s=A[n];i(s);const{meta:a={}}=s,{suffix:c=""}=a,u=t.getExtension(n);for(const e of Object.keys(s)){const n="".concat(e).concat(c);let i=null;"meta"===e||"function"==typeof t[e]||(u&&"function"==typeof u[n]?i=function(){return u[n](...arguments)}:"function"==typeof s[e]&&(i=s[e].bind(r))),i&&(r[e]=i,o[e]=i)}}globalThis.polyfillContext=function(t){t.luma=t.luma||{};const{luma:e}=t;return e.polyfilled||(function(t){if("function"==typeof t.createVertexArray)return;const e=t.getSupportedExtensions;t.getSupportedExtensions=function(){const t=e.call(this)||[];return t.indexOf("OES_vertex_array_object")<0&&t.push("OES_vertex_array_object"),t};const n=t.getExtension;t.getExtension=function(e){return n.call(this,e)||("OES_vertex_array_object"!==e?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new g(this)),this.__OESVertexArrayObject))}}(t),function(t){t.luma.extensions={};const e=t.getSupportedExtensions()||[];for(const n of e)t.luma[n]=t.getExtension(n)}(t),function(t,e){for(const n of Object.getOwnPropertyNames(e))"overrides"!==n&&E(t,{extension:n,target:t.luma,target2:t})}(t,A),function(t,e){let{target:n,target2:r}=e;Object.keys(x).forEach((e=>{if("function"==typeof x[e]){const i=t[e]?t[e].bind(t):()=>{},o=x[e].bind(null,t,i);n[e]=o,r[e]=o}}))}(t,{target:e,target2:t}),e.polyfilled=!0),t};const T={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},w=(t,e,n)=>e?t.enable(n):t.disable(n),C=(t,e,n)=>t.hint(n,e),S=(t,e,n)=>t.pixelStorei(n,e);function L(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const O={3042:w,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:w,2885:(t,e)=>t.cullFace(e),2929:w,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:w,35723:C,36006:(t,e)=>{const n=c(t)?36009:36160;return t.bindFramebuffer(n,e)},2886:(t,e)=>t.frontFace(e),33170:C,2849:(t,e)=>t.lineWidth(e),32823:w,32824:"polygonOffset",10752:"polygonOffset",35977:w,32938:"sampleCoverage",32939:"sampleCoverage",3089:w,3088:(t,e)=>t.scissor(...e),2960:w,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),3333:S,3317:S,37440:S,37441:S,37443:S,3330:S,3332:S,3331:S,36010:(t,e)=>t.bindFramebuffer(36008,e),3314:S,32878:S,3316:S,3315:S,32877:S,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{e=L(e)?e:[e,e],t.blendEquationSeparate(...e)},blendFunc:(t,e)=>{e=L(e)&&2===e.length?[...e,...e]:e,t.blendFuncSeparate(...e)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=L(e)?e:[e,e];const[n,r]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,r)},stencilFunc:(t,e)=>{e=L(e)&&3===e.length?[...e,...e]:e;const[n,r,i,o,s,a]=e;t.stencilFuncSeparate(1028,n,r,i),t.stencilFuncSeparate(1029,o,s,a)},stencilOp:(t,e)=>{e=L(e)&&3===e.length?[...e,...e]:e;const[n,r,i,o,s,a]=e;t.stencilOpSeparate(1028,n,r,i),t.stencilOpSeparate(1029,o,s,a)},viewport:(t,e)=>t.viewport(...e)};function I(t,e,n){return void 0!==e[t]?e[t]:n[t]}const M={blendEquation:(t,e,n)=>t.blendEquationSeparate(I(32777,e,n),I(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(I(32969,e,n),I(32968,e,n),I(32971,e,n),I(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(I(32824,e,n),I(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(I(32938,e,n),I(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,I(2962,e,n),I(2967,e,n),I(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,I(34816,e,n),I(36003,e,n),I(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,I(2964,e,n),I(2965,e,n),I(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,I(34817,e,n),I(34818,e,n),I(34819,e,n))},F={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},blendColor:(t,e,n,r,i)=>t({32773:new Float32Array([e,n,r,i])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,r,i)=>t({32969:e,32968:n,32971:r,32970:i}),clearColor:(t,e,n,r,i)=>t({3106:new Float32Array([e,n,r,i])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,r,i)=>t({3107:[e,n,r,i]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,r,i)=>t({3088:new Int32Array([e,n,r,i])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[1028===e?2968:36005]:n}),stencilFunc:(t,e,n,r)=>t({2962:e,2967:n,2963:r,34816:e,36003:n,36004:r}),stencilFuncSeparate:(t,e,n,r,i)=>t({[1028===e?2962:34816]:n,[1028===e?2967:36003]:r,[1028===e?2963:36004]:i}),stencilOp:(t,e,n,r)=>t({2964:e,2965:n,2966:r,34817:e,34818:n,34819:r}),stencilOpSeparate:(t,e,n,r,i)=>t({[1028===e?2964:34817]:n,[1028===e?2965:34818]:r,[1028===e?2966:34819]:i}),viewport:(t,e,n,r,i)=>t({2978:[e,n,r,i]})},P=(t,e)=>t.isEnabled(e),R={3042:P,2884:P,2929:P,3024:P,32823:P,32926:P,32928:P,3089:P,2960:P,35977:P};function B(t){for(const e in t)return!1;return!0}function N(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),r=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&r&&t.length===e.length){for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}return!1}function D(t,e){const n=t[e].bind(t);t[e]=function(){const e=arguments.length<=0?void 0:arguments[0];return e in t.state.cache&&t.state.enable?t.state.cache[e]:n(...arguments)},Object.defineProperty(t[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function k(t,e,n){const r=t[e].bind(t);t[e]=function(){for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];const{valueChanged:s,oldValue:a}=n(t.state._updateCache,...i);return s&&r(...i),a},Object.defineProperty(t[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}class U{constructor(t){let{copyState:e=!1,log:n=(()=>{})}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.gl=t,this.program=null,this.stateStack=[],this.enable=!0,this.cache=e?function(t,e){if("number"==typeof(e=e||T)){const n=e,r=R[n];return r?r(t,n):t.getParameter(n)}const n=Array.isArray(e)?e:Object.keys(e),r={};for(const e of n){const n=R[e];r[e]=n?n(t,Number(e)):t.getParameter(Number(e))}return r}(t):Object.assign({},T),this.log=n,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){i(this.stateStack.length>0);const t=this.stateStack[this.stateStack.length-1];G(this.gl,t),this.stateStack.pop()}_updateCache(t){let e,n=!1;const r=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const o in t){i(void 0!==o);const s=t[o],a=this.cache[o];N(s,a)||(n=!0,e=a,r&&!(o in r)&&(r[o]=a),this.cache[o]=s)}return{valueChanged:n,oldValue:e}}}function V(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{enable:n=!0,copyState:r}=e;if(i(void 0!==r),!t.state){const{polyfillContext:e}=globalThis;e&&e(t),t.state=new U(t,{copyState:r}),function(t){const e=t.useProgram.bind(t);t.useProgram=function(n){t.state.program!==n&&(e(n),t.state.program=n)}}(t);for(const e in F)k(t,e,F[e]);D(t,"getParameter"),D(t,"isEnabled")}return t.state.enable=n,t}function j(t){i(t.state),t.state.pop()}function G(t,e){if(i(a(t),"setParameters requires a WebGL context"),B(e))return;const n={};for(const r in e){const i=Number(r),o=O[r];o&&("string"==typeof o?n[o]=!0:o(t,e[r],i))}const r=t.state&&t.state.cache;if(r)for(const i in n)(0,M[i])(t,e,r)}function z(t){G(t,T)}function H(t,e,n){if(B(e))return n(t);const{nocatch:r=!0}=e;let i;if(function(t){t.state||V(t,{copyState:!1}),t.state.push()}(t),G(t,e),r)i=n(t),j(t);else try{i=n(t)}finally{j(t)}return i}function Z(t){const{luma:e}=t;if(t.canvas&&e){const n=e.canvasSizeInfo,r="clientWidth"in n?n.clientWidth:t.canvas.clientWidth;return r?t.drawingBufferWidth/r:1}return 1}function W(t,e){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return function(t,e,n,r,i){const o=X(t[0],e,n);let s=Y(t[1],e,r,i),a=X(t[0]+1,e,n);const c=a===n-1?a:a-1;let u;return a=Y(t[1]+1,e,r,i),i?(a=0===a?a:a+1,u=s,s=a):u=a===r-1?a:a-1,{x:o,y:s,width:Math.max(c-o+1,1),height:Math.max(u-s+1,1)}}(e,Z(t),t.drawingBufferWidth,t.drawingBufferHeight,n)}function X(t,e,n){return Math.min(Math.round(t*e),n-1)}function Y(t,e,n,r){return r?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const Q=(0,n(693370).Z)(),q=Q&&"undefined"!=typeof document,K={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function J(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(Q,"createGLContext only available in the browser.\nCreate your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils"),t=Object.assign({},K,t);const{width:e,height:n}=t;function o(e){if(t.throwOnError)throw new Error(e);return console.error(e),null}let s;t.onError=o;const{canvas:a}=t,u=function(t){let e,{canvas:n,width:r=800,height:i=600,onError:o}=t;return"string"==typeof n?(q&&"complete"===document.readyState||o("createGLContext called on canvas '".concat(n,"' before page was loaded")),e=document.getElementById(n)):n?e=n:(e=document.createElement("canvas"),e.id="lumagl-canvas",e.style.width=Number.isFinite(r)?"".concat(r,"px"):"100%",e.style.height=Number.isFinite(i)?"".concat(i,"px"):"100%",document.body.insertBefore(e,document.body.firstChild)),e}({canvas:a,width:e,height:n,onError:o});return s=function(t,e){const{onError:n}=e;let r=null;const i=t=>r=t.statusMessage||r;t.addEventListener("webglcontextcreationerror",i,!1);const{webgl1:o=!0,webgl2:s=!0}=e;let a=null;return s&&(a=a||t.getContext("webgl2",e),a=a||t.getContext("experimental-webgl2",e)),o&&(a=a||t.getContext("webgl",e),a=a||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",i,!1),a?(e.onContextLost&&t.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&t.addEventListener("webglcontextrestored",e.onContextRestored,!1),a):n("Failed to create ".concat(s&&!o?"WebGL2":"WebGL"," context: ").concat(r||"Unknown error"))}(u,t),s?(s=$(s,t),function(t){const e=c(t)?"WebGL2":"WebGL1",n=function(t){const e=t.getParameter(7936),n=t.getParameter(7937),r=t.getExtension("WEBGL_debug_renderer_info");return{vendor:r&&t.getParameter(r.UNMASKED_VENDOR_WEBGL||7936)||e,renderer:r&&t.getParameter(r.UNMASKED_RENDERER_WEBGL||7937)||n,vendorMasked:e,rendererMasked:n,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}(t),i=n?"(".concat(n.vendor,",").concat(n.renderer,")"):"",o=t.debug?" debug":"";r.info(1,"".concat(e).concat(o," context ").concat(i))()}(s),s):null}function $(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t||t._instrumented)return t;t._version=t._version||function(t){return"undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext?2:1}(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},e=Object.assign({},K,e);const{manageState:n,debug:i}=e;return n&&V(t,{copyState:!1,log:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return r.log(1,...e)()}}),Q&&i&&(globalThis.makeDebugContext?(t=globalThis.makeDebugContext(t,e),r.level=Math.max(r.level,1)):r.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function tt(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t.canvas)return void function(t,e,n){let i="width"in n?n.width:t.canvas.clientWidth,o="height"in n?n.height:t.canvas.clientHeight;i&&o||(r.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=t.canvas.width||1,o=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};const s=t.luma.canvasSizeInfo;if(s.clientWidth!==i||s.clientHeight!==o||s.devicePixelRatio!==e){let n=e;const s=Math.floor(i*n),a=Math.floor(o*n);t.canvas.width=s,t.canvas.height=a,t.drawingBufferWidth===s&&t.drawingBufferHeight===a||(r.warn("Device pixel ratio clamped")(),n=Math.min(t.drawingBufferWidth/i,t.drawingBufferHeight/o),t.canvas.width=Math.floor(i*n),t.canvas.height=Math.floor(o*n)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:i,clientHeight:o,devicePixelRatio:e})}}(t,function(t){const e="undefined"==typeof window?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?e:1}(e.useDevicePixels),e);const n=t.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in e&&"height"in e&&n.resize(e.width,e.height)}},475682:(t,e,n)=>{"use strict";n.d(e,{H:()=>r,Y:()=>i});const r="vs",i="fs"},586713:(t,e,n)=>{"use strict";n.d(e,{O_:()=>s,Lm:()=>h,ZP:()=>l});var r=n(475682),i=n(229047);const o={[r.H]:"#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n",[r.Y]:"#ifdef MODULE_MATERIAL\n  gl_FragColor = material_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  gl_FragColor = lighting_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_FOG\n  gl_FragColor = fog_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth();\n#endif\n"},s="__LUMA_INJECT_DECLARATIONS__",a=/void\s+main\s*\([^)]*\)\s*\{\n?/,c=/}\n?[^{}]*$/,u=[];function l(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const l=e===r.H;for(const e in n){const r=n[e];r.sort(((t,e)=>t.order-e.order)),u.length=r.length;for(let t=0,e=r.length;t<e;++t)u[t]=r[t].injection;const i="".concat(u.join("\n"),"\n");switch(e){case"vs:#decl":l&&(t=t.replace(s,i));break;case"vs:#main-start":l&&(t=t.replace(a,(t=>t+i)));break;case"vs:#main-end":l&&(t=t.replace(c,(t=>i+t)));break;case"fs:#decl":l||(t=t.replace(s,i));break;case"fs:#main-start":l||(t=t.replace(a,(t=>t+i)));break;case"fs:#main-end":l||(t=t.replace(c,(t=>i+t)));break;default:t=t.replace(e,(t=>t+i))}}return t=t.replace(s,""),i&&(t=t.replace(/\}\s*$/,(t=>t+o[e]))),t}function h(t){const e={};return(0,i.Z)(Array.isArray(t)&&t.length>1),t.forEach((t=>{for(const n in t)e[n]=e[n]?"".concat(e[n],"\n").concat(t[n]):t[n]})),e}},325502:(t,e,n)=>{"use strict";n.d(e,{O:()=>r});const r={name:"fp32",vs:"#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\nconst float TWO_PI = 6.2831854820251465;\nconst float PI_2 = 1.5707963705062866;\nconst float PI_16 = 0.1963495463132858;\n\nconst float SIN_TABLE_0 = 0.19509032368659973;\nconst float SIN_TABLE_1 = 0.3826834261417389;\nconst float SIN_TABLE_2 = 0.5555702447891235;\nconst float SIN_TABLE_3 = 0.7071067690849304;\n\nconst float COS_TABLE_0 = 0.9807852506637573;\nconst float COS_TABLE_1 = 0.9238795042037964;\nconst float COS_TABLE_2 = 0.8314695954322815;\nconst float COS_TABLE_3 = 0.7071067690849304;\n\nconst float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;\nconst float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;\nconst float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;\nconst float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;\n\nfloat sin_taylor_fp32(float a) {\n  float r, s, t, x;\n\n  if (a == 0.0) {\n    return 0.0;\n  }\n\n  x = -a * a;\n  s = a;\n  r = a;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_3;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_5;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_7;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_9;\n  s = s + t;\n\n  return s;\n}\n\nvoid sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {\n  if (a == 0.0) {\n    sin_t = 0.0;\n    cos_t = 1.0;\n  }\n  sin_t = sin_taylor_fp32(a);\n  cos_t = sqrt(1.0 - sin_t * sin_t);\n}\n\nfloat tan_taylor_fp32(float a) {\n    float sin_a;\n    float cos_a;\n\n    if (a == 0.0) {\n        return 0.0;\n    }\n    float z = floor(a / TWO_PI);\n    float r = a - TWO_PI * z;\n\n    float t;\n    float q = floor(r / PI_2 + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return 1.0 / 0.0;\n    }\n\n    t = r - PI_2 * q;\n\n    q = floor(t / PI_16 + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return 1.0 / 0.0;\n    } else {\n        t = t - PI_16 * q;\n    }\n\n    float u = 0.0;\n    float v = 0.0;\n\n    float sin_t, cos_t;\n    float s, c;\n    sincos_taylor_fp32(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0;\n            v = SIN_TABLE_0;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1;\n            v = SIN_TABLE_1;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2;\n            v = SIN_TABLE_2;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3;\n            v = SIN_TABLE_3;\n        }\n        if (k > 0) {\n            s = u * sin_t + v * cos_t;\n            c = u * cos_t - v * sin_t;\n        } else {\n            s = u * sin_t - v * cos_t;\n            c = u * cos_t + v * sin_t;\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return sin_a / cos_a;\n}\n#endif\n\nfloat tan_fp32(float a) {\n#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\n  return tan_taylor_fp32(a);\n#else\n  return tan(a);\n#endif\n}\n",fs:null}},295644:(t,e,n)=>{"use strict";n.d(e,{N:()=>l,s:()=>h});const r="#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))\n\nstruct AmbientLight {\n vec3 color;\n};\n\nstruct PointLight {\n vec3 color;\n vec3 position;\n vec3 attenuation;\n};\n\nstruct DirectionalLight {\n  vec3 color;\n  vec3 direction;\n};\n\nuniform AmbientLight lighting_uAmbientLight;\nuniform PointLight lighting_uPointLight[MAX_LIGHTS];\nuniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];\nuniform int lighting_uPointLightCount;\nuniform int lighting_uDirectionalLightCount;\n\nuniform bool lighting_uEnabled;\n\nfloat getPointLightAttenuation(PointLight pointLight, float distance) {\n  return pointLight.attenuation.x\n       + pointLight.attenuation.y * distance\n       + pointLight.attenuation.z * distance * distance;\n}\n\n#endif\n",i={lightSources:{}};function o(){let{color:t=[0,0,0],intensity:e=1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.map((t=>t*e/255))}const s={name:"lights",vs:r,fs:r,getUniforms:function t(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i;if("lightSources"in e){const{ambientLight:t,pointLights:n,directionalLights:r}=e.lightSources||{};return t||n&&n.length>0||r&&r.length>0?Object.assign({},function(t){let{ambientLight:e,pointLights:n=[],directionalLights:r=[]}=t;const i={};return i["lighting_uAmbientLight.color"]=e?o(e):[0,0,0],n.forEach(((t,e)=>{i["lighting_uPointLight[".concat(e,"].color")]=o(t),i["lighting_uPointLight[".concat(e,"].position")]=t.position,i["lighting_uPointLight[".concat(e,"].attenuation")]=t.attenuation||[1,0,0]})),i.lighting_uPointLightCount=n.length,r.forEach(((t,e)=>{i["lighting_uDirectionalLight[".concat(e,"].color")]=o(t),i["lighting_uDirectionalLight[".concat(e,"].direction")]=t.direction})),i.lighting_uDirectionalLightCount=r.length,i}({ambientLight:t,pointLights:n,directionalLights:r}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in e){const n={pointLights:[],directionalLights:[]};for(const t of e.lights||[])switch(t.type){case"ambient":n.ambientLight=t;break;case"directional":n.directionalLights.push(t);break;case"point":n.pointLights.push(t)}return t({lightSources:n})}return{}},defines:{MAX_LIGHTS:3}},a="\nuniform float lighting_uAmbient;\nuniform float lighting_uDiffuse;\nuniform float lighting_uShininess;\nuniform vec3  lighting_uSpecularColor;\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {\n    vec3 halfway_direction = normalize(light_direction + view_direction);\n    float lambertian = dot(light_direction, normal_worldspace);\n    float specular = 0.0;\n    if (lambertian > 0.0) {\n      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\n      specular = pow(specular_angle, lighting_uShininess);\n    }\n    lambertian = max(lambertian, 0.0);\n    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;\n}\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = surfaceColor;\n\n  if (lighting_uEnabled) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uPointLightCount) {\n        break;\n      }\n      PointLight pointLight = lighting_uPointLight[i];\n      vec3 light_position_worldspace = pointLight.position;\n      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n    }\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uDirectionalLightCount) {\n        break;\n      }\n      DirectionalLight directionalLight = lighting_uDirectionalLight[i];\n      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n    }\n  }\n  return lightColor;\n}\n\nvec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = vec3(0, 0, 0);\n  vec3 surfaceColor = vec3(0, 0, 0);\n\n  if (lighting_uEnabled) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uPointLightCount) {\n        break;\n      }\n      PointLight pointLight = lighting_uPointLight[i];\n      vec3 light_position_worldspace = pointLight.position;\n      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n    }\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uDirectionalLightCount) {\n        break;\n      }\n      DirectionalLight directionalLight = lighting_uDirectionalLight[i];\n      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n    }\n  }\n  return lightColor;\n}\n",c={};function u(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c;if(!("material"in t))return{};const{material:e}=t;return e?function(t){const{ambient:e=.35,diffuse:n=.6,shininess:r=32,specularColor:i=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:n,lighting_uShininess:r,lighting_uSpecularColor:i.map((t=>t/255))}}(e):{lighting_uEnabled:!1}}const l={name:"gouraud-lighting",dependencies:[s],vs:a,defines:{LIGHTING_VERTEX:1},getUniforms:u},h={name:"phong-lighting",dependencies:[s],fs:a,defines:{LIGHTING_FRAGMENT:1},getUniforms:u}},983330:(t,e,n)=>{"use strict";n.d(e,{q:()=>i});const r={pickingSelectedColor:null,pickingHighlightColor:new Uint8Array([0,255,255,255]),pickingActive:!1,pickingAttribute:!1},i={name:"picking",vs:"uniform bool picking_uActive;\nuniform bool picking_uAttribute;\nuniform vec3 picking_uSelectedColor;\nuniform bool picking_uSelectedColorValid;\n\nout vec4 picking_vRGBcolor_Avalid;\n\nconst float COLOR_SCALE = 1. / 255.;\n\nbool picking_isColorValid(vec3 color) {\n  return dot(color, vec3(1.0)) > 0.001;\n}\n\nbool isVertexPicked(vec3 vertexColor) {\n  return\n    picking_uSelectedColorValid &&\n    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));\n}\n\nvoid picking_setPickingColor(vec3 pickingColor) {\n  if (picking_uActive) {\n    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));\n\n    if (!picking_uAttribute) {\n      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;\n    }\n  } else {\n    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));\n  }\n}\n\nvoid picking_setPickingAttribute(float value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.r = value;\n  }\n}\nvoid picking_setPickingAttribute(vec2 value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.rg = value;\n  }\n}\nvoid picking_setPickingAttribute(vec3 value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.rgb = value;\n  }\n}\n",fs:"uniform bool picking_uActive;\nuniform vec3 picking_uSelectedColor;\nuniform vec4 picking_uHighlightColor;\n\nin vec4 picking_vRGBcolor_Avalid;\nvec4 picking_filterHighlightColor(vec4 color) {\n  if (picking_uActive) {\n    return color;\n  }\n  bool selected = bool(picking_vRGBcolor_Avalid.a);\n\n  if (selected) {\n    float highLightAlpha = picking_uHighlightColor.a;\n    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);\n    float highLightRatio = highLightAlpha / blendedAlpha;\n\n    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);\n    return vec4(blendedRGB, blendedAlpha);\n  } else {\n    return color;\n  }\n}\nvec4 picking_filterPickingColor(vec4 color) {\n  if (picking_uActive) {\n    if (picking_vRGBcolor_Avalid.a == 0.0) {\n      discard;\n    }\n    return picking_vRGBcolor_Avalid;\n  }\n  return color;\n}\nvec4 picking_filterColor(vec4 color) {\n  vec4 highightColor = picking_filterHighlightColor(color);\n  return picking_filterPickingColor(highightColor);\n}\n\n",getUniforms:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r;const e={};if(void 0!==t.pickingSelectedColor)if(t.pickingSelectedColor){const n=t.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=n}else e.picking_uSelectedColorValid=0;if(t.pickingHighlightColor){const n=Array.from(t.pickingHighlightColor,(t=>t/255));Number.isFinite(n[3])||(n[3]=1),e.picking_uHighlightColor=n}return void 0!==t.pickingActive&&(e.picking_uActive=Boolean(t.pickingActive),e.picking_uAttribute=Boolean(t.pickingAttribute)),e}}},229047:(t,e,n)=>{"use strict";function r(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}n.d(e,{Z:()=>r})},714072:(t,e,n)=>{"use strict";n.d(e,{Z:()=>c});var r=n(109335),i=n(822525),o=n(482610);const s={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},a={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class c{static getBytesPerElement(t){return(0,r.vN)(t.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(t){return(0,i.h)(t.size),(0,r.vN)(t.type||5126).BYTES_PER_ELEMENT*t.size}static resolve(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return new c(...[s,...e])}constructor(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e.forEach((t=>this._assign(t))),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return c.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return c.getBytesPerVertex(this)}_assign(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t=(0,o.k)("Accessor",t,a),void 0!==t.type&&(this.type=t.type,5124!==t.type&&5125!==t.type||(this.integer=!0)),void 0!==t.size&&(this.size=t.size),void 0!==t.offset&&(this.offset=t.offset),void 0!==t.stride&&(this.stride=t.stride),void 0!==t.normalized&&(this.normalized=t.normalized),void 0!==t.integer&&(this.integer=t.integer),void 0!==t.divisor&&(this.divisor=t.divisor),void 0!==t.buffer&&(this.buffer=t.buffer),void 0!==t.index&&("boolean"==typeof t.index?this.index=t.index?1:0:this.index=t.index),void 0!==t.instanced&&(this.divisor=t.instanced?1:0),void 0!==t.isInstanced&&(this.divisor=t.isInstanced?1:0),this}}},53478:(t,e,n)=>{"use strict";n.d(e,{Z:()=>d});var r=n(787577),i=n(714072),o=n(109335),s=n(739450),a=n(822525),c=n(482610);const u={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},l={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:u},h={removedProps:u};class d extends r.Z{get[Symbol.toStringTag](){return"Buffer"}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t,e),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=e.target||(this.gl.webgl2?36662:34962),this.initialize(e),Object.seal(this)}getElementCount(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.accessor;return Math.round(this.byteLength/i.Z.getBytesPerElement(t))}getVertexCount(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.accessor;return Math.round(this.byteLength/i.Z.getBytesPerVertex(t))}initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return ArrayBuffer.isView(t)&&(t={data:t}),Number.isFinite(t)&&(t={byteLength:t}),t=(0,c.k)("Buffer",t,l),this.usage=t.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},t,t.accessor)),t.data?this._setData(t.data,t.offset,t.byteLength):this._setByteLength(t.byteLength||0),this}setProps(t){return"accessor"in(t=(0,c.k)("Buffer",t,h))&&this.setAccessor(t.accessor),this}setAccessor(t){return delete(t=Object.assign({},t)).buffer,this.accessor=new i.Z(t),this}reallocate(t){return t>this.byteLength?(this._setByteLength(t),!0):(this.bytesUsed=t,!1)}setData(t){return this.initialize(t)}subData(t){ArrayBuffer.isView(t)&&(t={data:t});const{data:e,offset:n=0,srcOffset:r=0}=t,i=t.byteLength||t.length;(0,a.h)(e);const o=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(o,this.handle),0!==r||void 0!==i?((0,s.KQ)(this.gl),this.gl.bufferSubData(this.target,n,e,r,i)):this.gl.bufferSubData(o,n,e),this.gl.bindBuffer(o,null),this.debugData=null,this._inferType(e),this}copyData(t){let{sourceBuffer:e,readOffset:n=0,writeOffset:r=0,size:i}=t;const{gl:o}=this;return(0,s.KQ)(o),o.bindBuffer(36662,e.handle),o.bindBuffer(36663,this.handle),o.copyBufferSubData(36662,36663,n,r,i),o.bindBuffer(36662,null),o.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:t=null,srcByteOffset:e=0,dstOffset:n=0,length:r=0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,s.KQ)(this.gl);const i=(0,o.vN)(this.accessor.type||5126,{clamped:!1}),c=this._getAvailableElementCount(e),u=n;let l,h;t?(h=t.length,l=h-u):(l=Math.min(c,r||c),h=u+l);const d=Math.min(c,l);return r=r||d,(0,a.h)(r<=d),t=t||new i(h),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,t,n,r),this.gl.bindBuffer(36662,null),t}bind(){let{target:t=this.target,index:e=this.accessor&&this.accessor.index,offset:n=0,size:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return 35345===t||35982===t?void 0!==r?this.gl.bindBufferRange(t,e,this.handle,n,r):((0,a.h)(0===n),this.gl.bindBufferBase(t,e,this.handle)):this.gl.bindBuffer(t,this.handle),this}unbind(){let{target:t=this.target,index:e=this.accessor&&this.accessor.index}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return 35345===t||35982===t?this.gl.bindBufferBase(t,e,null):this.gl.bindBuffer(t,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(10,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.byteLength+e;(0,a.h)(ArrayBuffer.isView(t)),this._trackDeallocatedMemory();const r=this._getTarget();this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,n,this.usage),this.gl.bufferSubData(r,e,t),this.gl.bindBuffer(r,null),this.debugData=t.slice(0,10),this.bytesUsed=n,this._trackAllocatedMemory(n);const s=(0,o.O)(t);return(0,a.h)(s),this.setAccessor(new i.Z(this.accessor,{type:s})),this}_setByteLength(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.usage;(0,a.h)(t>=0),this._trackDeallocatedMemory();let n=t;0===t&&(n=new Float32Array(0));const r=this._getTarget();return this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,n,e),this.gl.bindBuffer(r,null),this.usage=e,this.debugData=null,this.bytesUsed=t,this._trackAllocatedMemory(t),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(t){const e=t/(0,o.vN)(this.accessor.type||5126,{clamped:!1}).BYTES_PER_ELEMENT;return this.getElementCount()-e}_inferType(t){this.accessor.type||this.setAccessor(new i.Z(this.accessor,{type:(0,o.O)(t)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(t){this.gl.bindBuffer(this.target,this.handle);const e=this.gl.getBufferParameter(this.target,t);return this.gl.bindBuffer(this.target,null),e}get type(){return s.cM.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return s.cM.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(t){return s.cM.deprecated("setByteLength","reallocate")(),this.reallocate(t)}updateAccessor(t){return s.cM.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new i.Z(this.accessor,t),this}}},526047:(t,e,n)=>{"use strict";n.d(e,{$:()=>g,Z:()=>f});var r=n(739450),i=n(822525);const o=256,s=1024,a=16384,c=6144,u=6145,l=6146,h=34041,d="clear: bad arguments";function f(t){let{framebuffer:e=null,color:n=null,depth:c=null,stencil:u=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const l={};e&&(l.framebuffer=e);let h=0;n&&(h|=a,!0!==n&&(l.clearColor=n)),c&&(h|=o,!0!==c&&(l.clearDepth=c)),u&&(h|=s,!0!==c&&(l.clearStencil=c)),(0,i.h)(0!==h,d),(0,r.s8)(t,l,(()=>{t.clear(h)}))}function g(t){let{framebuffer:e=null,buffer:n=c,drawBuffer:o=0,value:s=[0,0,0,0]}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,r.KQ)(t),(0,r.s8)(t,{framebuffer:e},(()=>{switch(n){case c:switch(s.constructor){case Int32Array:t.clearBufferiv(n,o,s);break;case Uint32Array:t.clearBufferuiv(n,o,s);break;case Float32Array:default:t.clearBufferfv(n,o,s)}break;case u:t.clearBufferfv(u,0,[s]);break;case l:t.clearBufferiv(l,0,[s]);break;case h:const[e,r]=s;t.clearBufferfi(h,0,e,r);break;default:(0,i.h)(!1,d)}}))}},601953:(t,e,n)=>{"use strict";n.d(e,{Km:()=>l,Lv:()=>h,z6:()=>u});var r=n(53849),i=n(135008),o=n(739450),s=n(109335),a=n(822525),c=n(495432);function u(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{sourceX:n=0,sourceY:r=0,sourceFormat:i=6408}=e;let{sourceAttachment:o=36064,target:c=null,sourceWidth:u,sourceHeight:l,sourceType:h}=e;const{framebuffer:f,deleteFramebuffer:g}=d(t);(0,a.h)(f);const{gl:p,handle:m,attachments:b}=f;u=u||f.width,l=l||f.height,36064===o&&null===m&&(o=1028),(0,a.h)(b[o]),h=h||b[o].type,c=function(t,e,n,r,i){if(t)return t;e=e||5121;const o=(0,s.vN)(e,{clamped:!1}),c=function(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return(0,a.h)(!1),0}}(n);return new o(r*i*c)}(c,h,i,u,l),h=h||(0,s.O)(c);const _=p.bindFramebuffer(36160,m);return p.readPixels(n,r,u,l,i,h,c),p.bindFramebuffer(36160,_||null),g&&f.delete(),c}function l(t){let{sourceAttachment:e=36064,targetMaxHeight:n=Number.MAX_SAFE_INTEGER}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=u(t,{sourceAttachment:e}),{width:i,height:o}=t;for(;o>n;)({data:r,width:i,height:o}=(0,s.KS)({data:r,width:i,height:o}));(0,s.c$)({data:r,width:i,height:o});const a=document.createElement("canvas");a.width=i,a.height=o;const c=a.getContext("2d"),l=c.createImageData(i,o);return l.data.set(r),c.putImageData(l,0,0),a.toDataURL()}function h(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{sourceX:r=0,sourceY:s=0,targetMipmaplevel:c=0,targetInternalFormat:u=6408}=n;let{targetX:l,targetY:h,targetZ:f,width:g,height:p}=n;const{framebuffer:m,deleteFramebuffer:b}=d(t);(0,a.h)(m);const{gl:_,handle:v}=m,y=void 0!==l||void 0!==h||void 0!==f;l=l||0,h=h||0,f=f||0;const A=_.bindFramebuffer(36160,v);(0,a.h)(e);let x=null;if(e instanceof i.Z&&(x=e,g=Number.isFinite(g)?g:x.width,p=Number.isFinite(p)?p:x.height,x.bind(0),e=x.target),y)switch(e){case 3553:case 34067:_.copyTexSubImage2D(e,c,l,h,r,s,g,p);break;case 35866:case 32879:(0,o.KQ)(_).copyTexSubImage3D(e,c,l,h,f,r,s,g,p)}else _.copyTexImage2D(e,c,u,r,s,g,p,0);return x&&x.unbind(),_.bindFramebuffer(36160,A||null),b&&m.delete(),x}function d(t){return t instanceof r.Z?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:(0,c.Y)(t),deleteFramebuffer:!0}}},53849:(t,e,n)=>{"use strict";n.d(e,{Z:()=>f});var r=n(739450),i=n(787577),o=n(904912),s=n(149830),a=n(526047),c=n(601953),u=n(844211),l=n(779579),h=n(822525);const d="Multiple render targets not supported";class f extends i.Z{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{colorBufferFloat:n,colorBufferHalfFloat:r}=e;let i=!0;return n&&(i=Boolean(t.getExtension("EXT_color_buffer_float")||t.getExtension("WEBGL_color_buffer_float")||t.getExtension("OES_texture_float"))),r&&(i=i&&Boolean(t.getExtension("EXT_color_buffer_float")||t.getExtension("EXT_color_buffer_half_float"))),i}static getDefaultFramebuffer(t){return t.luma=t.luma||{},t.luma.defaultFramebuffer=t.luma.defaultFramebuffer||new f(t,{id:"default-framebuffer",handle:null,attachments:{}}),t.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const t=(0,r.KQ)(this.gl);return t.getParameter(t.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const t=(0,r.KQ)(this.gl);return t.getParameter(t.MAX_DRAW_BUFFERS)}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t,e),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(e),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(t){let{width:e=1,height:n=1,attachments:r=null,color:i=!0,depth:o=!0,stencil:s=!1,check:a=!0,readBuffer:c,drawBuffers:u}=t;if((0,h.h)(e>=0&&n>=0,"Width and height need to be integers"),this.width=e,this.height=n,r)for(const t in r){const i=r[t];(Array.isArray(i)?i[0]:i).resize({width:e,height:n})}else r=this._createDefaultAttachments(i,o,s,e,n);this.update({clearAttachments:!0,attachments:r,readBuffer:c,drawBuffers:u}),r&&a&&this.checkStatus()}delete(){for(const t of this.ownResources)t.delete();return super.delete(),this}update(t){let{attachments:e={},readBuffer:n,drawBuffers:r,clearAttachments:i=!1,resizeAttachments:o=!0}=t;this.attach(e,{clearAttachments:i,resizeAttachments:o});const{gl:s}=this,a=s.bindFramebuffer(36160,this.handle);return n&&this._setReadBuffer(n),r&&this._setDrawBuffers(r),s.bindFramebuffer(36160,a||null),this}resize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{width:e,height:n}=t;if(null===this.handle)return(0,h.h)(void 0===e&&void 0===n),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;void 0===e&&(e=this.gl.drawingBufferWidth),void 0===n&&(n=this.gl.drawingBufferHeight),e!==this.width&&n!==this.height&&r.cM.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(e,"x").concat(n))();for(const t in this.attachments)this.attachments[t].resize({width:e,height:n});return this.width=e,this.height=n,this}attach(t){let{clearAttachments:e=!1,resizeAttachments:n=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r={};e&&Object.keys(this.attachments).forEach((t=>{r[t]=null})),Object.assign(r,t);const i=this.gl.bindFramebuffer(36160,this.handle);for(const t in r){(0,h.h)(void 0!==t,"Misspelled framebuffer binding point?");const e=Number(t),i=r[e];let o=i;if(o)if(o instanceof s.Z)this._attachRenderbuffer({attachment:e,renderbuffer:o});else if(Array.isArray(i)){const[t,n=0,r=0]=i;o=t,this._attachTexture({attachment:e,texture:t,layer:n,level:r})}else this._attachTexture({attachment:e,texture:o,layer:0,level:0});else this._unattach(e);n&&o&&o.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,i||null),Object.assign(this.attachments,t),Object.keys(this.attachments).filter((t=>!this.attachments[t])).forEach((t=>{delete this.attachments[t]}))}checkStatus(){const{gl:t}=this,e=this.getStatus();if(36053!==e)throw new Error(function(t){return(f.STATUS||{})[t]||"Framebuffer error ".concat(t)}(e));return this}getStatus(){const{gl:t}=this,e=t.bindFramebuffer(36160,this.handle),n=t.checkFramebufferStatus(36160);return t.bindFramebuffer(36160,e||null),n}clear(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{color:e,depth:n,stencil:r,drawBuffers:i=[]}=t,o=this.gl.bindFramebuffer(36160,this.handle);return(e||n||r)&&(0,a.Z)(this.gl,{color:e,depth:n,stencil:r}),i.forEach(((t,e)=>{(0,a.$)(this.gl,{drawBuffer:e,value:t})})),this.gl.bindFramebuffer(36160,o||null),this}readPixels(){return r.cM.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return r.cM.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return r.cM.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return r.cM.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return r.cM.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return r.cM.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(t){let{attachments:e=[],x:n=0,y:i=0,width:o,height:s}=t;const a=(0,r.KQ)(this.gl),c=a.bindFramebuffer(36008,this.handle);return 0===n&&0===i&&void 0===o&&void 0===s?a.invalidateFramebuffer(36008,e):a.invalidateFramebuffer(36008,e,n,i,o,s),a.bindFramebuffer(36008,c),this}getAttachmentParameter(t,e,n){let r=this._getAttachmentParameterFallback(e);return null===r&&(this.gl.bindFramebuffer(36160,this.handle),r=this.gl.getFramebufferAttachmentParameter(36160,t,e),this.gl.bindFramebuffer(36160,null)),n&&r>1e3&&(r=(0,l.km)(this.gl,r)),r}getAttachmentParameters(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:36064,e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const r={};for(const i of n)r[e?(0,l.km)(this.gl,i):i]=this.getAttachmentParameter(t,i,e);return r}getParameters(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const e=Object.keys(this.attachments),n={};for(const r of e){const e=Number(r);n[t?(0,l.km)(this.gl,e):e]=this.getAttachmentParameters(e,t)}return n}show(){return"undefined"!=typeof window&&window.open((0,c.Km)(this),"luma-debug-texture"),this}log(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(t>r.cM.level||"undefined"==typeof window)return this;e=e||"Framebuffer ".concat(this.id);const n=(0,c.Km)(this,{targetMaxHeight:100});return r.cM.image({logLevel:t,message:e,image:n},e)(),this}bind(){let{target:t=36160}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.gl.bindFramebuffer(t,this.handle),this}unbind(){let{target:t=36160}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.gl.bindFramebuffer(t,null),this}_createDefaultAttachments(t,e,n,r,i){let a=null;return t&&(a=a||{},a[36064]=new o.Z(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:r,height:i,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(a[36064])),e&&n?(a=a||{},a[33306]=new s.Z(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:r,height:111}),this.ownResources.push(a[33306])):e?(a=a||{},a[36096]=new s.Z(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:r,height:i}),this.ownResources.push(a[36096])):n&&(0,h.h)(!1),a}_unattach(t){const e=this.attachments[t];e&&(e instanceof s.Z?this.gl.framebufferRenderbuffer(36160,t,36161,null):this.gl.framebufferTexture2D(36160,t,3553,null,0),delete this.attachments[t])}_attachRenderbuffer(t){let{attachment:e=36064,renderbuffer:n}=t;const{gl:r}=this;r.framebufferRenderbuffer(36160,e,36161,n.handle),this.attachments[e]=n}_attachTexture(t){let{attachment:e=36064,texture:n,layer:i,level:o}=t;const{gl:s}=this;switch(s.bindTexture(n.target,n.handle),n.target){case 35866:case 32879:(0,r.KQ)(s).framebufferTextureLayer(36160,e,n.target,o,i);break;case 34067:const t=function(t){return t<34069?t+34069:t}(i);s.framebufferTexture2D(36160,e,t,n.handle,o);break;case 3553:s.framebufferTexture2D(36160,e,3553,n.handle,o);break;default:(0,h.h)(!1,"Illegal texture type")}s.bindTexture(n.target,null),this.attachments[e]=n}_setReadBuffer(t){const e=(0,r.vd)(this.gl);e?e.readBuffer(t):(0,h.h)(36064===t||1029===t,d),this.readBuffer=t}_setDrawBuffers(t){const{gl:e}=this,n=(0,r.KQ)(e);if(n)n.drawBuffers(t);else{const n=e.getExtension("WEBGL_draw_buffers");n?n.drawBuffersWEBGL(t):(0,h.h)(1===t.length&&(36064===t[0]||1029===t[0]),d)}this.drawBuffers=t}_getAttachmentParameterFallback(t){const e=(0,u.N$)(this.gl);switch(t){case 36052:return e.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return e.WEBGL2?null:8;case 33297:return e.WEBGL2?null:5125;case 33296:return e.WEBGL2||e.EXT_sRGB?null:9729;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(t){return this.gl.bindFramebuffer(36160,t)}}f.ATTACHMENT_PARAMETERS=[36049,36048,33296,33298,33299,33300,33301,33302,33303]},807944:(t,e,n)=>{"use strict";n.d(e,{Z:()=>U});var r=n(787577),i=n(135008),o=n(53849),s=n(739450),a=n(149830),c=n(822525);const u={5126:E.bind(null,"uniform1fv",p,1,T),35664:E.bind(null,"uniform2fv",p,2,T),35665:E.bind(null,"uniform3fv",p,3,T),35666:E.bind(null,"uniform4fv",p,4,T),5124:E.bind(null,"uniform1iv",m,1,T),35667:E.bind(null,"uniform2iv",m,2,T),35668:E.bind(null,"uniform3iv",m,3,T),35669:E.bind(null,"uniform4iv",m,4,T),35670:E.bind(null,"uniform1iv",m,1,T),35671:E.bind(null,"uniform2iv",m,2,T),35672:E.bind(null,"uniform3iv",m,3,T),35673:E.bind(null,"uniform4iv",m,4,T),35674:E.bind(null,"uniformMatrix2fv",p,4,w),35675:E.bind(null,"uniformMatrix3fv",p,9,w),35676:E.bind(null,"uniformMatrix4fv",p,16,w),35678:x,35680:x,5125:E.bind(null,"uniform1uiv",b,1,T),36294:E.bind(null,"uniform2uiv",b,2,T),36295:E.bind(null,"uniform3uiv",b,3,T),36296:E.bind(null,"uniform4uiv",b,4,T),35685:E.bind(null,"uniformMatrix2x3fv",p,6,w),35686:E.bind(null,"uniformMatrix2x4fv",p,8,w),35687:E.bind(null,"uniformMatrix3x2fv",p,6,w),35688:E.bind(null,"uniformMatrix3x4fv",p,12,w),35689:E.bind(null,"uniformMatrix4x2fv",p,8,w),35690:E.bind(null,"uniformMatrix4x3fv",p,12,w),35678:x,35680:x,35679:x,35682:x,36289:x,36292:x,36293:x,36298:x,36299:x,36300:x,36303:x,36306:x,36307:x,36308:x,36311:x},l={},h={},d={},f=[0];function g(t,e,n,r){1===e&&"boolean"==typeof t&&(t=t?1:0),Number.isFinite(t)&&(f[0]=t,t=f);const i=t.length;if(i%e&&s.cM.warn("Uniform size should be multiples of ".concat(e),t)(),t instanceof n)return t;let o=r[i];o||(o=new n(i),r[i]=o);for(let e=0;e<i;e++)o[e]=t[e];return o}function p(t,e){return g(t,e,Float32Array,l)}function m(t,e){return g(t,e,Int32Array,h)}function b(t,e){return g(t,e,Uint32Array,d)}function _(t,e,n){const r=u[n.type];if(!r)throw new Error("Unknown GLSL uniform type ".concat(n.type));return r().bind(null,t,e)}function v(t){if("]"!==t[t.length-1])return{name:t,length:1,isArray:!1};const e=t.match(/([^[]*)(\[[0-9]+\])?/);if(!e||e.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:e[1],length:e[2]||1,isArray:Boolean(e[2])}}function y(t){return Array.isArray(t)||ArrayBuffer.isView(t)?function(t){if(0===t.length)return!1;const e=Math.min(t.length,16);for(let n=0;n<e;++n)if(!Number.isFinite(t[n]))return!1;return!0}(t):!!isFinite(t)||!0===t||!1===t||t instanceof i.Z||t instanceof a.Z||t instanceof o.Z&&Boolean(t.texture)}function A(t,e,n){if(Array.isArray(n)||ArrayBuffer.isView(n))if(t[e]){const r=t[e];for(let t=0,e=n.length;t<e;++t)r[t]=n[t]}else t[e]=n.slice();else t[e]=n}function x(){let t=null;return(e,n,r)=>{const i=t!==r;return i&&(e.uniform1i(n,r),t=r),i}}function E(t,e,n,r){let i=null,o=null;return(s,a,u)=>{const l=e(u,n),h=l.length;let d=!1;if(null===i)i=new Float32Array(h),o=h,d=!0;else{(0,c.h)(o===h,"Uniform length cannot change.");for(let t=0;t<h;++t)if(l[t]!==i[t]){d=!0;break}}return d&&(r(s,t,a,l),i.set(l)),d}}function T(t,e,n,r){t[e](n,r)}function w(t,e,n,r){t[e](n,!1,r)}function C(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unnamed";const n=t.match(/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/);return n?n[1]:e}function S(t,e){let n="";for(let r=0;r<e.length;r++){const i=e[r];if((t[r+3]||t[r+2]||t[r+1])&&(n+="".concat(i,"\n"),t[r+1])){const e=t[r+1],i=e.split(":",3),o=i[0],s=parseInt(i[1],10)||0,a=e.substring(i.join(":").length+1).trim();n+=L("^^^ ".concat(o,": ").concat(a,"\n\n"),s)}}return n}function L(t,e){let n="";for(let t=0;t<e;++t)n+=" ";return"".concat(n).concat(t)}var O=n(574538);class I extends r.Z{get[Symbol.toStringTag](){return"Shader"}static getTypeName(t){switch(t){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return(0,c.h)(!1),"unknown"}}constructor(t,e){(0,s.JD)(t),(0,c.h)("string"==typeof e.source,"Shader: GLSL source code must be a JavaScript string"),super(t,{id:C(e.source,null)||e.id||(0,O.hQ)("unnamed ".concat(I.getTypeName(e.shaderType)))}),this.shaderType=e.shaderType,this.source=e.source,this.initialize(e)}initialize(t){let{source:e}=t;const n=C(e,null);n&&(this.id=(0,O.hQ)(n)),this._compile(e)}getParameter(t){return this.gl.getShaderParameter(this.handle,t)}toString(){return"".concat(I.getTypeName(this.shaderType),":").concat(this.id)}getName(){return C(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const t=this.gl.getExtension("WEBGL_debug_shaders");return t?t.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.source;if(t.startsWith("#version ")||(t="#version 100\n".concat(t)),this.source=t,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const t=this.gl.getShaderInfoLog(this.handle),{shaderName:e,errors:n,warnings:r}=function(t,e,n,r){const i=t.split(/\r?\n/),o={},s={},a=r||C(e)||"(unnamed)",c="".concat(function(t){switch(t){case 35632:return"fragment";case 35633:return"vertex";default:return"unknown type"}}(n)," shader ").concat(a);for(let e=0;e<i.length;e++){const n=i[e];if(n.length<=1)continue;const r=n.split(":"),a=r[0],u=parseInt(r[2],10);if(isNaN(u))throw new Error("GLSL compilation error in ".concat(c,": ").concat(t));"WARNING"!==a?o[u]=n:s[u]=n}const u=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:": ";const r=t.split(/\r?\n/),i=String(r.length+e-1).length;return r.map(((t,r)=>{const o=String(r+e),s=o.length;return L(o,i-s)+n+t}))}(e);return{shaderName:c,errors:S(o,u),warnings:S(s,u)}}(t,this.source,this.shaderType,this.id);throw s.cM.error("GLSL compilation errors in ".concat(e,"\n").concat(n))(),s.cM.warn("GLSL compilation warnings in ".concat(e,"\n").concat(r))(),new Error("GLSL compilation errors in ".concat(e))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class M extends I{get[Symbol.toStringTag](){return"VertexShader"}constructor(t,e){"string"==typeof e&&(e={source:e}),super(t,Object.assign({},e,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class F extends I{get[Symbol.toStringTag](){return"FragmentShader"}constructor(t,e){"string"==typeof e&&(e={source:e}),super(t,Object.assign({},e,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}var P=n(714072),R=n(738522);class B{constructor(t){this.id=t.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(t),this._readVaryingsFromProgram(t)}getAttributeInfo(t){const e=Number(t);return Number.isFinite(e)?this.attributeInfosByLocation[e]:this.attributeInfosByName[t]||null}getAttributeLocation(t){const e=this.getAttributeInfo(t);return e?e.location:-1}getAttributeAccessor(t){const e=this.getAttributeInfo(t);return e?e.accessor:null}getVaryingInfo(t){const e=Number(t);return Number.isFinite(e)?this.varyingInfos[e]:this.varyingInfosByName[t]||null}getVaryingIndex(t){const e=this.getVaryingInfo();return e?e.location:-1}getVaryingAccessor(t){const e=this.getVaryingInfo();return e?e.accessor:null}_readAttributesFromProgram(t){const{gl:e}=t,n=e.getProgramParameter(t.handle,35721);for(let r=0;r<n;r++){const{name:n,type:i,size:o}=e.getActiveAttrib(t.handle,r),s=e.getAttribLocation(t.handle,n);s>=0&&this._addAttribute(s,n,i,o)}this.attributeInfos.sort(((t,e)=>t.location-e.location))}_readVaryingsFromProgram(t){const{gl:e}=t;if(!(0,s.D0)(e))return;const n=e.getProgramParameter(t.handle,35971);for(let r=0;r<n;r++){const{name:n,type:i,size:o}=e.getTransformFeedbackVarying(t.handle,r);this._addVarying(r,n,i,o)}this.varyingInfos.sort(((t,e)=>t.location-e.location))}_addAttribute(t,e,n,r){const{type:i,components:o}=(0,R.hJ)(n),s={type:i,size:r*o};this._inferProperties(t,e,s);const a={location:t,name:e,accessor:new P.Z(s)};this.attributeInfos.push(a),this.attributeInfosByLocation[t]=a,this.attributeInfosByName[a.name]=a}_inferProperties(t,e,n){/instance/i.test(e)&&(n.divisor=1)}_addVarying(t,e,n,r){const{type:i,components:o}=(0,R.hJ)(n),s={location:t,name:e,accessor:new P.Z({type:i,size:r*o})};this.varyingInfos.push(s),this.varyingInfosByName[s.name]=s}}var N=n(779579);const D=35981,k=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class U extends r.Z{get[Symbol.toStringTag](){return"Program"}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t,e),this.stubRemovedMethods("Program","v6.0",k),this._isCached=!1,this.initialize(e),Object.seal(this),this._setId(e.id)}initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{hash:e,vs:n,fs:r,varyings:i,bufferMode:o=D}=t;return this.hash=e||"",this.vs="string"==typeof n?new M(this.gl,{id:"".concat(t.id,"-vs"),source:n}):n,this.fs="string"==typeof r?new F(this.gl,{id:"".concat(t.id,"-fs"),source:r}):r,(0,c.h)(this.vs instanceof M),(0,c.h)(this.fs instanceof F),this.uniforms={},this._textureUniforms={},i&&i.length>0&&((0,s.KQ)(this.gl),this.varyings=i,this.gl2.transformFeedbackVaryings(this.handle,i,o)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new B(this),this.setProps(t)}delete(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._isCached?this:super.delete(t)}setProps(t){return"uniforms"in t&&this.setUniforms(t.uniforms),this}draw(t){let{logPriority:e,drawMode:n=4,vertexCount:r,offset:i=0,start:o,end:a,isIndexed:u=!1,indexType:l=5123,instanceCount:h=0,isInstanced:d=h>0,vertexArray:f=null,transformFeedback:g,framebuffer:p,parameters:m={},uniforms:b,samplers:_}=t;if((b||_)&&(s.cM.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(b||{})),s.cM.priority>=e){const t=p?p.id:"default",i="mode=".concat((0,N.km)(this.gl,n)," verts=").concat(r," ")+"instances=".concat(h," indexType=").concat((0,N.km)(this.gl,l)," ")+"isInstanced=".concat(d," isIndexed=").concat(u," ")+"Framebuffer=".concat(t);s.cM.log(e,i)()}return(0,c.h)(f),this.gl.useProgram(this.handle),!(!this._areTexturesRenderable()||0===r||d&&0===h||(f.bindForDraw(r,h,(()=>{if(void 0!==p&&(m=Object.assign({},m,{framebuffer:p})),g){const t=(0,R.$Z)(n);g.begin(t)}this._bindTextures(),(0,s.s8)(this.gl,m,(()=>{u&&d?this.gl2.drawElementsInstanced(n,r,l,i,h):u&&(0,s.D0)(this.gl)&&!isNaN(o)&&!isNaN(a)?this.gl2.drawRangeElements(n,o,a,r,l,i):u?this.gl.drawElements(n,r,l,i):d?this.gl2.drawArraysInstanced(n,i,r,h):this.gl.drawArrays(n,i,r)})),g&&g.end()})),0))}setUniforms(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s.cM.priority>=2&&function(t,e,n){for(const r in t){const i=t[r];if((!n||Boolean(n[r]))&&!y(i))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(r),i),new Error("".concat(e," Bad uniform ").concat(r))}}(t,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const e in t){const n=t[e],r=this._uniformSetters[e];if(r){let t=n,s=!1;if(t instanceof o.Z&&(t=t.texture),t instanceof i.Z)if(s=this.uniforms[e]!==n,s){void 0===r.textureIndex&&(r.textureIndex=this._textureIndexCounter++);const n=t,{textureIndex:i}=r;n.bind(i),t=i,this._textureUniforms[e]=n}else t=r.textureIndex;else this._textureUniforms[e]&&delete this._textureUniforms[e];(r(t)||s)&&A(this.uniforms,e,n)}}return this}_areTexturesRenderable(){let t=!0;for(const e in this._textureUniforms){const n=this._textureUniforms[e];n.update(),t=t&&n.loaded}return t}_bindTextures(){for(const t in this._textureUniforms){const e=this._uniformSetters[t].textureIndex;this._textureUniforms[t].bind(e)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(t){const e=this.gl.getAttachedShaders(t),n={};for(const t of e)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:n.vs=new M({handle:t});break;case 35632:n.fs=new F({handle:t})}return n}_getParameter(t){return this.gl.getProgramParameter(this.handle,t)}_setId(t){if(!t){const t=this._getName();this.id=(0,O.hQ)(t)}}_getName(){let t=this.vs.getName()||this.fs.getName();return t=t.replace(/shader/i,""),t=t?"".concat(t,"-program"):"program",t}_compileAndLink(){const{gl:t}=this;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),s.cM.time(4,"linkProgram for ".concat(this._getName()))(),t.linkProgram(this.handle),s.cM.timeEnd(4,"linkProgram for ".concat(this._getName()))(),t.debug||s.cM.level>0){if(!t.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(t.getProgramInfoLog(this.handle)));if(t.validateProgram(this.handle),!t.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(t.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:t}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let e=0;e<this._uniformCount;e++){const n=this.gl.getActiveUniform(this.handle,e),{name:r}=v(n.name);let i=t.getUniformLocation(this.handle,r);if(this._uniformSetters[r]=_(t,i,n),n.size>1)for(let e=0;e<n.size;e++)i=t.getUniformLocation(this.handle,"".concat(r,"[").concat(e,"]")),this._uniformSetters["".concat(r,"[").concat(e,"]")]=_(t,i,n)}this._textureIndexCounter=0}getActiveUniforms(t,e){return this.gl2.getActiveUniforms(this.handle,t,e)}getUniformBlockIndex(t){return this.gl2.getUniformBlockIndex(this.handle,t)}getActiveUniformBlockParameter(t,e){return this.gl2.getActiveUniformBlockParameter(this.handle,t,e)}uniformBlockBinding(t,e){this.gl2.uniformBlockBinding(this.handle,t,e)}}},149830:(t,e,n)=>{"use strict";n.d(e,{Z:()=>c});var r=n(787577);const i="EXT_color_buffer_float",o={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:i,bpp:2},33327:{gl2:i,bpp:4},34842:{gl2:i,bpp:8},33326:{gl2:i,bpp:4},33328:{gl2:i,bpp:8},34836:{gl2:i,bpp:16},35898:{gl2:i,bpp:4}};var s=n(739450),a=n(822525);class c extends r.Z{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(t){let{format:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{format:null};return!e||function(t,e,n){const r=n[e];if(!r)return!1;const i=(0,s.D0)(t)&&r.gl2||r.gl1;return"string"==typeof i?t.getExtension(i):i}(t,e,o)}static getSamplesForFormat(t,e){let{format:n}=e;return t.getInternalformatParameter(36161,n,32937)}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t,e),this.initialize(e),Object.seal(this)}initialize(t){let{format:e,width:n=1,height:r=1,samples:i=0}=t;return(0,a.h)(e,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),0!==i&&(0,s.D0)(this.gl)?this.gl.renderbufferStorageMultisample(36161,i,e,n,r):this.gl.renderbufferStorage(36161,e,n,r),this.format=e,this.width=n,this.height=r,this.samples=i,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*o[this.format].bpp),this}resize(t){let{width:e,height:n}=t;return e!==this.width||n!==this.height?this.initialize({width:e,height:n,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(t){this.gl.bindRenderbuffer(36161,t)}_syncHandle(t){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(t){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,t)}}},787577:(t,e,n)=>{"use strict";n.d(e,{Z:()=>l});var r=n(739450),i=n(149835),o=n(779579),s=n(822525),a=n(574538),c=n(737469);const u="Resource subclass must define virtual methods";class l{get[Symbol.toStringTag](){return"Resource"}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,r.JD)(t);const{id:n,userData:i={}}=e;this.gl=t,this.gl2=t,this.id=n||(0,a.hQ)(this[Symbol.toStringTag]),this.userData=i,this._bound=!1,this._handle=e.handle,void 0===this._handle&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,e&&t&&e.filter(Boolean).forEach((t=>t.delete())),this}bind(){let t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.handle;return"function"!=typeof e?(this._bindHandle(e),this):(this._bound?t=e():(this._bindHandle(this.handle),this._bound=!0,t=e(),this._bound=!1,this._bindHandle(null)),t)}unbind(){this.bind(null)}getParameter(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t=(0,o.sF)(this.gl,t),(0,s.h)(t);const n=(this.constructor.PARAMETERS||{})[t];if(n){const t=(0,r.D0)(this.gl);if("webgl2"in n&&!t||"extension"in n&&!this.gl.getExtension(n.extension)){const e=n.webgl1,r="webgl2"in n?n.webgl2:n.webgl1;return t?r:e}}return this._getParameter(t,e)}getParameters(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{parameters:e,keys:n}=t,i=this.constructor.PARAMETERS||{},s=(0,r.D0)(this.gl),a={},c=e||Object.keys(i);for(const e of c){const r=i[e];if(r&&(!("webgl2"in r)||s)&&(!("extension"in r)||this.gl.getExtension(r.extension))){const i=n?(0,o.km)(this.gl,e):e;a[i]=this.getParameter(e,t),n&&"GLenum"===r.type&&(a[i]=(0,o.km)(this.gl,a[i]))}}return a}setParameter(t,e){t=(0,o.sF)(this.gl,t),(0,s.h)(t);const n=(this.constructor.PARAMETERS||{})[t];if(n){const t=(0,r.D0)(this.gl);if("webgl2"in n&&!t||"extension"in n&&!this.gl.getExtension(n.extension))throw new Error("Parameter not available on this platform");"GLenum"===n.type&&(e=(0,o.sF)(e))}return this._setParameter(t,e),this}setParameters(t){for(const e in t)this.setParameter(e,t[e]);return this}stubRemovedMethods(t,e,n){return(0,c.F)(this,t,e,n)}initialize(t){}_createHandle(){throw new Error(u)}_deleteHandle(){throw new Error(u)}_bindHandle(t){throw new Error(u)}_getOptsFromHandle(){throw new Error(u)}_getParameter(t,e){throw new Error(u)}_setParameter(t,e){throw new Error(u)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const t=this[Symbol.toStringTag],e=i.lR.get("Resource Counts");e.get("Resources Created").incrementCount(),e.get("".concat(t,"s Created")).incrementCount(),e.get("".concat(t,"s Active")).incrementCount()}_removeStats(){const t=this[Symbol.toStringTag];i.lR.get("Resource Counts").get("".concat(t,"s Active")).decrementCount()}_trackAllocatedMemory(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(t,e),this._trackAllocatedMemoryForContext(t,e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=t}_trackAllocatedMemoryForContext(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this[Symbol.toStringTag],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const r=i.lR.get("Memory Usage".concat(n));r.get("GPU Memory").addCount(t),r.get("".concat(e," Memory")).addCount(t)}_trackDeallocatedMemory(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(t),this._trackDeallocatedMemoryForContext(t,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this[Symbol.toStringTag],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=i.lR.get("Memory Usage".concat(e));n.get("GPU Memory").subtractCount(this.byteLength),n.get("".concat(t," Memory")).subtractCount(this.byteLength)}}},904912:(t,e,n)=>{"use strict";n.d(e,{Z:()=>s});var r=n(739450),i=n(135008),o=n(822525);class s extends i.Z{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(t,e){return i.Z.isSupported(t,e)}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;(0,r.JD)(t),(e instanceof Promise||"string"==typeof e)&&(e={data:e}),"string"==typeof e.data&&(e=Object.assign({},e,{data:(n=e.data,(0,o.h)("string"==typeof n),n=""+n,new Promise(((t,e)=>{try{const r=new Image;r.onload=()=>t(r),r.onerror=()=>e(new Error("Could not load image ".concat(n,"."))),r.crossOrigin="anonymous",r.src=n}catch(t){e(t)}})))})),super(t,Object.assign({},e,{target:3553})),this.initialize(e),Object.seal(this)}}},33889:(t,e,n)=>{"use strict";n.d(e,{C:()=>o,KR:()=>c,ae:()=>i,br:()=>a,pH:()=>s});var r=n(739450);const i={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},o={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},s={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function a(t,e){const n=i[e];if(!n)return!1;if(void 0===n.gl1&&void 0===n.gl2)return!0;const o=(0,r.D0)(t)&&n.gl2||n.gl1;return"string"==typeof o?t.getExtension(o):o}function c(t,e){const n=i[e];switch(n&&n.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}},135008:(t,e,n)=>{"use strict";n.d(e,{Z:()=>h});var r=n(739450),i=n(787577),o=n(53478),s=n(33889),a=n(822525),c=n(574538);const u=[9729,9728],l=globalThis.WebGLBuffer||function(){};class h extends i.Z{get[Symbol.toStringTag](){return"Texture"}static isSupported(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{format:n,linearFiltering:r}=e;let i=!0;return n&&(i=i&&(0,s.br)(t,n),i=i&&(!r||(0,s.KR)(t,n))),i}constructor(t,e){const{id:n=(0,c.hQ)("texture"),handle:r,target:i}=e;super(t,{id:n,handle:r}),this.target=i,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.data;if(e instanceof Promise)return e.then((e=>this.initialize(Object.assign({},t,{pixels:e,data:e})))),this;const n="undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement;if(n&&e.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,e.addEventListener("loadeddata",(()=>this.initialize(t))),this;const{pixels:i=null,format:o=6408,border:s=0,recreate:a=!1,parameters:c={},pixelStore:u={},textureUnit:l}=t;e||(e=i);let{width:h,height:d,dataFormat:f,type:g,compressed:p=!1,mipmaps:m=!0}=t;const{depth:b=0}=t;return({width:h,height:d,compressed:p,dataFormat:f,type:g}=this._deduceParameters({format:o,type:g,dataFormat:f,compressed:p,data:e,width:h,height:d})),this.width=h,this.height=d,this.depth=b,this.format=o,this.type=g,this.dataFormat=f,this.border=s,this.textureUnit=l,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),m&&this._isNPOT()&&(r.cM.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),m=!1,this._updateForNPOT(c)),this.mipmaps=m,this.setImageData({data:e,width:h,height:d,depth:b,format:o,type:g,dataFormat:f,border:s,mipmaps:m,parameters:u,compressed:p}),m&&this.generateMipmap(),this.setParameters(c),a&&(this.data=e),n&&(this._video={video:e,parameters:c,lastTime:e.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?e.currentTime:-1}),this}update(){if(this._video){const{video:t,parameters:e,lastTime:n}=this._video;if(n===t.currentTime||t.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:t,parameters:e}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=t.currentTime}}resize(t){let{height:e,width:n,mipmaps:r=!1}=t;return n!==this.width||e!==this.height?this.initialize({width:n,height:e,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:r}):this}generateMipmap(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._isNPOT()?(r.cM.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),(0,r.s8)(this.gl,t,(()=>{this.gl.generateMipmap(this.target)})),this.gl.bindTexture(this.target,null),this)}setImageData(t){this._trackDeallocatedMemory("Texture");const{target:e=this.target,pixels:n=null,level:i=0,format:o=this.format,border:c=this.border,offset:u=0,parameters:l={}}=t;let{data:h=null,type:d=this.type,width:f=this.width,height:g=this.height,dataFormat:p=this.dataFormat,compressed:m=!1}=t;h||(h=n),({type:d,dataFormat:p,compressed:m,width:f,height:g}=this._deduceParameters({format:o,type:d,dataFormat:p,compressed:m,data:h,width:f,height:g}));const{gl:b}=this;b.bindTexture(this.target,this.handle);let _,v=null;({data:h,dataType:v}=this._getDataType({data:h,compressed:m}));let y=0;if((0,r.s8)(this.gl,l,(()=>{switch(v){case"null":b.texImage2D(e,i,o,f,g,c,p,d,h);break;case"typed-array":b.texImage2D(e,i,o,f,g,c,p,d,h,u);break;case"buffer":_=(0,r.KQ)(b),_.bindBuffer(35052,h.handle||h),_.texImage2D(e,i,o,f,g,c,p,d,u),_.bindBuffer(35052,null);break;case"browser-object":(0,r.D0)(b)?b.texImage2D(e,i,o,f,g,c,p,d,h):b.texImage2D(e,i,o,p,d,h);break;case"compressed":for(const[t,n]of h.entries())b.compressedTexImage2D(e,t,n.format,n.width,n.height,c,n.data),y+=n.levelSize;break;default:(0,a.h)(!1,"Unknown image data type")}})),"compressed"===v)this._trackAllocatedMemory(y,"Texture");else if(h&&h.byteLength)this._trackAllocatedMemory(h.byteLength,"Texture");else{const t=s.C[this.dataFormat]||4,e=s.pH[this.type]||1;this._trackAllocatedMemory(this.width*this.height*t*e,"Texture")}return this.loaded=!0,this}setSubImageData(t){let{target:e=this.target,pixels:n=null,data:i=null,x:s=0,y:c=0,width:u=this.width,height:h=this.height,level:d=0,format:f=this.format,type:g=this.type,dataFormat:p=this.dataFormat,compressed:m=!1,offset:b=0,border:_=this.border,parameters:v={}}=t;if(({type:g,dataFormat:p,compressed:m,width:u,height:h}=this._deduceParameters({format:f,type:g,dataFormat:p,compressed:m,data:i,width:u,height:h})),(0,a.h)(0===this.depth,"texSubImage not supported for 3D textures"),i||(i=n),i&&i.data){const t=i;i=t.data,u=t.shape[0],h=t.shape[1]}i instanceof o.Z&&(i=i.handle),this.gl.bindTexture(this.target,this.handle),(0,r.s8)(this.gl,v,(()=>{if(m)this.gl.compressedTexSubImage2D(e,d,s,c,u,h,f,i);else if(null===i)this.gl.texSubImage2D(e,d,s,c,u,h,p,g,null);else if(ArrayBuffer.isView(i))this.gl.texSubImage2D(e,d,s,c,u,h,p,g,i,b);else if(i instanceof l){const t=(0,r.KQ)(this.gl);t.bindBuffer(35052,i),t.texSubImage2D(e,d,s,c,u,h,p,g,b),t.bindBuffer(35052,null)}else(0,r.D0)(this.gl)?(0,r.KQ)(this.gl).texSubImage2D(e,d,s,c,u,h,p,g,i):this.gl.texSubImage2D(e,d,s,c,p,g,i)})),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return r.cM.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.textureUnit;const{gl:e}=this;return void 0!==t&&(this.textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.target,this.handle),t}unbind(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.textureUnit;const{gl:e}=this;return void 0!==t&&(this.textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.target,null),t}_getDataType(t){let{data:e,compressed:n=!1}=t;return n?{data:e,dataType:"compressed"}:null===e?{data:e,dataType:"null"}:ArrayBuffer.isView(e)?{data:e,dataType:"typed-array"}:e instanceof o.Z?{data:e.handle,dataType:"buffer"}:e instanceof l?{data:e,dataType:"buffer"}:{data:e,dataType:"browser-object"}}_deduceParameters(t){const{format:e,data:n}=t;let{width:r,height:i,dataFormat:o,type:a,compressed:c}=t;const u=s.ae[e];return o=o||u&&u.dataFormat,a=a||u&&u.types[0],c=c||u&&u.compressed,({width:r,height:i}=this._deduceImageSize(n,r,i)),{dataFormat:o,type:a,compressed:c,width:r,height:i,format:e,data:n}}_deduceImageSize(t,e,n){let r;return r="undefined"!=typeof ImageData&&t instanceof ImageData?{width:t.width,height:t.height}:"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement?{width:t.naturalWidth,height:t.naturalHeight}:"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?{width:t.width,height:t.height}:"undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t?{width:e,height:n}:{width:e>=0?e:1,height:n>=0?n:1},(0,a.h)(r,"Could not deduced texture size"),(0,a.h)(void 0===e||r.width===e,"Deduced texture width does not match supplied width"),(0,a.h)(void 0===n||r.height===n,"Deduced texture height does not match supplied height"),r}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(t){switch(t){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const e=this.gl.getTexParameter(this.target,t);return this.gl.bindTexture(this.target,null),e}}_setParameter(t,e){switch(this.gl.bindTexture(this.target,this.handle),e=this._getNPOTParam(t,e),t){case 33082:case 33083:this.gl.texParameterf(this.handle,t,e);break;case 4096:case 4097:(0,a.h)(!1);break;default:this.gl.texParameteri(this.target,t,e)}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return!((0,r.D0)(this.gl)||!this.width||!this.height||(0,c.wt)(this.width)&&(0,c.wt)(this.height))}_updateForNPOT(t){void 0===t[this.gl.TEXTURE_MIN_FILTER]&&(t[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),void 0===t[this.gl.TEXTURE_WRAP_S]&&(t[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),void 0===t[this.gl.TEXTURE_WRAP_T]&&(t[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(t,e){if(this._isNPOT())switch(t){case 10241:-1===u.indexOf(e)&&(e=9729);break;case 10242:case 10243:33071!==e&&(e=33071)}return e}}},151053:(t,e,n)=>{"use strict";n.d(e,{Z:()=>a});var r=n(739450),i=n(787577),o=n(53478),s=n(574538);class a extends i.Z{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(t){return(0,r.D0)(t)}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,r.KQ)(t),super(t,e),this.initialize(e),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,(0,s.nK)(this.buffers)||this.bind((()=>this._unbindBuffers())),this.setProps(t),this}setProps(t){"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"bindOnUse"in t&&(t=t.bindOnUse),"buffers"in t&&this.setBuffers(t.buffers)}setBuffers(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.bind((()=>{for(const e in t)this.setBuffer(e,t[e])})),this}setBuffer(t,e){const n=this._getVaryingIndex(t),{buffer:i,byteSize:o,byteOffset:s}=this._getBufferParams(e);return n<0?(this.unused[t]=i,r.cM.warn("".concat(this.id," unused varying buffer ").concat(t))(),this):(this.buffers[n]=e,this.bindOnUse||this._bindBuffer(n,i,s,o),this)}begin(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(t),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(t){let e,n,r;return t instanceof o.Z==0?(r=t.buffer,n=t.byteSize,e=t.byteOffset):r=t,void 0===e&&void 0===n||(e=e||0,n=n||r.byteLength-e),{buffer:r,byteOffset:e,byteSize:n}}_getVaryingInfo(t){return this.configuration&&this.configuration.getVaryingInfo(t)}_getVaryingIndex(t){if(this.configuration)return this.configuration.getVaryingInfo(t).location;const e=Number(t);return Number.isFinite(e)?e:-1}_bindBuffers(){if(this.bindOnUse)for(const t in this.buffers){const{buffer:e,byteSize:n,byteOffset:r}=this._getBufferParams(this.buffers[t]);this._bindBuffer(t,e,r,n)}}_unbindBuffers(){if(this.bindOnUse)for(const t in this.buffers)this._bindBuffer(t,null)}_bindBuffer(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;const i=e&&e.handle;return i&&void 0!==r?this.gl.bindBufferRange(35982,t,i,n,r):this.gl.bindBufferBase(35982,t,i),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(t){this.gl.bindTransformFeedback(36386,this.handle)}}},844211:(t,e,n)=>{"use strict";n.d(e,{N$:()=>u,U6:()=>a,ag:()=>c});var r=n(106948),i=n(739450),o=n(822525);const s=2;function a(t,e){return c(t,e)}function c(t,e){return(e=Array.isArray(e)?e:[e]).every((e=>l(t,e)))}function u(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(const e in r.Z)void 0===t.luma.caps[e]&&(t.luma.caps[e]=l(t,e));return t.luma.caps}function l(t,e){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},void 0===t.luma.caps[e]&&(t.luma.caps[e]=function(t,e){const n=r.Z[e];let s;(0,o.h)(n,e);const a=(0,i.D0)(t)&&n[1]||n[0];if("function"==typeof a)s=a(t);else if(Array.isArray(a)){s=!0;for(const e of a)s=s&&Boolean(t.getExtension(e))}else"string"==typeof a?s=Boolean(t.getExtension(a)):"boolean"==typeof a?s=a:(0,o.h)(!1);return s}(t,e)),t.luma.caps[e]||i.cM.log(s,"Feature: ".concat(e," not supported"))(),t.luma.caps[e]}},106948:(t,e,n)=>{"use strict";n.d(e,{Z:()=>s,h:()=>o});var r=n(53849),i=n(904912);const o={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"},s={[o.WEBGL2]:[!1,!0],[o.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[o.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[o.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[o.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[o.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[o.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[o.FLOAT_BLEND]:["EXT_float_blend"],[o.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[o.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[o.TEXTURE_FLOAT]:["OES_texture_float",!0],[o.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[o.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[o.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[o.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[o.COLOR_ATTACHMENT_RGBA32F]:[function(t){const e=new i.Z(t,{format:6408,type:5126,dataFormat:6408}),n=new r.Z(t,{id:"test-framebuffer",check:!1,attachments:{36064:e}}),o=n.getStatus();return e.delete(),n.delete(),36053===o},"EXT_color_buffer_float"],[o.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[o.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[o.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[o.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[o.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[o.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]}},149835:(t,e,n)=>{"use strict";n.d(e,{lR:()=>a});var r=n(739450),i=n(626203),o=n(693370);const s="8.5.21",a=new class{constructor(){this.stats=new Map}get(t){return this.stats.has(t)||this.stats.set(t,new i.jk({id:t})),this.stats.get(t)}};if(globalThis.luma&&globalThis.luma.VERSION!==s)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(s));globalThis.luma||((0,o.Z)()&&r.cM.log(1,"luma.gl ".concat(s," - ").concat("set luma.log.level=1 (or higher) to trace rendering"))(),globalThis.luma=globalThis.luma||{VERSION:s,version:s,log:r.cM,stats:a,globals:{modules:{},nodeIO:{}}}),globalThis.luma},822525:(t,e,n)=>{"use strict";function r(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}n.d(e,{h:()=>r})},482610:(t,e,n)=>{"use strict";n.d(e,{k:()=>i});var r=n(739450);function i(t,e,n){const{removedProps:i={},deprecatedProps:o={},replacedProps:s={}}=n;for(const n in i)if(n in e){const e=i[n]?"".concat(t,".").concat(i[n]):"N/A";r.cM.removed("".concat(t,".").concat(n),e)()}for(const n in o)if(n in e){const e=o[n];r.cM.deprecated("".concat(t,".").concat(n),"".concat(t,".").concat(e))()}let a=null;for(const n in s)if(n in e){const i=s[n];r.cM.deprecated("".concat(t,".").concat(n),"".concat(t,".").concat(i))(),a=a||Object.assign({},e),a[i]=e[n],delete a[n]}return a||e}},737469:(t,e,n)=>{"use strict";n.d(e,{F:()=>i});var r=n(739450);function i(t,e,n,i){const o="See luma.gl ".concat(n," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),s=Object.getPrototypeOf(t);i.forEach((t=>{s.methodName||(s[t]=()=>{throw r.cM.removed("Calling removed method ".concat(e,".").concat(t,": "),o)(),new Error(t)})}))}},574538:(t,e,n)=>{"use strict";n.d(e,{hQ:()=>o,nK:()=>a,wt:()=>s});var r=n(822525);const i={};function o(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"id";i[t]=i[t]||1;const e=i[t]++;return"".concat(t,"-").concat(e)}function s(t){return(0,r.h)("number"==typeof t,"Input must be a number"),t&&0==(t&t-1)}function a(t){let e=!0;for(const n in t){e=!1;break}return e}},738522:(t,e,n)=>{"use strict";n.d(e,{$Z:()=>v,hJ:()=>y,jG:()=>A});var r=n(822525);const i=5120,o=5121,s=5122,a=5123,c=0,u=1,l=2,h=3,d=4,f=5,g=6,p=5126,m=5124,b=5125,_={[p]:[p,1,"float"],35664:[p,2,"vec2"],35665:[p,3,"vec3"],35666:[p,4,"vec4"],[m]:[m,1,"int"],35667:[m,2,"ivec2"],35668:[m,3,"ivec3"],35669:[m,4,"ivec4"],[b]:[b,1,"uint"],36294:[b,2,"uvec2"],36295:[b,3,"uvec3"],36296:[b,4,"uvec4"],35670:[p,1,"bool"],35671:[p,2,"bvec2"],35672:[p,3,"bvec3"],35673:[p,4,"bvec4"],35674:[p,8,"mat2"],35685:[p,8,"mat2x3"],35686:[p,8,"mat2x4"],35675:[p,12,"mat3"],35687:[p,12,"mat3x2"],35688:[p,12,"mat3x4"],35676:[p,16,"mat4"],35689:[p,16,"mat4x2"],35690:[p,16,"mat4x3"]};function v(t){switch(t){case c:return c;case u:case h:case l:return u;case d:case f:case g:return d;default:return(0,r.h)(!1),0}}function y(t){const e=_[t];if(!e)return null;const[n,r]=e;return{type:n,components:r}}function A(t,e){switch(t){case i:case o:case s:case a:t=p}for(const n in _){const[r,i,o]=_[n];if(r===t&&i===e)return{glType:n,name:o}}return null}},779579:(t,e,n)=>{"use strict";n.d(e,{km:()=>o,sF:()=>i});var r=n(822525);function i(t,e){if("string"!=typeof e)return e;const n=Number(e);if(!isNaN(n))return n;const i=t[e=e.replace(/^.*\./,"")];return(0,r.h)(void 0!==i,"Accessing undefined constant GL.".concat(e)),i}function o(t,e){e=Number(e);for(const n in t)if(t[n]===e)return"GL.".concat(n);return String(e)}},495432:(t,e,n)=>{"use strict";n.d(e,{h:()=>f,Y:()=>g});var r=n(904912),i=n(739450),o=n(135008);const s=[34069,34070,34071,34072,34073,34074];class a extends o.Z{get[Symbol.toStringTag](){return"TextureCube"}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,i.JD)(t),super(t,Object.assign({},e,{target:34067})),this.initialize(e),Object.seal(this)}initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{mipmaps:e=!0,parameters:n={}}=t;return this.opts=t,this.setCubeMapImageData(t).then((()=>{this.loaded=!0,e&&this.generateMipmap(t),this.setParameters(n)})),this}subImage(t){let{face:e,data:n,x:r=0,y:i=0,mipmapLevel:o=0}=t;return this._subImage({target:e,data:n,x:r,y:i,mipmapLevel:o})}async setCubeMapImageData(t){let{width:e,height:n,pixels:r,data:o,border:a=0,format:c=6408,type:u=5121}=t;const{gl:l}=this,h=r||o,d=await Promise.all(s.map((t=>{const e=h[t];return Promise.all(Array.isArray(e)?e:[e])})));this.bind(),s.forEach(((t,r)=>{d[r].length>1&&!1!==this.opts.mipmaps&&i.cM.warn("".concat(this.id," has mipmap and multiple LODs."))(),d[r].forEach(((r,i)=>{e&&n?l.texImage2D(t,i,c,e,n,a,c,u,r):l.texImage2D(t,i,c,c,u,r)}))})),this.unbind()}setImageDataForFace(t){const{face:e,width:n,height:r,pixels:i,data:o,border:s=0,format:a=6408,type:c=5121}=t,{gl:u}=this,l=i||o;return this.bind(),l instanceof Promise?l.then((n=>this.setImageDataForFace(Object.assign({},t,{face:e,data:n,pixels:n})))):this.width||this.height?u.texImage2D(e,0,a,n,r,s,a,c,l):u.texImage2D(e,0,a,a,c,l),this}}a.FACES=s;var c=n(33889),u=n(53478);class l extends o.Z{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(t){return(0,i.D0)(t)}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,i.KQ)(t),e=Object.assign({depth:1},e,{target:32879,unpackFlipY:!1}),super(t,e),this.initialize(e),Object.seal(this)}setImageData(t){let{level:e=0,dataFormat:n=6408,width:r,height:o,depth:s=1,border:a=0,format:l,type:h=5121,offset:d=0,data:f,parameters:g={}}=t;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),(0,i.s8)(this.gl,g,(()=>{ArrayBuffer.isView(f)&&this.gl.texImage3D(this.target,e,n,r,o,s,a,l,h,f),f instanceof u.Z&&(this.gl.bindBuffer(35052,f.handle),this.gl.texImage3D(this.target,e,n,r,o,s,a,l,h,d))})),f&&f.byteLength)this._trackAllocatedMemory(f.byteLength,"Texture");else{const t=c.C[this.dataFormat]||4,e=c.pH[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*t*e,"Texture")}return this.loaded=!0,this}}var h=n(53849),d=n(822525);function f(t,e){(0,d.h)(t instanceof r.Z||t instanceof a||t instanceof l);const n=t.constructor,{gl:i,width:o,height:s,format:c,type:u,dataFormat:h,border:f,mipmaps:g}=t;return new n(i,Object.assign({width:o,height:s,format:c,type:u,dataFormat:h,border:f,mipmaps:g},e))}function g(t,e){const{gl:n,width:r,height:i,id:o}=t;return new h.Z(n,Object.assign({},e,{id:"framebuffer-for-".concat(o),width:r,height:i,attachments:{36064:t}}))}},109335:(t,e,n)=>{"use strict";n.d(e,{KS:()=>a,O:()=>i,c$:()=>s,vN:()=>o});const r="Failed to deduce GL constant from typed array";function i(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(r)}}function o(t){let{clamped:e=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function s(t){let{data:e,width:n,height:r,bytesPerPixel:i=4,temp:o}=t;const s=n*i;o=o||new Uint8Array(s);for(let t=0;t<r/2;++t){const n=t*s,i=(r-t-1)*s;o.set(e.subarray(n,n+s)),e.copyWithin(n,i,i+s),e.set(o,i)}}function a(t){let{data:e,width:n,height:r}=t;const i=Math.round(n/2),o=Math.round(r/2),s=new Uint8Array(i*o*4);for(let t=0;t<o;t++)for(let r=0;r<i;r++)for(let o=0;o<4;o++)s[4*(t*i+r)+o]=e[4*(2*t*n+2*r)+o];return{data:s,width:i,height:o}}},301307:function(t,e,n){t.exports=function(){"use strict";var t=function(t,e){var n={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},r={on:function(t,e,r){if(void 0===n[t])throw new Error("Invalid event type: "+t);n[t].push({selector:e,fn:r})},render:function(t){e.store.featureChanged(t)}},i=function(t,i){for(var o=n[t],s=o.length;s--;){var a=o[s];if(a.selector(i)){a.fn.call(r,i)||e.store.render(),e.ui.updateMapClasses();break}}};return t.start.call(r),{render:t.render,stop:function(){t.stop&&t.stop()},trash:function(){t.trash&&(t.trash(),e.store.render())},combineFeatures:function(){t.combineFeatures&&t.combineFeatures()},uncombineFeatures:function(){t.uncombineFeatures&&t.uncombineFeatures()},drag:function(t){i("drag",t)},click:function(t){i("click",t)},mousemove:function(t){i("mousemove",t)},mousedown:function(t){i("mousedown",t)},mouseup:function(t){i("mouseup",t)},mouseout:function(t){i("mouseout",t)},keydown:function(t){i("keydown",t)},keyup:function(t){i("keyup",t)},touchstart:function(t){i("touchstart",t)},touchmove:function(t){i("touchmove",t)},touchend:function(t){i("touchend",t)},tap:function(t){i("tap",t)}}};function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var r={},i={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:6356752.3142};function o(t){var e=0;if(t&&t.length>0){e+=Math.abs(s(t[0]));for(var n=1;n<t.length;n++)e-=Math.abs(s(t[n]))}return e}function s(t){var e,n,r,o,s,c,u=0,l=t.length;if(l>2){for(c=0;c<l;c++)c===l-2?(r=l-2,o=l-1,s=0):c===l-1?(r=l-1,o=0,s=1):(r=c,o=c+1,s=c+2),e=t[r],n=t[o],u+=(a(t[s][0])-a(e[0]))*Math.sin(a(n[1]));u=u*i.RADIUS*i.RADIUS/2}return u}function a(t){return t*Math.PI/180}r.geometry=function t(e){var n,r=0;switch(e.type){case"Polygon":return o(e.coordinates);case"MultiPolygon":for(n=0;n<e.coordinates.length;n++)r+=o(e.coordinates[n]);return r;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(n=0;n<e.geometries.length;n++)r+=t(e.geometries[n]);return r}},r.ring=s;var c={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},u={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},l={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},h={POLYGON:"polygon",LINE:"line_string",POINT:"point"},d={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},f={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},g={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},p={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},m={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},b={ACTIVE:"true",INACTIVE:"false"},_=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],v=-85,y=Object.freeze({__proto__:null,classes:c,sources:u,cursors:l,types:h,geojsonTypes:d,modes:f,events:g,updateActions:p,meta:m,activeStates:b,interactions:_,LAT_MIN:-90,LAT_RENDERED_MIN:v,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),A={Point:0,LineString:1,MultiLineString:1,Polygon:2};function x(t,e){var n=A[t.geometry.type]-A[e.geometry.type];return 0===n&&t.geometry.type===d.POLYGON?t.area-e.area:n}function E(t){return t.map((function(t){return t.geometry.type===d.POLYGON&&(t.area=r.geometry({type:d.FEATURE,property:{},geometry:t.geometry})),t})).sort(x).map((function(t){return delete t.area,t}))}function T(t,e){return void 0===e&&(e=0),[[t.point.x-e,t.point.y-e],[t.point.x+e,t.point.y+e]]}function w(t){if(this._items={},this._nums={},this._length=t?t.length:0,t)for(var e=0,n=t.length;e<n;e++)this.add(t[e]),void 0!==t[e]&&("string"==typeof t[e]?this._items[t[e]]=e:this._nums[t[e]]=e)}w.prototype.add=function(t){return this.has(t)||(this._length++,"string"==typeof t?this._items[t]=this._length:this._nums[t]=this._length),this},w.prototype.delete=function(t){return!1===this.has(t)||(this._length--,delete this._items[t],delete this._nums[t]),this},w.prototype.has=function(t){return!("string"!=typeof t&&"number"!=typeof t||void 0===this._items[t]&&void 0===this._nums[t])},w.prototype.values=function(){var t=this,e=[];return Object.keys(this._items).forEach((function(n){e.push({k:n,v:t._items[n]})})),Object.keys(this._nums).forEach((function(n){e.push({k:JSON.parse(n),v:t._nums[n]})})),e.sort((function(t,e){return t.v-e.v})).map((function(t){return t.k}))},w.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var C=[m.FEATURE,m.MIDPOINT,m.VERTEX],S={click:function(t,e,n){return L(t,e,n,n.options.clickBuffer)},touch:function(t,e,n){return L(t,e,n,n.options.touchBuffer)}};function L(t,e,n,r){if(null===n.map)return[];var i=t?T(t,r):e,o={};n.options.styles&&(o.layers=n.options.styles.map((function(t){return t.id})).filter((function(t){return null!=n.map.getLayer(t)})));var s=n.map.queryRenderedFeatures(i,o).filter((function(t){return-1!==C.indexOf(t.properties.meta)})),a=new w,c=[];return s.forEach((function(t){var e=t.properties.id;a.has(e)||(a.add(e),c.push(t))})),E(c)}function O(t,e){var n=S.click(t,null,e),r={mouse:l.NONE};return n[0]&&(r.mouse=n[0].properties.active===b.ACTIVE?l.MOVE:l.POINTER,r.feature=n[0].properties.meta),-1!==e.events.currentModeName().indexOf("draw")&&(r.mouse=l.ADD),e.ui.queueMapClasses(r),e.ui.updateMapClasses(),n[0]}function I(t,e){var n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)}function M(t,e,n){void 0===n&&(n={});var r=null!=n.fineTolerance?n.fineTolerance:4,i=null!=n.grossTolerance?n.grossTolerance:12,o=null!=n.interval?n.interval:500;t.point=t.point||e.point,t.time=t.time||e.time;var s=I(t.point,e.point);return s<r||s<i&&e.time-t.time<o}function F(t,e,n){void 0===n&&(n={});var r=null!=n.tolerance?n.tolerance:25,i=null!=n.interval?n.interval:250;return t.point=t.point||e.point,t.time=t.time||e.time,I(t.point,e.point)<r&&e.time-t.time<i}var P={exports:{}},R=P.exports=function(t,e){if(e||(e=16),void 0===t&&(t=128),t<=0)return"0";for(var n=Math.log(Math.pow(2,t))/Math.log(e),r=2;n===1/0;r*=2)n=Math.log(Math.pow(2,t/r))/Math.log(e)*r;var i=n-Math.floor(n),o="";for(r=0;r<Math.floor(n);r++)o=Math.floor(Math.random()*e).toString(e)+o;if(i){var s=Math.pow(e,i);o=Math.floor(Math.random()*s).toString(e)+o}var a=parseInt(o,e);return a!==1/0&&a>=Math.pow(2,t)?R(t,e):o};R.rack=function(t,e,n){var r=function(r){var o=0;do{if(o++>10){if(!n)throw new Error("too many ID collisions, use more bits");t+=n}var s=R(t,e)}while(Object.hasOwnProperty.call(i,s));return i[s]=r,s},i=r.hats={};return r.get=function(t){return r.hats[t]},r.set=function(t,e){return r.hats[t]=e,r},r.bits=t||128,r.base=e||16,r};var B=e(P.exports),N=function(t,e){this.ctx=t,this.properties=e.properties||{},this.coordinates=e.geometry.coordinates,this.id=e.id||B(),this.type=e.geometry.type};N.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},N.prototype.incomingCoords=function(t){this.setCoordinates(t)},N.prototype.setCoordinates=function(t){this.coordinates=t,this.changed()},N.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},N.prototype.setProperty=function(t,e){this.properties[t]=e},N.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:d.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},N.prototype.internal=function(t){var e={id:this.id,meta:m.FEATURE,"meta:type":this.type,active:b.INACTIVE,mode:t};if(this.ctx.options.userProperties)for(var n in this.properties)e["user_"+n]=this.properties[n];return{type:d.FEATURE,properties:e,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var D=function(t,e){N.call(this,t,e)};(D.prototype=Object.create(N.prototype)).isValid=function(){return"number"==typeof this.coordinates[0]&&"number"==typeof this.coordinates[1]},D.prototype.updateCoordinate=function(t,e,n){this.coordinates=3===arguments.length?[e,n]:[t,e],this.changed()},D.prototype.getCoordinate=function(){return this.getCoordinates()};var k=function(t,e){N.call(this,t,e)};(k.prototype=Object.create(N.prototype)).isValid=function(){return this.coordinates.length>1},k.prototype.addCoordinate=function(t,e,n){this.changed();var r=parseInt(t,10);this.coordinates.splice(r,0,[e,n])},k.prototype.getCoordinate=function(t){var e=parseInt(t,10);return JSON.parse(JSON.stringify(this.coordinates[e]))},k.prototype.removeCoordinate=function(t){this.changed(),this.coordinates.splice(parseInt(t,10),1)},k.prototype.updateCoordinate=function(t,e,n){var r=parseInt(t,10);this.coordinates[r]=[e,n],this.changed()};var U=function(t,e){N.call(this,t,e),this.coordinates=this.coordinates.map((function(t){return t.slice(0,-1)}))};(U.prototype=Object.create(N.prototype)).isValid=function(){return 0!==this.coordinates.length&&this.coordinates.every((function(t){return t.length>2}))},U.prototype.incomingCoords=function(t){this.coordinates=t.map((function(t){return t.slice(0,-1)})),this.changed()},U.prototype.setCoordinates=function(t){this.coordinates=t,this.changed()},U.prototype.addCoordinate=function(t,e,n){this.changed();var r=t.split(".").map((function(t){return parseInt(t,10)}));this.coordinates[r[0]].splice(r[1],0,[e,n])},U.prototype.removeCoordinate=function(t){this.changed();var e=t.split(".").map((function(t){return parseInt(t,10)})),n=this.coordinates[e[0]];n&&(n.splice(e[1],1),n.length<3&&this.coordinates.splice(e[0],1))},U.prototype.getCoordinate=function(t){var e=t.split(".").map((function(t){return parseInt(t,10)})),n=this.coordinates[e[0]];return JSON.parse(JSON.stringify(n[e[1]]))},U.prototype.getCoordinates=function(){return this.coordinates.map((function(t){return t.concat([t[0]])}))},U.prototype.updateCoordinate=function(t,e,n){this.changed();var r=t.split("."),i=parseInt(r[0],10),o=parseInt(r[1],10);void 0===this.coordinates[i]&&(this.coordinates[i]=[]),this.coordinates[i][o]=[e,n]};var V={MultiPoint:D,MultiLineString:k,MultiPolygon:U},j=function(t,e,n,r,i){var o=n.split("."),s=parseInt(o[0],10),a=o[1]?o.slice(1).join("."):null;return t[s][e](a,r,i)},G=function(t,e){if(N.call(this,t,e),delete this.coordinates,this.model=V[e.geometry.type],void 0===this.model)throw new TypeError(e.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(e.geometry.coordinates)};function z(t){this.map=t.map,this.drawConfig=JSON.parse(JSON.stringify(t.options||{})),this._ctx=t}(G.prototype=Object.create(N.prototype))._coordinatesToFeatures=function(t){var e=this,n=this.model.bind(this);return t.map((function(t){return new n(e.ctx,{id:B(),type:d.FEATURE,properties:{},geometry:{coordinates:t,type:e.type.replace("Multi","")}})}))},G.prototype.isValid=function(){return this.features.every((function(t){return t.isValid()}))},G.prototype.setCoordinates=function(t){this.features=this._coordinatesToFeatures(t),this.changed()},G.prototype.getCoordinate=function(t){return j(this.features,"getCoordinate",t)},G.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map((function(t){return t.type===d.POLYGON?t.getCoordinates():t.coordinates}))))},G.prototype.updateCoordinate=function(t,e,n){j(this.features,"updateCoordinate",t,e,n),this.changed()},G.prototype.addCoordinate=function(t,e,n){j(this.features,"addCoordinate",t,e,n),this.changed()},G.prototype.removeCoordinate=function(t){j(this.features,"removeCoordinate",t),this.changed()},G.prototype.getFeatures=function(){return this.features},z.prototype.setSelected=function(t){return this._ctx.store.setSelected(t)},z.prototype.setSelectedCoordinates=function(t){var e=this;this._ctx.store.setSelectedCoordinates(t),t.reduce((function(t,n){return void 0===t[n.feature_id]&&(t[n.feature_id]=!0,e._ctx.store.get(n.feature_id).changed()),t}),{})},z.prototype.getSelected=function(){return this._ctx.store.getSelected()},z.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},z.prototype.isSelected=function(t){return this._ctx.store.isSelected(t)},z.prototype.getFeature=function(t){return this._ctx.store.get(t)},z.prototype.select=function(t){return this._ctx.store.select(t)},z.prototype.deselect=function(t){return this._ctx.store.deselect(t)},z.prototype.deleteFeature=function(t,e){return void 0===e&&(e={}),this._ctx.store.delete(t,e)},z.prototype.addFeature=function(t){return this._ctx.store.add(t)},z.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},z.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},z.prototype.setActionableState=function(t){void 0===t&&(t={});var e={trash:t.trash||!1,combineFeatures:t.combineFeatures||!1,uncombineFeatures:t.uncombineFeatures||!1};return this._ctx.events.actionable(e)},z.prototype.changeMode=function(t,e,n){return void 0===e&&(e={}),void 0===n&&(n={}),this._ctx.events.changeMode(t,e,n)},z.prototype.updateUIClasses=function(t){return this._ctx.ui.queueMapClasses(t)},z.prototype.activateUIButton=function(t){return this._ctx.ui.setActiveButton(t)},z.prototype.featuresAt=function(t,e,n){if(void 0===n&&(n="click"),"click"!==n&&"touch"!==n)throw new Error("invalid buffer type");return S[n](t,e,this._ctx)},z.prototype.newFeature=function(t){var e=t.geometry.type;return e===d.POINT?new D(this._ctx,t):e===d.LINE_STRING?new k(this._ctx,t):e===d.POLYGON?new U(this._ctx,t):new G(this._ctx,t)},z.prototype.isInstanceOf=function(t,e){if(t===d.POINT)return e instanceof D;if(t===d.LINE_STRING)return e instanceof k;if(t===d.POLYGON)return e instanceof U;if("MultiFeature"===t)return e instanceof G;throw new Error("Unknown feature class: "+t)},z.prototype.doRender=function(t){return this._ctx.store.featureChanged(t)},z.prototype.onSetup=function(){},z.prototype.onDrag=function(){},z.prototype.onClick=function(){},z.prototype.onMouseMove=function(){},z.prototype.onMouseDown=function(){},z.prototype.onMouseUp=function(){},z.prototype.onMouseOut=function(){},z.prototype.onKeyUp=function(){},z.prototype.onKeyDown=function(){},z.prototype.onTouchStart=function(){},z.prototype.onTouchMove=function(){},z.prototype.onTouchEnd=function(){},z.prototype.onTap=function(){},z.prototype.onStop=function(){},z.prototype.onTrash=function(){},z.prototype.onCombineFeature=function(){},z.prototype.onUncombineFeature=function(){},z.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var H={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},Z=Object.keys(H);function W(t){return[].concat(t).filter((function(t){return void 0!==t}))}function X(){var t=this;if(!t.ctx.map||void 0===t.ctx.map.getSource(u.HOT))return c();var e=t.ctx.events.currentModeName();t.ctx.ui.queueMapClasses({mode:e});var n=[],r=[];t.isDirty?r=t.getAllIds():(n=t.getChangedIds().filter((function(e){return void 0!==t.get(e)})),r=t.sources.hot.filter((function(e){return e.properties.id&&-1===n.indexOf(e.properties.id)&&void 0!==t.get(e.properties.id)})).map((function(t){return t.properties.id}))),t.sources.hot=[];var i=t.sources.cold.length;t.sources.cold=t.isDirty?[]:t.sources.cold.filter((function(t){var e=t.properties.id||t.properties.parent;return-1===n.indexOf(e)}));var o=i!==t.sources.cold.length||r.length>0;function s(n,r){var i=t.get(n).internal(e);t.ctx.events.currentModeRender(i,(function(e){t.sources[r].push(e)}))}if(n.forEach((function(t){return s(t,"hot")})),r.forEach((function(t){return s(t,"cold")})),o&&t.ctx.map.getSource(u.COLD).setData({type:d.FEATURE_COLLECTION,features:t.sources.cold}),t.ctx.map.getSource(u.HOT).setData({type:d.FEATURE_COLLECTION,features:t.sources.hot}),t._emitSelectionChange&&(t.ctx.map.fire(g.SELECTION_CHANGE,{features:t.getSelected().map((function(t){return t.toGeoJSON()})),points:t.getSelectedCoordinates().map((function(t){return{type:d.FEATURE,properties:{},geometry:{type:d.POINT,coordinates:t.coordinates}}}))}),t._emitSelectionChange=!1),t._deletedFeaturesToEmit.length){var a=t._deletedFeaturesToEmit.map((function(t){return t.toGeoJSON()}));t._deletedFeaturesToEmit=[],t.ctx.map.fire(g.DELETE,{features:a})}function c(){t.isDirty=!1,t.clearChangedIds()}c(),t.ctx.map.fire(g.RENDER,{})}function Y(t){var e,n=this;this._features={},this._featureIds=new w,this._selectedFeatureIds=new w,this._selectedCoordinates=[],this._changedFeatureIds=new w,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=t,this.sources={hot:[],cold:[]},this.render=function(){e||(e=requestAnimationFrame((function(){e=null,X.call(n)})))},this.isDirty=!1}function Q(t,e){var n=t._selectedCoordinates.filter((function(e){return t._selectedFeatureIds.has(e.feature_id)}));t._selectedCoordinates.length===n.length||e.silent||(t._emitSelectionChange=!0),t._selectedCoordinates=n}Y.prototype.createRenderBatch=function(){var t=this,e=this.render,n=0;return this.render=function(){n++},function(){t.render=e,n>0&&t.render()}},Y.prototype.setDirty=function(){return this.isDirty=!0,this},Y.prototype.featureChanged=function(t){return this._changedFeatureIds.add(t),this},Y.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},Y.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},Y.prototype.getAllIds=function(){return this._featureIds.values()},Y.prototype.add=function(t){return this.featureChanged(t.id),this._features[t.id]=t,this._featureIds.add(t.id),this},Y.prototype.delete=function(t,e){var n=this;return void 0===e&&(e={}),W(t).forEach((function(t){n._featureIds.has(t)&&(n._featureIds.delete(t),n._selectedFeatureIds.delete(t),e.silent||-1===n._deletedFeaturesToEmit.indexOf(n._features[t])&&n._deletedFeaturesToEmit.push(n._features[t]),delete n._features[t],n.isDirty=!0)})),Q(this,e),this},Y.prototype.get=function(t){return this._features[t]},Y.prototype.getAll=function(){var t=this;return Object.keys(this._features).map((function(e){return t._features[e]}))},Y.prototype.select=function(t,e){var n=this;return void 0===e&&(e={}),W(t).forEach((function(t){n._selectedFeatureIds.has(t)||(n._selectedFeatureIds.add(t),n._changedFeatureIds.add(t),e.silent||(n._emitSelectionChange=!0))})),this},Y.prototype.deselect=function(t,e){var n=this;return void 0===e&&(e={}),W(t).forEach((function(t){n._selectedFeatureIds.has(t)&&(n._selectedFeatureIds.delete(t),n._changedFeatureIds.add(t),e.silent||(n._emitSelectionChange=!0))})),Q(this,e),this},Y.prototype.clearSelected=function(t){return void 0===t&&(t={}),this.deselect(this._selectedFeatureIds.values(),{silent:t.silent}),this},Y.prototype.setSelected=function(t,e){var n=this;return void 0===e&&(e={}),t=W(t),this.deselect(this._selectedFeatureIds.values().filter((function(e){return-1===t.indexOf(e)})),{silent:e.silent}),this.select(t.filter((function(t){return!n._selectedFeatureIds.has(t)})),{silent:e.silent}),this},Y.prototype.setSelectedCoordinates=function(t){return this._selectedCoordinates=t,this._emitSelectionChange=!0,this},Y.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},Y.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},Y.prototype.getSelected=function(){var t=this;return this._selectedFeatureIds.values().map((function(e){return t.get(e)}))},Y.prototype.getSelectedCoordinates=function(){var t=this;return this._selectedCoordinates.map((function(e){return{coordinates:t.get(e.feature_id).getCoordinate(e.coord_path)}}))},Y.prototype.isSelected=function(t){return this._selectedFeatureIds.has(t)},Y.prototype.setFeatureProperty=function(t,e,n){this.get(t).setProperty(e,n),this.featureChanged(t)},Y.prototype.storeMapConfig=function(){var t=this;_.forEach((function(e){t.ctx.map[e]&&(t._mapInitialConfig[e]=t.ctx.map[e].isEnabled())}))},Y.prototype.restoreMapConfig=function(){var t=this;Object.keys(this._mapInitialConfig).forEach((function(e){t._mapInitialConfig[e]?t.ctx.map[e].enable():t.ctx.map[e].disable()}))},Y.prototype.getInitialConfigValue=function(t){return void 0===this._mapInitialConfig[t]||this._mapInitialConfig[t]};var q=Object.prototype.hasOwnProperty,K=e((function(){for(var t=arguments,e={},n=0;n<arguments.length;n++){var r=t[n];for(var i in r)q.call(r,i)&&(e[i]=r[i])}return e})),J=["mode","feature","mouse"];function $(e){var n=null,r=null,i={onRemove:function(){return e.map.off("load",i.connect),clearInterval(r),i.removeLayers(),e.store.restoreMapConfig(),e.ui.removeButtons(),e.events.removeEventListeners(),e.ui.clearMapClasses(),e.boxZoomInitial&&e.map.boxZoom.enable(),e.map=null,e.container=null,e.store=null,n&&n.parentNode&&n.parentNode.removeChild(n),n=null,this},connect:function(){e.map.off("load",i.connect),clearInterval(r),i.addLayers(),e.store.storeMapConfig(),e.events.addEventListeners()},onAdd:function(o){var s=o.fire;return o.fire=function(t,e){var n=arguments;return 1===s.length&&1!==arguments.length&&(n=[K({},{type:t},e)]),s.apply(o,n)},e.map=o,e.events=function(e){var n=Object.keys(e.options.modes).reduce((function(t,n){return t[n]=function(t){var e=Object.keys(t);return function(n,r){void 0===r&&(r={});var i={},o=e.reduce((function(e,n){return e[n]=t[n],e}),new z(n));return{start:function(){var e=this;i=o.onSetup(r),Z.forEach((function(n){var r,s=H[n],a=function(){return!1};t[s]&&(a=function(){return!0}),e.on(n,a,(r=s,function(t){return o[r](i,t)}))}))},stop:function(){o.onStop(i)},trash:function(){o.onTrash(i)},combineFeatures:function(){o.onCombineFeatures(i)},uncombineFeatures:function(){o.onUncombineFeatures(i)},render:function(t,e){o.toDisplayFeatures(i,t,e)}}}}(e.options.modes[n]),t}),{}),r={},i={},o={},s=null,a=null;o.drag=function(t,n){n({point:t.point,time:(new Date).getTime()})?(e.ui.queueMapClasses({mouse:l.DRAG}),a.drag(t)):t.originalEvent.stopPropagation()},o.mousedrag=function(t){o.drag(t,(function(t){return!M(r,t)}))},o.touchdrag=function(t){o.drag(t,(function(t){return!F(i,t)}))},o.mousemove=function(t){if(1===(void 0!==t.originalEvent.buttons?t.originalEvent.buttons:t.originalEvent.which))return o.mousedrag(t);var n=O(t,e);t.featureTarget=n,a.mousemove(t)},o.mousedown=function(t){r={time:(new Date).getTime(),point:t.point};var n=O(t,e);t.featureTarget=n,a.mousedown(t)},o.mouseup=function(t){var n=O(t,e);t.featureTarget=n,M(r,{point:t.point,time:(new Date).getTime()})?a.click(t):a.mouseup(t)},o.mouseout=function(t){a.mouseout(t)},o.touchstart=function(t){if(e.options.touchEnabled){i={time:(new Date).getTime(),point:t.point};var n=S.touch(t,null,e)[0];t.featureTarget=n,a.touchstart(t)}},o.touchmove=function(t){if(e.options.touchEnabled)return a.touchmove(t),o.touchdrag(t)},o.touchend=function(t){if(t.originalEvent.preventDefault(),e.options.touchEnabled){var n=S.touch(t,null,e)[0];t.featureTarget=n,F(i,{time:(new Date).getTime(),point:t.point})?a.tap(t):a.touchend(t)}};var c=function(t){return!(8===t||46===t||t>=48&&t<=57)};function u(r,i,o){void 0===o&&(o={}),a.stop();var c=n[r];if(void 0===c)throw new Error(r+" is not valid");s=r;var u=c(e,i);a=t(u,e),o.silent||e.map.fire(g.MODE_CHANGE,{mode:r}),e.store.setDirty(),e.store.render()}o.keydown=function(t){(t.srcElement||t.target).classList.contains("mapboxgl-canvas")&&(8!==t.keyCode&&46!==t.keyCode||!e.options.controls.trash?c(t.keyCode)?a.keydown(t):49===t.keyCode&&e.options.controls.point?u(f.DRAW_POINT):50===t.keyCode&&e.options.controls.line_string?u(f.DRAW_LINE_STRING):51===t.keyCode&&e.options.controls.polygon&&u(f.DRAW_POLYGON):(t.preventDefault(),a.trash()))},o.keyup=function(t){c(t.keyCode)&&a.keyup(t)},o.zoomend=function(){e.store.changeZoom()},o.data=function(t){if("style"===t.dataType){var n=e.setup,r=e.map,i=e.options,o=e.store;i.styles.some((function(t){return r.getLayer(t.id)}))||(n.addLayers(),o.setDirty(),o.render())}};var h={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){s=e.options.defaultMode,a=t(n[s](e),e)},changeMode:u,actionable:function(t){var n=!1;Object.keys(t).forEach((function(e){if(void 0===h[e])throw new Error("Invalid action type");h[e]!==t[e]&&(n=!0),h[e]=t[e]})),n&&e.map.fire(g.ACTIONABLE,{actions:h})},currentModeName:function(){return s},currentModeRender:function(t,e){return a.render(t,e)},fire:function(t,e){o[t]&&o[t](e)},addEventListeners:function(){e.map.on("mousemove",o.mousemove),e.map.on("mousedown",o.mousedown),e.map.on("mouseup",o.mouseup),e.map.on("data",o.data),e.map.on("touchmove",o.touchmove),e.map.on("touchstart",o.touchstart),e.map.on("touchend",o.touchend),e.container.addEventListener("mouseout",o.mouseout),e.options.keybindings&&(e.container.addEventListener("keydown",o.keydown),e.container.addEventListener("keyup",o.keyup))},removeEventListeners:function(){e.map.off("mousemove",o.mousemove),e.map.off("mousedown",o.mousedown),e.map.off("mouseup",o.mouseup),e.map.off("data",o.data),e.map.off("touchmove",o.touchmove),e.map.off("touchstart",o.touchstart),e.map.off("touchend",o.touchend),e.container.removeEventListener("mouseout",o.mouseout),e.options.keybindings&&(e.container.removeEventListener("keydown",o.keydown),e.container.removeEventListener("keyup",o.keyup))},trash:function(t){a.trash(t)},combineFeatures:function(){a.combineFeatures()},uncombineFeatures:function(){a.uncombineFeatures()},getMode:function(){return s}}}(e),e.ui=function(t){var e={},n=null,r={mode:null,feature:null,mouse:null},i={mode:null,feature:null,mouse:null};function o(t){i=K(i,t)}function s(){var e,n;if(t.container){var o=[],s=[];J.forEach((function(t){i[t]!==r[t]&&(o.push(t+"-"+r[t]),null!==i[t]&&s.push(t+"-"+i[t]))})),o.length>0&&(e=t.container.classList).remove.apply(e,o),s.length>0&&(n=t.container.classList).add.apply(n,s),r=K(r,i)}}function a(t,e){void 0===e&&(e={});var r=document.createElement("button");return r.className=c.CONTROL_BUTTON+" "+e.className,r.setAttribute("title",e.title),e.container.appendChild(r),r.addEventListener("click",(function(r){if(r.preventDefault(),r.stopPropagation(),r.target===n)return u(),void e.onDeactivate();l(t),e.onActivate()}),!0),r}function u(){n&&(n.classList.remove(c.ACTIVE_BUTTON),n=null)}function l(t){u();var r=e[t];r&&r&&"trash"!==t&&(r.classList.add(c.ACTIVE_BUTTON),n=r)}return{setActiveButton:l,queueMapClasses:o,updateMapClasses:s,clearMapClasses:function(){o({mode:null,feature:null,mouse:null}),s()},addButtons:function(){var n=t.options.controls,r=document.createElement("div");return r.className=c.CONTROL_GROUP+" "+c.CONTROL_BASE,n?(n[h.LINE]&&(e[h.LINE]=a(h.LINE,{container:r,className:c.CONTROL_BUTTON_LINE,title:"LineString tool "+(t.options.keybindings?"(l)":""),onActivate:function(){return t.events.changeMode(f.DRAW_LINE_STRING)},onDeactivate:function(){return t.events.trash()}})),n[h.POLYGON]&&(e[h.POLYGON]=a(h.POLYGON,{container:r,className:c.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(t.options.keybindings?"(p)":""),onActivate:function(){return t.events.changeMode(f.DRAW_POLYGON)},onDeactivate:function(){return t.events.trash()}})),n[h.POINT]&&(e[h.POINT]=a(h.POINT,{container:r,className:c.CONTROL_BUTTON_POINT,title:"Marker tool "+(t.options.keybindings?"(m)":""),onActivate:function(){return t.events.changeMode(f.DRAW_POINT)},onDeactivate:function(){return t.events.trash()}})),n.trash&&(e.trash=a("trash",{container:r,className:c.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){t.events.trash()}})),n.combine_features&&(e.combine_features=a("combineFeatures",{container:r,className:c.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){t.events.combineFeatures()}})),n.uncombine_features&&(e.uncombine_features=a("uncombineFeatures",{container:r,className:c.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){t.events.uncombineFeatures()}})),r):r},removeButtons:function(){Object.keys(e).forEach((function(t){var n=e[t];n.parentNode&&n.parentNode.removeChild(n),delete e[t]}))}}}(e),e.container=o.getContainer(),e.store=new Y(e),n=e.ui.addButtons(),e.options.boxSelect&&(e.boxZoomInitial=o.boxZoom.isEnabled(),o.boxZoom.disable(),o.dragPan.disable(),o.dragPan.enable()),o.loaded()?i.connect():(o.on("load",i.connect),r=setInterval((function(){o.loaded()&&i.connect()}),16)),e.events.start(),n},addLayers:function(){e.map.addSource(u.COLD,{data:{type:d.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.map.addSource(u.HOT,{data:{type:d.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.options.styles.forEach((function(t){e.map.addLayer(t)})),e.store.setDirty(!0),e.store.render()},removeLayers:function(){e.options.styles.forEach((function(t){e.map.getLayer(t.id)&&e.map.removeLayer(t.id)})),e.map.getSource(u.COLD)&&e.map.removeSource(u.COLD),e.map.getSource(u.HOT)&&e.map.removeSource(u.HOT)}};return e.setup=i,i}var tt=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function et(t){return function(e){var n=e.featureTarget;return!!n&&!!n.properties&&n.properties.meta===t}}function nt(t){return!!t.originalEvent&&!!t.originalEvent.shiftKey&&0===t.originalEvent.button}function rt(t){return!!t.featureTarget&&!!t.featureTarget.properties&&t.featureTarget.properties.active===b.ACTIVE&&t.featureTarget.properties.meta===m.FEATURE}function it(t){return!!t.featureTarget&&!!t.featureTarget.properties&&t.featureTarget.properties.active===b.INACTIVE&&t.featureTarget.properties.meta===m.FEATURE}function ot(t){return void 0===t.featureTarget}function st(t){return!!t.featureTarget&&!!t.featureTarget.properties&&t.featureTarget.properties.meta===m.FEATURE}function at(t){var e=t.featureTarget;return!!e&&!!e.properties&&e.properties.meta===m.VERTEX}function ct(t){return!!t.originalEvent&&!0===t.originalEvent.shiftKey}function ut(t){return 27===t.keyCode}function lt(t){return 13===t.keyCode}var ht=Object.freeze({__proto__:null,isOfMetaType:et,isShiftMousedown:nt,isActiveFeature:rt,isInactiveFeature:it,noTarget:ot,isFeature:st,isVertex:at,isShiftDown:ct,isEscapeKey:ut,isEnterKey:lt,isTrue:function(){return!0}}),dt=ft;function ft(t,e){this.x=t,this.y=e}ft.prototype={clone:function(){return new ft(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,n=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=n,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),r=e*this.x-n*this.y,i=n*this.x+e*this.y;return this.x=r,this.y=i,this},_rotateAround:function(t,e){var n=Math.cos(t),r=Math.sin(t),i=e.x+n*(this.x-e.x)-r*(this.y-e.y),o=e.y+r*(this.x-e.x)+n*(this.y-e.y);return this.x=i,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ft.convert=function(t){return t instanceof ft?t:Array.isArray(t)?new ft(t[0],t[1]):t};var gt=e(dt);function pt(t,e){var n=e.getBoundingClientRect();return new gt(t.clientX-n.left-(e.clientLeft||0),t.clientY-n.top-(e.clientTop||0))}function mt(t,e,n,r){return{type:d.FEATURE,properties:{meta:m.VERTEX,parent:t,coord_path:n,active:r?b.ACTIVE:b.INACTIVE},geometry:{type:d.POINT,coordinates:e}}}function bt(t,e,n){var r=e.geometry.coordinates,i=n.geometry.coordinates;if(r[1]>85||r[1]<v||i[1]>85||i[1]<v)return null;var o={lng:(r[0]+i[0])/2,lat:(r[1]+i[1])/2};return{type:d.FEATURE,properties:{meta:m.MIDPOINT,parent:t,lng:o.lng,lat:o.lat,coord_path:n.properties.coord_path},geometry:{type:d.POINT,coordinates:[o.lng,o.lat]}}}function _t(t,e,n){void 0===e&&(e={}),void 0===n&&(n=null);var r,i=t.geometry,o=i.type,s=i.coordinates,a=t.properties&&t.properties.id,c=[];function u(t,n){var r="",i=null;t.forEach((function(t,o){var s=null!=n?n+"."+o:String(o),u=mt(a,t,s,l(s));if(e.midpoints&&i){var h=bt(a,i,u);h&&c.push(h)}i=u;var d=JSON.stringify(t);r!==d&&c.push(u),0===o&&(r=d)}))}function l(t){return!!e.selectedPaths&&-1!==e.selectedPaths.indexOf(t)}return o===d.POINT?c.push(mt(a,s,n,l(n))):o===d.POLYGON?s.forEach((function(t,e){u(t,null!==n?n+"."+e:String(e))})):o===d.LINE_STRING?u(s,n):0===o.indexOf(d.MULTI_PREFIX)&&(r=o.replace(d.MULTI_PREFIX,""),s.forEach((function(n,i){var o={type:d.FEATURE,properties:t.properties,geometry:{type:r,coordinates:n}};c=c.concat(_t(o,e,i))}))),c}var vt={enable:function(t){setTimeout((function(){t.map&&t.map.doubleClickZoom&&t._ctx&&t._ctx.store&&t._ctx.store.getInitialConfigValue&&t._ctx.store.getInitialConfigValue("doubleClickZoom")&&t.map.doubleClickZoom.enable()}),0)},disable:function(t){setTimeout((function(){t.map&&t.map.doubleClickZoom&&t.map.doubleClickZoom.disable()}),0)}},yt={exports:{}},At=function(t){if(!t||!t.type)return null;var e=xt[t.type];return e?"geometry"===e?{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:t}]}:"feature"===e?{type:"FeatureCollection",features:[t]}:"featurecollection"===e?t:void 0:null},xt={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},Et=e(At),Tt=Object.freeze({__proto__:null,default:function t(e){switch(e&&e.type||null){case"FeatureCollection":return e.features=e.features.reduce((function(e,n){return e.concat(t(n))}),[]),e;case"Feature":return e.geometry?t(e.geometry).map((function(t){var n={type:"Feature",properties:JSON.parse(JSON.stringify(e.properties)),geometry:t};return void 0!==e.id&&(n.id=e.id),n})):[e];case"MultiPoint":return e.coordinates.map((function(t){return{type:"Point",coordinates:t}}));case"MultiPolygon":return e.coordinates.map((function(t){return{type:"Polygon",coordinates:t}}));case"MultiLineString":return e.coordinates.map((function(t){return{type:"LineString",coordinates:t}}));case"GeometryCollection":return e.geometries.map(t).reduce((function(t,e){return t.concat(e)}),[]);case"Point":case"Polygon":case"LineString":return[e]}}}),wt=At,Ct=function(t){if(t.__esModule)return t;var e=t.default;if("function"==typeof e){var n=function t(){if(this instanceof t){var n=[null];return n.push.apply(n,arguments),new(Function.bind.apply(e,n))}return e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach((function(e){var r=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(n,e,r.get?r:{enumerable:!0,get:function(){return t[e]}})})),n}(Tt);Ct instanceof Function||(Ct=Ct.default);var St={exports:{}},Lt=St.exports=function(t){return new Ot(t)};function Ot(t){this.value=t}function It(t,e,n){var r=[],i=[],o=!0;return function t(s){var a=n?Mt(s):s,c={},u=!0,l={node:a,node_:s,path:[].concat(r),parent:i[i.length-1],parents:i,key:r.slice(-1)[0],isRoot:0===r.length,level:r.length,circular:null,update:function(t,e){l.isRoot||(l.parent.node[l.key]=t),l.node=t,e&&(u=!1)},delete:function(t){delete l.parent.node[l.key],t&&(u=!1)},remove:function(t){Rt(l.parent.node)?l.parent.node.splice(l.key,1):delete l.parent.node[l.key],t&&(u=!1)},keys:null,before:function(t){c.before=t},after:function(t){c.after=t},pre:function(t){c.pre=t},post:function(t){c.post=t},stop:function(){o=!1},block:function(){u=!1}};if(!o)return l;function h(){if("object"==typeof l.node&&null!==l.node){l.keys&&l.node_===l.node||(l.keys=Ft(l.node)),l.isLeaf=0==l.keys.length;for(var t=0;t<i.length;t++)if(i[t].node_===s){l.circular=i[t];break}}else l.isLeaf=!0,l.keys=null;l.notLeaf=!l.isLeaf,l.notRoot=!l.isRoot}h();var d=e.call(l,l.node);return void 0!==d&&l.update&&l.update(d),c.before&&c.before.call(l,l.node),u?("object"!=typeof l.node||null===l.node||l.circular||(i.push(l),h(),Bt(l.keys,(function(e,i){r.push(e),c.pre&&c.pre.call(l,l.node[e],e);var o=t(l.node[e]);n&&Nt.call(l.node,e)&&(l.node[e]=o.node),o.isLast=i==l.keys.length-1,o.isFirst=0==i,c.post&&c.post.call(l,o),r.pop()})),i.pop()),c.after&&c.after.call(l,l.node),l):l}(t).node}function Mt(t){if("object"==typeof t&&null!==t){var e;if(Rt(t))e=[];else if("[object Date]"===Pt(t))e=new Date(t.getTime?t.getTime():t);else if(function(t){return"[object RegExp]"===Pt(t)}(t))e=new RegExp(t);else if(function(t){return"[object Error]"===Pt(t)}(t))e={message:t.message};else if(function(t){return"[object Boolean]"===Pt(t)}(t))e=new Boolean(t);else if(function(t){return"[object Number]"===Pt(t)}(t))e=new Number(t);else if(function(t){return"[object String]"===Pt(t)}(t))e=new String(t);else if(Object.create&&Object.getPrototypeOf)e=Object.create(Object.getPrototypeOf(t));else if(t.constructor===Object)e={};else{var n=t.constructor&&t.constructor.prototype||t.__proto__||{},r=function(){};r.prototype=n,e=new r}return Bt(Ft(t),(function(n){e[n]=t[n]})),e}return t}Ot.prototype.get=function(t){for(var e=this.value,n=0;n<t.length;n++){var r=t[n];if(!e||!Nt.call(e,r)){e=void 0;break}e=e[r]}return e},Ot.prototype.has=function(t){for(var e=this.value,n=0;n<t.length;n++){var r=t[n];if(!e||!Nt.call(e,r))return!1;e=e[r]}return!0},Ot.prototype.set=function(t,e){for(var n=this.value,r=0;r<t.length-1;r++){var i=t[r];Nt.call(n,i)||(n[i]={}),n=n[i]}return n[t[r]]=e,e},Ot.prototype.map=function(t){return It(this.value,t,!0)},Ot.prototype.forEach=function(t){return this.value=It(this.value,t,!1),this.value},Ot.prototype.reduce=function(t,e){var n=1===arguments.length,r=n?this.value:e;return this.forEach((function(e){this.isRoot&&n||(r=t.call(this,r,e))})),r},Ot.prototype.paths=function(){var t=[];return this.forEach((function(e){t.push(this.path)})),t},Ot.prototype.nodes=function(){var t=[];return this.forEach((function(e){t.push(this.node)})),t},Ot.prototype.clone=function(){var t=[],e=[];return function n(r){for(var i=0;i<t.length;i++)if(t[i]===r)return e[i];if("object"==typeof r&&null!==r){var o=Mt(r);return t.push(r),e.push(o),Bt(Ft(r),(function(t){o[t]=n(r[t])})),t.pop(),e.pop(),o}return r}(this.value)};var Ft=Object.keys||function(t){var e=[];for(var n in t)e.push(n);return e};function Pt(t){return Object.prototype.toString.call(t)}var Rt=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},Bt=function(t,e){if(t.forEach)return t.forEach(e);for(var n=0;n<t.length;n++)e(t[n],n,t)};Bt(Ft(Ot.prototype),(function(t){Lt[t]=function(e){var n=[].slice.call(arguments,1),r=new Ot(e);return r[t].apply(r,n)}}));var Nt=Object.hasOwnProperty||function(t,e){return e in t},Dt=St.exports,kt=Ut;function Ut(t){if(!(this instanceof Ut))return new Ut(t);this._bbox=t||[1/0,1/0,-1/0,-1/0],this._valid=!!t}Ut.prototype.include=function(t){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],t[0]),this._bbox[1]=Math.min(this._bbox[1],t[1]),this._bbox[2]=Math.max(this._bbox[2],t[0]),this._bbox[3]=Math.max(this._bbox[3],t[1]),this},Ut.prototype.equals=function(t){var e;return e=t instanceof Ut?t.bbox():t,this._bbox[0]==e[0]&&this._bbox[1]==e[1]&&this._bbox[2]==e[2]&&this._bbox[3]==e[3]},Ut.prototype.center=function(t){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},Ut.prototype.union=function(t){var e;return this._valid=!0,e=t instanceof Ut?t.bbox():t,this._bbox[0]=Math.min(this._bbox[0],e[0]),this._bbox[1]=Math.min(this._bbox[1],e[1]),this._bbox[2]=Math.max(this._bbox[2],e[2]),this._bbox[3]=Math.max(this._bbox[3],e[3]),this},Ut.prototype.bbox=function(){return this._valid?this._bbox:null},Ut.prototype.contains=function(t){if(!t)return this._fastContains();if(!this._valid)return null;var e=t[0],n=t[1];return this._bbox[0]<=e&&this._bbox[1]<=n&&this._bbox[2]>=e&&this._bbox[3]>=n},Ut.prototype.intersect=function(t){return this._valid?(e=t instanceof Ut?t.bbox():t,!(this._bbox[0]>e[2]||this._bbox[2]<e[0]||this._bbox[3]<e[1]||this._bbox[1]>e[3])):null;var e},Ut.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var t="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",t)},Ut.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var Vt=function(t){if(!t)return[];var e=Ct(wt(t)),n=[];return e.features.forEach((function(t){t.geometry&&(n=n.concat(function(t){return function t(e){return Array.isArray(e)&&e.length&&"number"==typeof e[0]?[e]:e.reduce((function(e,n){return Array.isArray(n)&&Array.isArray(n[0])?e.concat(t(n)):(e.push(n),e)}),[])}(t)}(t.geometry.coordinates)))})),n},jt=Dt,Gt=kt,zt={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},Ht=Object.keys(zt);function Zt(t){for(var e=Gt(),n=Vt(t),r=0;r<n.length;r++)e.include(n[r]);return e}yt.exports=function(t){return Zt(t).bbox()},yt.exports.polygon=function(t){return Zt(t).polygon()},yt.exports.bboxify=function(t){return jt(t).map((function(t){t&&Ht.some((function(e){return!!t[e]&&-1!==zt[e].indexOf(t.type)}))&&(t.bbox=Zt(t).bbox(),this.update(t))}))};var Wt=e(yt.exports),Xt=-90;function Yt(t,e){var n=Xt,r=90,i=Xt,o=90,s=270,a=-270;t.forEach((function(t){var e=Wt(t),c=e[1],u=e[3],l=e[0],h=e[2];c>n&&(n=c),u<r&&(r=u),u>i&&(i=u),c<o&&(o=c),l<s&&(s=l),h>a&&(a=h)}));var c=e;return n+c.lat>85&&(c.lat=85-n),i+c.lat>90&&(c.lat=90-i),r+c.lat<-85&&(c.lat=-85-r),o+c.lat<Xt&&(c.lat=Xt-o),s+c.lng<=-270&&(c.lng+=360*Math.ceil(Math.abs(c.lng)/360)),a+c.lng>=270&&(c.lng-=360*Math.ceil(Math.abs(c.lng)/360)),c}function Qt(t,e){var n=Yt(t.map((function(t){return t.toGeoJSON()})),e);t.forEach((function(t){var e,r=t.getCoordinates(),i=function(t){var e={lng:t[0]+n.lng,lat:t[1]+n.lat};return[e.lng,e.lat]},o=function(t){return t.map((function(t){return i(t)}))};t.type===d.POINT?e=i(r):t.type===d.LINE_STRING||t.type===d.MULTI_POINT?e=r.map(i):t.type===d.POLYGON||t.type===d.MULTI_LINE_STRING?e=r.map(o):t.type===d.MULTI_POLYGON&&(e=r.map((function(t){return t.map((function(t){return o(t)}))}))),t.incomingCoords(e)}))}var qt={onSetup:function(t){var e=this,n={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:t.featureIds||[]};return this.setSelected(n.initiallySelectedFeatureIds.filter((function(t){return void 0!==e.getFeature(t)}))),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),n},fireUpdate:function(){this.map.fire(g.UPDATE,{action:p.MOVE,features:this.getSelected().map((function(t){return t.toGeoJSON()}))})},fireActionable:function(){var t=this,e=this.getSelected(),n=e.filter((function(e){return t.isInstanceOf("MultiFeature",e)})),r=!1;if(e.length>1){r=!0;var i=e[0].type.replace("Multi","");e.forEach((function(t){t.type.replace("Multi","")!==i&&(r=!1)}))}var o=n.length>0,s=e.length>0;this.setActionableState({combineFeatures:r,uncombineFeatures:o,trash:s})},getUniqueIds:function(t){return t.length?t.map((function(t){return t.properties.id})).filter((function(t){return void 0!==t})).reduce((function(t,e){return t.add(e),t}),new w).values():[]},stopExtendedInteractions:function(t){t.boxSelectElement&&(t.boxSelectElement.parentNode&&t.boxSelectElement.parentNode.removeChild(t.boxSelectElement),t.boxSelectElement=null),this.map.dragPan.enable(),t.boxSelecting=!1,t.canBoxSelect=!1,t.dragMoving=!1,t.canDragMove=!1},onStop:function(){vt.enable(this)},onMouseMove:function(t,e){return st(e)&&t.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(t),!0},onMouseOut:function(t){return!t.dragMoving||this.fireUpdate()}};qt.onTap=qt.onClick=function(t,e){return ot(e)?this.clickAnywhere(t,e):et(m.VERTEX)(e)?this.clickOnVertex(t,e):st(e)?this.clickOnFeature(t,e):void 0},qt.clickAnywhere=function(t){var e=this,n=this.getSelectedIds();n.length&&(this.clearSelectedFeatures(),n.forEach((function(t){return e.doRender(t)}))),vt.enable(this),this.stopExtendedInteractions(t)},qt.clickOnVertex=function(t,e){this.changeMode(f.DIRECT_SELECT,{featureId:e.featureTarget.properties.parent,coordPath:e.featureTarget.properties.coord_path,startPos:e.lngLat}),this.updateUIClasses({mouse:l.MOVE})},qt.startOnActiveFeature=function(t,e){this.stopExtendedInteractions(t),this.map.dragPan.disable(),this.doRender(e.featureTarget.properties.id),t.canDragMove=!0,t.dragMoveLocation=e.lngLat},qt.clickOnFeature=function(t,e){var n=this;vt.disable(this),this.stopExtendedInteractions(t);var r=ct(e),i=this.getSelectedIds(),o=e.featureTarget.properties.id,s=this.isSelected(o);if(!r&&s&&this.getFeature(o).type!==d.POINT)return this.changeMode(f.DIRECT_SELECT,{featureId:o});s&&r?(this.deselect(o),this.updateUIClasses({mouse:l.POINTER}),1===i.length&&vt.enable(this)):!s&&r?(this.select(o),this.updateUIClasses({mouse:l.MOVE})):s||r||(i.forEach((function(t){return n.doRender(t)})),this.setSelected(o),this.updateUIClasses({mouse:l.MOVE})),this.doRender(o)},qt.onMouseDown=function(t,e){return rt(e)?this.startOnActiveFeature(t,e):this.drawConfig.boxSelect&&nt(e)?this.startBoxSelect(t,e):void 0},qt.startBoxSelect=function(t,e){this.stopExtendedInteractions(t),this.map.dragPan.disable(),t.boxSelectStartLocation=pt(e.originalEvent,this.map.getContainer()),t.canBoxSelect=!0},qt.onTouchStart=function(t,e){if(rt(e))return this.startOnActiveFeature(t,e)},qt.onDrag=function(t,e){return t.canDragMove?this.dragMove(t,e):this.drawConfig.boxSelect&&t.canBoxSelect?this.whileBoxSelect(t,e):void 0},qt.whileBoxSelect=function(t,e){t.boxSelecting=!0,this.updateUIClasses({mouse:l.ADD}),t.boxSelectElement||(t.boxSelectElement=document.createElement("div"),t.boxSelectElement.classList.add(c.BOX_SELECT),this.map.getContainer().appendChild(t.boxSelectElement));var n=pt(e.originalEvent,this.map.getContainer()),r=Math.min(t.boxSelectStartLocation.x,n.x),i=Math.max(t.boxSelectStartLocation.x,n.x),o=Math.min(t.boxSelectStartLocation.y,n.y),s=Math.max(t.boxSelectStartLocation.y,n.y),a="translate("+r+"px, "+o+"px)";t.boxSelectElement.style.transform=a,t.boxSelectElement.style.WebkitTransform=a,t.boxSelectElement.style.width=i-r+"px",t.boxSelectElement.style.height=s-o+"px"},qt.dragMove=function(t,e){t.dragMoving=!0,e.originalEvent.stopPropagation();var n={lng:e.lngLat.lng-t.dragMoveLocation.lng,lat:e.lngLat.lat-t.dragMoveLocation.lat};Qt(this.getSelected(),n),t.dragMoveLocation=e.lngLat},qt.onTouchEnd=qt.onMouseUp=function(t,e){var n=this;if(t.dragMoving)this.fireUpdate();else if(t.boxSelecting){var r=[t.boxSelectStartLocation,pt(e.originalEvent,this.map.getContainer())],i=this.featuresAt(null,r,"click"),o=this.getUniqueIds(i).filter((function(t){return!n.isSelected(t)}));o.length&&(this.select(o),o.forEach((function(t){return n.doRender(t)})),this.updateUIClasses({mouse:l.MOVE}))}this.stopExtendedInteractions(t)},qt.toDisplayFeatures=function(t,e,n){e.properties.active=this.isSelected(e.properties.id)?b.ACTIVE:b.INACTIVE,n(e),this.fireActionable(),e.properties.active===b.ACTIVE&&e.geometry.type!==d.POINT&&_t(e).forEach(n)},qt.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},qt.onCombineFeatures=function(){var t=this.getSelected();if(!(0===t.length||t.length<2)){for(var e=[],n=[],r=t[0].type.replace("Multi",""),i=0;i<t.length;i++){var o=t[i];if(o.type.replace("Multi","")!==r)return;o.type.includes("Multi")?o.getCoordinates().forEach((function(t){e.push(t)})):e.push(o.getCoordinates()),n.push(o.toGeoJSON())}if(n.length>1){var s=this.newFeature({type:d.FEATURE,properties:n[0].properties,geometry:{type:"Multi"+r,coordinates:e}});this.addFeature(s),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([s.id]),this.map.fire(g.COMBINE_FEATURES,{createdFeatures:[s.toGeoJSON()],deletedFeatures:n})}this.fireActionable()}},qt.onUncombineFeatures=function(){var t=this,e=this.getSelected();if(0!==e.length){for(var n=[],r=[],i=function(i){var o=e[i];t.isInstanceOf("MultiFeature",o)&&(o.getFeatures().forEach((function(e){t.addFeature(e),e.properties=o.properties,n.push(e.toGeoJSON()),t.select([e.id])})),t.deleteFeature(o.id,{silent:!0}),r.push(o.toGeoJSON()))},o=0;o<e.length;o++)i(o);n.length>1&&this.map.fire(g.UNCOMBINE_FEATURES,{createdFeatures:n,deletedFeatures:r}),this.fireActionable()}};var Kt=et(m.VERTEX),Jt=et(m.MIDPOINT),$t={fireUpdate:function(){this.map.fire(g.UPDATE,{action:p.CHANGE_COORDINATES,features:this.getSelected().map((function(t){return t.toGeoJSON()}))})},fireActionable:function(t){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:t.selectedCoordPaths.length>0})},startDragging:function(t,e){this.map.dragPan.disable(),t.canDragMove=!0,t.dragMoveLocation=e.lngLat},stopDragging:function(t){this.map.dragPan.enable(),t.dragMoving=!1,t.canDragMove=!1,t.dragMoveLocation=null},onVertex:function(t,e){this.startDragging(t,e);var n=e.featureTarget.properties,r=t.selectedCoordPaths.indexOf(n.coord_path);ct(e)||-1!==r?ct(e)&&-1===r&&t.selectedCoordPaths.push(n.coord_path):t.selectedCoordPaths=[n.coord_path];var i=this.pathsToCoordinates(t.featureId,t.selectedCoordPaths);this.setSelectedCoordinates(i)},onMidpoint:function(t,e){this.startDragging(t,e);var n=e.featureTarget.properties;t.feature.addCoordinate(n.coord_path,n.lng,n.lat),this.fireUpdate(),t.selectedCoordPaths=[n.coord_path]},pathsToCoordinates:function(t,e){return e.map((function(e){return{feature_id:t,coord_path:e}}))},onFeature:function(t,e){0===t.selectedCoordPaths.length?this.startDragging(t,e):this.stopDragging(t)},dragFeature:function(t,e,n){Qt(this.getSelected(),n),t.dragMoveLocation=e.lngLat},dragVertex:function(t,e,n){for(var r=t.selectedCoordPaths.map((function(e){return t.feature.getCoordinate(e)})),i=Yt(r.map((function(t){return{type:d.FEATURE,properties:{},geometry:{type:d.POINT,coordinates:t}}})),n),o=0;o<r.length;o++){var s=r[o];t.feature.updateCoordinate(t.selectedCoordPaths[o],s[0]+i.lng,s[1]+i.lat)}},clickNoTarget:function(){this.changeMode(f.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(f.SIMPLE_SELECT)},clickActiveFeature:function(t){t.selectedCoordPaths=[],this.clearSelectedCoordinates(),t.feature.changed()},onSetup:function(t){var e=t.featureId,n=this.getFeature(e);if(!n)throw new Error("You must provide a featureId to enter direct_select mode");if(n.type===d.POINT)throw new TypeError("direct_select mode doesn't handle point features");var r={featureId:e,feature:n,dragMoveLocation:t.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:t.coordPath?[t.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(e,r.selectedCoordPaths)),this.setSelected(e),vt.disable(this),this.setActionableState({trash:!0}),r},onStop:function(){vt.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(t,e,n){t.featureId===e.properties.id?(e.properties.active=b.ACTIVE,n(e),_t(e,{map:this.map,midpoints:!0,selectedPaths:t.selectedCoordPaths}).forEach(n)):(e.properties.active=b.INACTIVE,n(e)),this.fireActionable(t)},onTrash:function(t){t.selectedCoordPaths.sort((function(t,e){return e.localeCompare(t,"en",{numeric:!0})})).forEach((function(e){return t.feature.removeCoordinate(e)})),this.fireUpdate(),t.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(t),!1===t.feature.isValid()&&(this.deleteFeature([t.featureId]),this.changeMode(f.SIMPLE_SELECT,{}))},onMouseMove:function(t,e){var n=rt(e),r=Kt(e),i=Jt(e),o=0===t.selectedCoordPaths.length;return n&&o||r&&!o?this.updateUIClasses({mouse:l.MOVE}):this.updateUIClasses({mouse:l.NONE}),(r||n||i)&&t.dragMoving&&this.fireUpdate(),this.stopDragging(t),!0},onMouseOut:function(t){return t.dragMoving&&this.fireUpdate(),!0}};$t.onTouchStart=$t.onMouseDown=function(t,e){return Kt(e)?this.onVertex(t,e):rt(e)?this.onFeature(t,e):Jt(e)?this.onMidpoint(t,e):void 0},$t.onDrag=function(t,e){if(!0===t.canDragMove){t.dragMoving=!0,e.originalEvent.stopPropagation();var n={lng:e.lngLat.lng-t.dragMoveLocation.lng,lat:e.lngLat.lat-t.dragMoveLocation.lat};t.selectedCoordPaths.length>0?this.dragVertex(t,e,n):this.dragFeature(t,e,n),t.dragMoveLocation=e.lngLat}},$t.onClick=function(t,e){return ot(e)?this.clickNoTarget(t,e):rt(e)?this.clickActiveFeature(t,e):it(e)?this.clickInactive(t,e):void this.stopDragging(t)},$t.onTap=function(t,e){return ot(e)?this.clickNoTarget(t,e):rt(e)?this.clickActiveFeature(t,e):it(e)?this.clickInactive(t,e):void 0},$t.onTouchEnd=$t.onMouseUp=function(t){t.dragMoving&&this.fireUpdate(),this.stopDragging(t)};var te={};function ee(t,e){return!!t.lngLat&&t.lngLat.lng===e[0]&&t.lngLat.lat===e[1]}te.onSetup=function(){var t=this.newFeature({type:d.FEATURE,properties:{},geometry:{type:d.POINT,coordinates:[]}});return this.addFeature(t),this.clearSelectedFeatures(),this.updateUIClasses({mouse:l.ADD}),this.activateUIButton(h.POINT),this.setActionableState({trash:!0}),{point:t}},te.stopDrawingAndRemove=function(t){this.deleteFeature([t.point.id],{silent:!0}),this.changeMode(f.SIMPLE_SELECT)},te.onTap=te.onClick=function(t,e){this.updateUIClasses({mouse:l.MOVE}),t.point.updateCoordinate("",e.lngLat.lng,e.lngLat.lat),this.map.fire(g.CREATE,{features:[t.point.toGeoJSON()]}),this.changeMode(f.SIMPLE_SELECT,{featureIds:[t.point.id]})},te.onStop=function(t){this.activateUIButton(),t.point.getCoordinate().length||this.deleteFeature([t.point.id],{silent:!0})},te.toDisplayFeatures=function(t,e,n){var r=e.properties.id===t.point.id;if(e.properties.active=r?b.ACTIVE:b.INACTIVE,!r)return n(e)},te.onTrash=te.stopDrawingAndRemove,te.onKeyUp=function(t,e){if(ut(e)||lt(e))return this.stopDrawingAndRemove(t,e)};var ne={onSetup:function(){var t=this.newFeature({type:d.FEATURE,properties:{},geometry:{type:d.POLYGON,coordinates:[[]]}});return this.addFeature(t),this.clearSelectedFeatures(),vt.disable(this),this.updateUIClasses({mouse:l.ADD}),this.activateUIButton(h.POLYGON),this.setActionableState({trash:!0}),{polygon:t,currentVertexPosition:0}},clickAnywhere:function(t,e){if(t.currentVertexPosition>0&&ee(e,t.polygon.coordinates[0][t.currentVertexPosition-1]))return this.changeMode(f.SIMPLE_SELECT,{featureIds:[t.polygon.id]});this.updateUIClasses({mouse:l.ADD}),t.polygon.updateCoordinate("0."+t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),t.currentVertexPosition++,t.polygon.updateCoordinate("0."+t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat)},clickOnVertex:function(t){return this.changeMode(f.SIMPLE_SELECT,{featureIds:[t.polygon.id]})},onMouseMove:function(t,e){t.polygon.updateCoordinate("0."+t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),at(e)&&this.updateUIClasses({mouse:l.POINTER})}};ne.onTap=ne.onClick=function(t,e){return at(e)?this.clickOnVertex(t,e):this.clickAnywhere(t,e)},ne.onKeyUp=function(t,e){ut(e)?(this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(f.SIMPLE_SELECT)):lt(e)&&this.changeMode(f.SIMPLE_SELECT,{featureIds:[t.polygon.id]})},ne.onStop=function(t){this.updateUIClasses({mouse:l.NONE}),vt.enable(this),this.activateUIButton(),void 0!==this.getFeature(t.polygon.id)&&(t.polygon.removeCoordinate("0."+t.currentVertexPosition),t.polygon.isValid()?this.map.fire(g.CREATE,{features:[t.polygon.toGeoJSON()]}):(this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(f.SIMPLE_SELECT,{},{silent:!0})))},ne.toDisplayFeatures=function(t,e,n){var r=e.properties.id===t.polygon.id;if(e.properties.active=r?b.ACTIVE:b.INACTIVE,!r)return n(e);if(0!==e.geometry.coordinates.length){var i=e.geometry.coordinates[0].length;if(!(i<3)){if(e.properties.meta=m.FEATURE,n(mt(t.polygon.id,e.geometry.coordinates[0][0],"0.0",!1)),i>3){var o=e.geometry.coordinates[0].length-3;n(mt(t.polygon.id,e.geometry.coordinates[0][o],"0."+o,!1))}if(i<=4){var s=[[e.geometry.coordinates[0][0][0],e.geometry.coordinates[0][0][1]],[e.geometry.coordinates[0][1][0],e.geometry.coordinates[0][1][1]]];if(n({type:d.FEATURE,properties:e.properties,geometry:{coordinates:s,type:d.LINE_STRING}}),3===i)return}return n(e)}}},ne.onTrash=function(t){this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(f.SIMPLE_SELECT)};var re={onSetup:function(t){var e,n,r=(t=t||{}).featureId,i="forward";if(r){if(!(e=this.getFeature(r)))throw new Error("Could not find a feature with the provided featureId");var o=t.from;if(o&&"Feature"===o.type&&o.geometry&&"Point"===o.geometry.type&&(o=o.geometry),o&&"Point"===o.type&&o.coordinates&&2===o.coordinates.length&&(o=o.coordinates),!o||!Array.isArray(o))throw new Error("Please use the `from` property to indicate which point to continue the line from");var s=e.coordinates.length-1;if(e.coordinates[s][0]===o[0]&&e.coordinates[s][1]===o[1])n=s+1,e.addCoordinate.apply(e,[n].concat(e.coordinates[s]));else{if(e.coordinates[0][0]!==o[0]||e.coordinates[0][1]!==o[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");i="backwards",n=0,e.addCoordinate.apply(e,[n].concat(e.coordinates[0]))}}else e=this.newFeature({type:d.FEATURE,properties:{},geometry:{type:d.LINE_STRING,coordinates:[]}}),n=0,this.addFeature(e);return this.clearSelectedFeatures(),vt.disable(this),this.updateUIClasses({mouse:l.ADD}),this.activateUIButton(h.LINE),this.setActionableState({trash:!0}),{line:e,currentVertexPosition:n,direction:i}},clickAnywhere:function(t,e){if(t.currentVertexPosition>0&&ee(e,t.line.coordinates[t.currentVertexPosition-1])||"backwards"===t.direction&&ee(e,t.line.coordinates[t.currentVertexPosition+1]))return this.changeMode(f.SIMPLE_SELECT,{featureIds:[t.line.id]});this.updateUIClasses({mouse:l.ADD}),t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),"forward"===t.direction?(t.currentVertexPosition++,t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat)):t.line.addCoordinate(0,e.lngLat.lng,e.lngLat.lat)},clickOnVertex:function(t){return this.changeMode(f.SIMPLE_SELECT,{featureIds:[t.line.id]})},onMouseMove:function(t,e){t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),at(e)&&this.updateUIClasses({mouse:l.POINTER})}};re.onTap=re.onClick=function(t,e){if(at(e))return this.clickOnVertex(t,e);this.clickAnywhere(t,e)},re.onKeyUp=function(t,e){lt(e)?this.changeMode(f.SIMPLE_SELECT,{featureIds:[t.line.id]}):ut(e)&&(this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(f.SIMPLE_SELECT))},re.onStop=function(t){vt.enable(this),this.activateUIButton(),void 0!==this.getFeature(t.line.id)&&(t.line.removeCoordinate(""+t.currentVertexPosition),t.line.isValid()?this.map.fire(g.CREATE,{features:[t.line.toGeoJSON()]}):(this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(f.SIMPLE_SELECT,{},{silent:!0})))},re.onTrash=function(t){this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(f.SIMPLE_SELECT)},re.toDisplayFeatures=function(t,e,n){var r=e.properties.id===t.line.id;if(e.properties.active=r?b.ACTIVE:b.INACTIVE,!r)return n(e);e.geometry.coordinates.length<2||(e.properties.meta=m.FEATURE,n(mt(t.line.id,e.geometry.coordinates["forward"===t.direction?e.geometry.coordinates.length-2:1],""+("forward"===t.direction?e.geometry.coordinates.length-2:1),!1)),n(e))};var ie={simple_select:qt,direct_select:$t,draw_point:te,draw_polygon:ne,draw_line_string:re},oe={defaultMode:f.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:tt,modes:ie,controls:{},userProperties:!1},se={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},ae={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function ce(t,e){return t.map((function(t){return t.source?t:K(t,{id:t.id+"."+e,source:"hot"===e?u.HOT:u.COLD})}))}var ue={exports:{}};!function(t,e){var r="__lodash_hash_undefined__",i=9007199254740991,o="[object Arguments]",s="[object Array]",a="[object Boolean]",c="[object Date]",u="[object Error]",l="[object Function]",h="[object Map]",d="[object Number]",f="[object Object]",g="[object Promise]",p="[object RegExp]",m="[object Set]",b="[object String]",_="[object WeakMap]",v="[object ArrayBuffer]",y="[object DataView]",A=/^\[object .+?Constructor\]$/,x=/^(?:0|[1-9]\d*)$/,E={};E["[object Float32Array]"]=E["[object Float64Array]"]=E["[object Int8Array]"]=E["[object Int16Array]"]=E["[object Int32Array]"]=E["[object Uint8Array]"]=E["[object Uint8ClampedArray]"]=E["[object Uint16Array]"]=E["[object Uint32Array]"]=!0,E[o]=E[s]=E[v]=E[a]=E[y]=E[c]=E[u]=E[l]=E[h]=E[d]=E[f]=E[p]=E[m]=E[b]=E[_]=!1;var T="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,w="object"==typeof self&&self&&self.Object===Object&&self,C=T||w||Function("return this")(),S=e&&!e.nodeType&&e,L=S&&t&&!t.nodeType&&t,O=L&&L.exports===S,I=O&&T.process,M=function(){try{return I&&I.binding&&I.binding("util")}catch(t){}}(),F=M&&M.isTypedArray;function P(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function R(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}function B(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}var N,D,k,U=Array.prototype,V=Function.prototype,j=Object.prototype,G=C["__core-js_shared__"],z=V.toString,H=j.hasOwnProperty,Z=(N=/[^.]+$/.exec(G&&G.keys&&G.keys.IE_PROTO||""))?"Symbol(src)_1."+N:"",W=j.toString,X=RegExp("^"+z.call(H).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Y=O?C.Buffer:void 0,Q=C.Symbol,q=C.Uint8Array,K=j.propertyIsEnumerable,J=U.splice,$=Q?Q.toStringTag:void 0,tt=Object.getOwnPropertySymbols,et=Y?Y.isBuffer:void 0,nt=(D=Object.keys,k=Object,function(t){return D(k(t))}),rt=Lt(C,"DataView"),it=Lt(C,"Map"),ot=Lt(C,"Promise"),st=Lt(C,"Set"),at=Lt(C,"WeakMap"),ct=Lt(Object,"create"),ut=Ft(rt),lt=Ft(it),ht=Ft(ot),dt=Ft(st),ft=Ft(at),gt=Q?Q.prototype:void 0,pt=gt?gt.valueOf:void 0;function mt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function bt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function _t(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function vt(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new _t;++e<n;)this.add(t[e])}function yt(t){var e=this.__data__=new bt(t);this.size=e.size}function At(t,e){for(var n=t.length;n--;)if(Pt(t[n][0],e))return n;return-1}function xt(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":$&&$ in Object(t)?function(t){var e=H.call(t,$),n=t[$];try{t[$]=void 0;var r=!0}catch(t){}var i=W.call(t);return r&&(e?t[$]=n:delete t[$]),i}(t):function(t){return W.call(t)}(t)}function Et(t){return Vt(t)&&xt(t)==o}function Tt(t,e,n,r,i){return t===e||(null==t||null==e||!Vt(t)&&!Vt(e)?t!=t&&e!=e:function(t,e,n,r,i,l){var g=Bt(t),_=Bt(e),A=g?s:It(t),x=_?s:It(e),E=(A=A==o?f:A)==f,T=(x=x==o?f:x)==f,w=A==x;if(w&&Nt(t)){if(!Nt(e))return!1;g=!0,E=!1}if(w&&!E)return l||(l=new yt),g||jt(t)?wt(t,e,n,r,i,l):function(t,e,n,r,i,o,s){switch(n){case y:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case v:return!(t.byteLength!=e.byteLength||!o(new q(t),new q(e)));case a:case c:case d:return Pt(+t,+e);case u:return t.name==e.name&&t.message==e.message;case p:case b:return t==e+"";case h:var l=R;case m:var f=1&r;if(l||(l=B),t.size!=e.size&&!f)return!1;var g=s.get(t);if(g)return g==e;r|=2,s.set(t,e);var _=wt(l(t),l(e),r,i,o,s);return s.delete(t),_;case"[object Symbol]":if(pt)return pt.call(t)==pt.call(e)}return!1}(t,e,A,n,r,i,l);if(!(1&n)){var C=E&&H.call(t,"__wrapped__"),S=T&&H.call(e,"__wrapped__");if(C||S){var L=C?t.value():t,O=S?e.value():e;return l||(l=new yt),i(L,O,n,r,l)}}return!!w&&(l||(l=new yt),function(t,e,n,r,i,o){var s=1&n,a=Ct(t),c=a.length;if(c!=Ct(e).length&&!s)return!1;for(var u=c;u--;){var l=a[u];if(!(s?l in e:H.call(e,l)))return!1}var h=o.get(t);if(h&&o.get(e))return h==e;var d=!0;o.set(t,e),o.set(e,t);for(var f=s;++u<c;){var g=t[l=a[u]],p=e[l];if(r)var m=s?r(p,g,l,e,t,o):r(g,p,l,t,e,o);if(!(void 0===m?g===p||i(g,p,n,r,o):m)){d=!1;break}f||(f="constructor"==l)}if(d&&!f){var b=t.constructor,_=e.constructor;b==_||!("constructor"in t)||!("constructor"in e)||"function"==typeof b&&b instanceof b&&"function"==typeof _&&_ instanceof _||(d=!1)}return o.delete(t),o.delete(e),d}(t,e,n,r,i,l))}(t,e,n,r,Tt,i))}function wt(t,e,n,r,i,o){var s=1&n,a=t.length,c=e.length;if(a!=c&&!(s&&c>a))return!1;var u=o.get(t);if(u&&o.get(e))return u==e;var l=-1,h=!0,d=2&n?new vt:void 0;for(o.set(t,e),o.set(e,t);++l<a;){var f=t[l],g=e[l];if(r)var p=s?r(g,f,l,e,t,o):r(f,g,l,t,e,o);if(void 0!==p){if(p)continue;h=!1;break}if(d){if(!P(e,(function(t,e){if(s=e,!d.has(s)&&(f===t||i(f,t,n,r,o)))return d.push(e);var s}))){h=!1;break}}else if(f!==g&&!i(f,g,n,r,o)){h=!1;break}}return o.delete(t),o.delete(e),h}function Ct(t){return function(t,e,n){var r=e(t);return Bt(t)?r:function(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}(r,n(t))}(t,Gt,Ot)}function St(t,e){var n,r,i=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function Lt(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return function(t){return!(!Ut(t)||function(t){return!!Z&&Z in t}(t))&&(Dt(t)?X:A).test(Ft(t))}(n)?n:void 0}mt.prototype.clear=function(){this.__data__=ct?ct(null):{},this.size=0},mt.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},mt.prototype.get=function(t){var e=this.__data__;if(ct){var n=e[t];return n===r?void 0:n}return H.call(e,t)?e[t]:void 0},mt.prototype.has=function(t){var e=this.__data__;return ct?void 0!==e[t]:H.call(e,t)},mt.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=ct&&void 0===e?r:e,this},bt.prototype.clear=function(){this.__data__=[],this.size=0},bt.prototype.delete=function(t){var e=this.__data__,n=At(e,t);return!(n<0||(n==e.length-1?e.pop():J.call(e,n,1),--this.size,0))},bt.prototype.get=function(t){var e=this.__data__,n=At(e,t);return n<0?void 0:e[n][1]},bt.prototype.has=function(t){return At(this.__data__,t)>-1},bt.prototype.set=function(t,e){var n=this.__data__,r=At(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this},_t.prototype.clear=function(){this.size=0,this.__data__={hash:new mt,map:new(it||bt),string:new mt}},_t.prototype.delete=function(t){var e=St(this,t).delete(t);return this.size-=e?1:0,e},_t.prototype.get=function(t){return St(this,t).get(t)},_t.prototype.has=function(t){return St(this,t).has(t)},_t.prototype.set=function(t,e){var n=St(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},vt.prototype.add=vt.prototype.push=function(t){return this.__data__.set(t,r),this},vt.prototype.has=function(t){return this.__data__.has(t)},yt.prototype.clear=function(){this.__data__=new bt,this.size=0},yt.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},yt.prototype.get=function(t){return this.__data__.get(t)},yt.prototype.has=function(t){return this.__data__.has(t)},yt.prototype.set=function(t,e){var n=this.__data__;if(n instanceof bt){var r=n.__data__;if(!it||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new _t(r)}return n.set(t,e),this.size=n.size,this};var Ot=tt?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var n=-1,r=null==t?0:t.length,i=0,o=[];++n<r;){var s=t[n];e(s)&&(o[i++]=s)}return o}(tt(t),(function(e){return K.call(t,e)})))}:function(){return[]},It=xt;function Mt(t,e){return!!(e=null==e?i:e)&&("number"==typeof t||x.test(t))&&t>-1&&t%1==0&&t<e}function Ft(t){if(null!=t){try{return z.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Pt(t,e){return t===e||t!=t&&e!=e}(rt&&It(new rt(new ArrayBuffer(1)))!=y||it&&It(new it)!=h||ot&&It(ot.resolve())!=g||st&&It(new st)!=m||at&&It(new at)!=_)&&(It=function(t){var e=xt(t),n=e==f?t.constructor:void 0,r=n?Ft(n):"";if(r)switch(r){case ut:return y;case lt:return h;case ht:return g;case dt:return m;case ft:return _}return e});var Rt=Et(function(){return arguments}())?Et:function(t){return Vt(t)&&H.call(t,"callee")&&!K.call(t,"callee")},Bt=Array.isArray,Nt=et||function(){return!1};function Dt(t){if(!Ut(t))return!1;var e=xt(t);return e==l||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}function kt(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=i}function Ut(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function Vt(t){return null!=t&&"object"==typeof t}var jt=F?function(t){return function(e){return t(e)}}(F):function(t){return Vt(t)&&kt(t.length)&&!!E[xt(t)]};function Gt(t){return null!=(e=t)&&kt(e.length)&&!Dt(e)?function(t,e){var n=Bt(t),r=!n&&Rt(t),i=!n&&!r&&Nt(t),o=!n&&!r&&!i&&jt(t),s=n||r||i||o,a=s?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],c=a.length;for(var u in t)!e&&!H.call(t,u)||s&&("length"==u||i&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Mt(u,c))||a.push(u);return a}(t):function(t){if(n=(e=t)&&e.constructor,e!==("function"==typeof n&&n.prototype||j))return nt(t);var e,n,r=[];for(var i in Object(t))H.call(t,i)&&"constructor"!=i&&r.push(i);return r}(t);var e}t.exports=function(t,e){return Tt(t,e)}}(ue,ue.exports);var le=e(ue.exports);function he(t,e){return t.length===e.length&&JSON.stringify(t.map((function(t){return t})).sort())===JSON.stringify(e.map((function(t){return t})).sort())}var de={Polygon:U,LineString:k,Point:D,MultiPolygon:G,MultiLineString:G,MultiPoint:G},fe=Object.freeze({__proto__:null,CommonSelectors:ht,constrainFeatureMovement:Yt,createMidPoint:bt,createSupplementaryPoints:_t,createVertex:mt,doubleClickZoom:vt,euclideanDistance:I,featuresAt:S,getFeatureAtAndSetCursors:O,isClick:M,isEventAtCoordinates:ee,isTap:F,mapEventToBoundingBox:T,ModeHandler:t,moveFeatures:Qt,sortFeatures:E,stringSetsAreEqual:he,StringSet:w,theme:tt,toDenseArray:W});function ge(t){!function(t,e){var n={options:t=function(t){void 0===t&&(t={});var e=K(t);return t.controls||(e.controls={}),!1===t.displayControlsDefault?e.controls=K(ae,t.controls):e.controls=K(se,t.controls),(e=K(oe,e)).styles=ce(e.styles,"cold").concat(ce(e.styles,"hot")),e}(t)};e=function(t,e){return e.modes=f,e.getFeatureIdsAt=function(e){return S.click({point:e},null,t).map((function(t){return t.properties.id}))},e.getSelectedIds=function(){return t.store.getSelectedIds()},e.getSelected=function(){return{type:d.FEATURE_COLLECTION,features:t.store.getSelectedIds().map((function(e){return t.store.get(e)})).map((function(t){return t.toGeoJSON()}))}},e.getSelectedPoints=function(){return{type:d.FEATURE_COLLECTION,features:t.store.getSelectedCoordinates().map((function(t){return{type:d.FEATURE,properties:{},geometry:{type:d.POINT,coordinates:t.coordinates}}}))}},e.set=function(n){if(void 0===n.type||n.type!==d.FEATURE_COLLECTION||!Array.isArray(n.features))throw new Error("Invalid FeatureCollection");var r=t.store.createRenderBatch(),i=t.store.getAllIds().slice(),o=e.add(n),s=new w(o);return(i=i.filter((function(t){return!s.has(t)}))).length&&e.delete(i),r(),o},e.add=function(e){var n=JSON.parse(JSON.stringify(Et(e))).features.map((function(e){if(e.id=e.id||B(),null===e.geometry)throw new Error("Invalid geometry: null");if(void 0===t.store.get(e.id)||t.store.get(e.id).type!==e.geometry.type){var n=de[e.geometry.type];if(void 0===n)throw new Error("Invalid geometry type: "+e.geometry.type+".");var r=new n(t,e);t.store.add(r)}else{var i=t.store.get(e.id);i.properties=e.properties,le(i.properties,e.properties)||t.store.featureChanged(i.id),le(i.getCoordinates(),e.geometry.coordinates)||i.incomingCoords(e.geometry.coordinates)}return e.id}));return t.store.render(),n},e.get=function(e){var n=t.store.get(e);if(n)return n.toGeoJSON()},e.getAll=function(){return{type:d.FEATURE_COLLECTION,features:t.store.getAll().map((function(t){return t.toGeoJSON()}))}},e.delete=function(n){return t.store.delete(n,{silent:!0}),e.getMode()!==f.DIRECT_SELECT||t.store.getSelectedIds().length?t.store.render():t.events.changeMode(f.SIMPLE_SELECT,void 0,{silent:!0}),e},e.deleteAll=function(){return t.store.delete(t.store.getAllIds(),{silent:!0}),e.getMode()===f.DIRECT_SELECT?t.events.changeMode(f.SIMPLE_SELECT,void 0,{silent:!0}):t.store.render(),e},e.changeMode=function(n,r){return void 0===r&&(r={}),n===f.SIMPLE_SELECT&&e.getMode()===f.SIMPLE_SELECT?(he(r.featureIds||[],t.store.getSelectedIds())||(t.store.setSelected(r.featureIds,{silent:!0}),t.store.render()),e):(n===f.DIRECT_SELECT&&e.getMode()===f.DIRECT_SELECT&&r.featureId===t.store.getSelectedIds()[0]||t.events.changeMode(n,r,{silent:!0}),e)},e.getMode=function(){return t.events.getMode()},e.trash=function(){return t.events.trash({silent:!0}),e},e.combineFeatures=function(){return t.events.combineFeatures({silent:!0}),e},e.uncombineFeatures=function(){return t.events.uncombineFeatures({silent:!0}),e},e.setFeatureProperty=function(n,r,i){return t.store.setFeatureProperty(n,r,i),e},e}(n,e),n.api=e;var r=$(n);e.onAdd=r.onAdd,e.onRemove=r.onRemove,e.types=h,e.options=t}(t,this)}return ge.modes=ie,ge.constants=y,ge.lib=fe,ge}()},557976:t=>{t.exports=function(){var t,e=arguments.length;if(1===e)t=arguments[0];else{t=[];for(var n=0;n<e;n++)t.push(arguments[n])}var r=[];function i(){t.forEach((function(t,e){t.on("move",r[e])}))}function o(){t.forEach((function(t,e){t.off("move",r[e])}))}function s(t,e){o(),function(t,e){var n=t.getCenter(),r=t.getZoom(),i=t.getBearing(),o=t.getPitch();e.forEach((function(t){t.jumpTo({center:n,zoom:r,bearing:i,pitch:o})}))}(t,e),i()}return t.forEach((function(e,n){r[n]=s.bind(null,e,t.filter((function(t,e){return e!==n})))})),i(),function(){o(),r=[],t=[]}}},287596:t=>{function e(t,e){var r=n(t,e);return r.whole+" "+(r.minutes?r.minutes+"' ":"")+(r.seconds?r.seconds+'" ':"")+r.dir}function n(t,e){var n=({lat:["N","S"],lon:["E","W"]}[e]||"")[t>=0?0:1],r=Math.abs(t),i=Math.floor(r),o=60*(r-i),s=Math.floor(o);return{whole:i,minutes:s,seconds:Math.floor(60*(o-s)),dir:n}}function r(t,e){if(e||(e="NSEW"),"string"!=typeof t)return null;var n=(t=t.toUpperCase()).match(/^[\s\,]*([NSEW])?\s*([\-|\|\]?[0-9.]+)[]?\s*(?:([0-9.]+)[']\s*)?(?:([0-9.]+)(?:''|"||)\s*)?([NSEW])?/);if(!n)return null;var r,i=n[0];if(n[1]&&n[5]?(r=n[1],i=i.slice(0,-1)):r=n[1]||n[5],r&&-1===e.indexOf(r))return null;var o=n[2]?parseFloat(n[2]):0,s=n[3]?parseFloat(n[3])/60:0,a=n[4]?parseFloat(n[4])/3600:0,c=o<0?-1:1;return"S"!==r&&"W"!==r||(c*=-1),{val:(Math.abs(o)+s+a)*c,dim:r,matched:i,remain:t.slice(i.length)}}t.exports=function(t,e){var n=r(t,e);return null===n?null:n.val},t.exports.pair=function(t,e){var n=r(t=t.trim(),e);if(!n)return null;var i,o,s,a=r(t=n.remain.trim(),e);return!a||a.remain?null:n.dim?(i=n.val,o=a.val,"N"===(s=n.dim)||"S"===s?[i,o]:"W"===s||"E"===s?[o,i]:void 0):[n.val,a.val]},t.exports.format=e,t.exports.formatPair=function(t){return e(t.lat,"lat")+" "+e(t.lon,"lon")},t.exports.coordToDMS=n},823247:(t,e,n)=>{"use strict";n.d(e,{Z:()=>a});var r=n(900516),i=n.n(r),o=n(593694),s=n.n(o)()(i());s.push([t.id,'\n/* Override default control style */\n.mapbox-gl-draw_ctrl-bottom-left,\n.mapbox-gl-draw_ctrl-top-left {\n  margin-left:0;\n  border-radius:0 4px 4px 0;\n}\n.mapbox-gl-draw_ctrl-top-right,\n.mapbox-gl-draw_ctrl-bottom-right {\n  margin-right:0;\n  border-radius:4px 0 0 4px;\n}\n\n.mapbox-gl-draw_ctrl-draw-btn {\n  border-color:rgba(0,0,0,0.9);\n  color:rgba(255,255,255,0.5);\n  width:30px;\n  height:30px;\n}\n\n.mapbox-gl-draw_ctrl-draw-btn.active,\n.mapbox-gl-draw_ctrl-draw-btn.active:hover {\n  background-color:rgb(0 0 0/5%);\n}\n.mapbox-gl-draw_ctrl-draw-btn {\n  background-repeat: no-repeat;\n  background-position: center;\n}\n\n.mapbox-gl-draw_point {\n  background-image: url(\'data:image/svg+xml;utf8,%3Csvg xmlns="http://www.w3.org/2000/svg" width="20" height="20">%3Cpath d="m10 2c-3.3 0-6 2.7-6 6s6 9 6 9 6-5.7 6-9-2.7-6-6-6zm0 2c2.1 0 3.8 1.7 3.8 3.8 0 1.5-1.8 3.9-2.9 5.2h-1.7c-1.1-1.4-2.9-3.8-2.9-5.2-.1-2.1 1.6-3.8 3.7-3.8z"/>%3C/svg>\');\n}\n.mapbox-gl-draw_polygon {\n  background-image: url(\'data:image/svg+xml;utf8,%3Csvg xmlns="http://www.w3.org/2000/svg" width="20" height="20">%3Cpath d="m15 12.3v-4.6c.6-.3 1-1 1-1.7 0-1.1-.9-2-2-2-.7 0-1.4.4-1.7 1h-4.6c-.3-.6-1-1-1.7-1-1.1 0-2 .9-2 2 0 .7.4 1.4 1 1.7v4.6c-.6.3-1 1-1 1.7 0 1.1.9 2 2 2 .7 0 1.4-.4 1.7-1h4.6c.3.6 1 1 1.7 1 1.1 0 2-.9 2-2 0-.7-.4-1.4-1-1.7zm-8-.3v-4l1-1h4l1 1v4l-1 1h-4z"/>%3C/svg>\');\n}\n.mapbox-gl-draw_line {\n  background-image: url(\'data:image/svg+xml;utf8,%3Csvg xmlns="http://www.w3.org/2000/svg" width="20" height="20">%3Cpath d="m13.5 3.5c-1.4 0-2.5 1.1-2.5 2.5 0 .3 0 .6.2.9l-3.8 3.8c-.3-.1-.6-.2-.9-.2-1.4 0-2.5 1.1-2.5 2.5s1.1 2.5 2.5 2.5 2.5-1.1 2.5-2.5c0-.3 0-.6-.2-.9l3.8-3.8c.3.1.6.2.9.2 1.4 0 2.5-1.1 2.5-2.5s-1.1-2.5-2.5-2.5z"/>%3C/svg>\');\n}\n.mapbox-gl-draw_trash {\n  background-image: url(\'data:image/svg+xml;utf8,%3Csvg xmlns="http://www.w3.org/2000/svg" width="20" height="20">%3Cpath d="M10,3.4 c-0.8,0-1.5,0.5-1.8,1.2H5l-1,1v1h12v-1l-1-1h-3.2C11.5,3.9,10.8,3.4,10,3.4z M5,8v7c0,1,1,2,2,2h6c1,0,2-1,2-2V8h-2v5.5h-1.5V8h-3 v5.5H7V8H5z"/>%3C/svg>\');\n}\n.mapbox-gl-draw_uncombine {\n  background-image: url(\'data:image/svg+xml;utf8,%3Csvg xmlns="http://www.w3.org/2000/svg" width="20" height="20">%3Cpath d="m12 2c-.3 0-.5.1-.7.3l-1 1c-.4.4-.4 1 0 1.4l1 1c.4.4 1 .4 1.4 0l1-1c.4-.4.4-1 0-1.4l-1-1c-.2-.2-.4-.3-.7-.3zm4 4c-.3 0-.5.1-.7.3l-1 1c-.4.4-.4 1 0 1.4l1 1c.4.4 1 .4 1.4 0l1-1c.4-.4.4-1 0-1.4l-1-1c-.2-.2-.4-.3-.7-.3zm-7 1c-1 0-1 1-.5 1.5.3.3 1 1 1 1l-1 1s-.5.5 0 1 1 0 1 0l1-1 1 1c.5.5 1.5.5 1.5-.5v-4zm-5 3c-.3 0-.5.1-.7.3l-1 1c-.4.4-.4 1 0 1.4l4.9 4.9c.4.4 1 .4 1.4 0l1-1c.4-.4.4-1 0-1.4l-4.9-4.9c-.1-.2-.4-.3-.7-.3z"/>%3C/svg>\');\n}\n.mapbox-gl-draw_combine {\n  background-image: url(\'data:image/svg+xml;utf8,%3Csvg xmlns="http://www.w3.org/2000/svg" width="20" height="20">%3Cpath d="M12.1,2c-0.3,0-0.5,0.1-0.7,0.3l-1,1c-0.4,0.4-0.4,1,0,1.4l4.9,4.9c0.4,0.4,1,0.4,1.4,0l1-1 c0.4-0.4,0.4-1,0-1.4l-4.9-4.9C12.6,2.1,12.3,2,12.1,2z M8,8C7,8,7,9,7.5,9.5c0.3,0.3,1,1,1,1l-1,1c0,0-0.5,0.5,0,1s1,0,1,0l1-1l1,1 C11,13,12,13,12,12V8H8z M4,10c-0.3,0-0.5,0.1-0.7,0.3l-1,1c-0.4,0.4-0.4,1,0,1.4l1,1c0.4,0.4,1,0.4,1.4,0l1-1c0.4-0.4,0.4-1,0-1.4 l-1-1C4.5,10.1,4.3,10,4,10z M8,14c-0.3,0-0.5,0.1-0.7,0.3l-1,1c-0.4,0.4-0.4,1,0,1.4l1,1c0.4,0.4,1,0.4,1.4,0l1-1 c0.4-0.4,0.4-1,0-1.4l-1-1C8.5,14.1,8.3,14,8,14z"/>%3C/svg>\');\n}\n\n.mapboxgl-map.mouse-pointer .mapboxgl-canvas-container.mapboxgl-interactive {\n  cursor: pointer;\n}\n.mapboxgl-map.mouse-move .mapboxgl-canvas-container.mapboxgl-interactive {\n  cursor: move;\n}\n.mapboxgl-map.mouse-add .mapboxgl-canvas-container.mapboxgl-interactive {\n  cursor: crosshair;\n}\n.mapboxgl-map.mouse-move.mode-direct_select .mapboxgl-canvas-container.mapboxgl-interactive {\n  cursor: grab;\n  cursor: -moz-grab;\n  cursor: -webkit-grab;\n}\n.mapboxgl-map.mode-direct_select.feature-vertex.mouse-move .mapboxgl-canvas-container.mapboxgl-interactive {\n  cursor: move;\n}\n.mapboxgl-map.mode-direct_select.feature-midpoint.mouse-pointer .mapboxgl-canvas-container.mapboxgl-interactive {\n  cursor: cell;\n}\n.mapboxgl-map.mode-direct_select.feature-feature.mouse-move .mapboxgl-canvas-container.mapboxgl-interactive {\n  cursor: move;\n}\n.mapboxgl-map.mode-static.mouse-pointer  .mapboxgl-canvas-container.mapboxgl-interactive {\n  cursor: grab;\n  cursor: -moz-grab;\n  cursor: -webkit-grab;\n}\n\n.mapbox-gl-draw_boxselect {\n    pointer-events: none;\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 0;\n    height: 0;\n    background: rgba(0,0,0,.1);\n    border: 2px dotted #fff;\n    opacity: 0.5;\n}\n',"",{version:3,sources:["webpack://./node_modules/@mapbox/mapbox-gl-draw/dist/mapbox-gl-draw.css"],names:[],mappings:";AACA,mCAAmC;AACnC;;EAEE,aAAa;EACb,yBAAyB;AAC3B;AACA;;EAEE,cAAc;EACd,yBAAyB;AAC3B;;AAEA;EACE,4BAA4B;EAC5B,2BAA2B;EAC3B,UAAU;EACV,WAAW;AACb;;AAEA;;EAEE,8BAA8B;AAChC;AACA;EACE,4BAA4B;EAC5B,2BAA2B;AAC7B;;AAEA;EACE,iSAAiS;AACnS;AACA;EACE,kYAAkY;AACpY;AACA;EACE,qVAAqV;AACvV;AACA;EACE,0RAA0R;AAC5R;AACA;EACE,yiBAAyiB;AAC3iB;AACA;EACE,8nBAA8nB;AAChoB;;AAEA;EACE,eAAe;AACjB;AACA;EACE,YAAY;AACd;AACA;EACE,iBAAiB;AACnB;AACA;EACE,YAAY;EACZ,iBAAiB;EACjB,oBAAoB;AACtB;AACA;EACE,YAAY;AACd;AACA;EACE,YAAY;AACd;AACA;EACE,YAAY;AACd;AACA;EACE,YAAY;EACZ,iBAAiB;EACjB,oBAAoB;AACtB;;AAEA;IACI,oBAAoB;IACpB,kBAAkB;IAClB,MAAM;IACN,OAAO;IACP,QAAQ;IACR,SAAS;IACT,0BAA0B;IAC1B,uBAAuB;IACvB,YAAY;AAChB",sourcesContent:['\n/* Override default control style */\n.mapbox-gl-draw_ctrl-bottom-left,\n.mapbox-gl-draw_ctrl-top-left {\n  margin-left:0;\n  border-radius:0 4px 4px 0;\n}\n.mapbox-gl-draw_ctrl-top-right,\n.mapbox-gl-draw_ctrl-bottom-right {\n  margin-right:0;\n  border-radius:4px 0 0 4px;\n}\n\n.mapbox-gl-draw_ctrl-draw-btn {\n  border-color:rgba(0,0,0,0.9);\n  color:rgba(255,255,255,0.5);\n  width:30px;\n  height:30px;\n}\n\n.mapbox-gl-draw_ctrl-draw-btn.active,\n.mapbox-gl-draw_ctrl-draw-btn.active:hover {\n  background-color:rgb(0 0 0/5%);\n}\n.mapbox-gl-draw_ctrl-draw-btn {\n  background-repeat: no-repeat;\n  background-position: center;\n}\n\n.mapbox-gl-draw_point {\n  background-image: url(\'data:image/svg+xml;utf8,%3Csvg xmlns="http://www.w3.org/2000/svg" width="20" height="20">%3Cpath d="m10 2c-3.3 0-6 2.7-6 6s6 9 6 9 6-5.7 6-9-2.7-6-6-6zm0 2c2.1 0 3.8 1.7 3.8 3.8 0 1.5-1.8 3.9-2.9 5.2h-1.7c-1.1-1.4-2.9-3.8-2.9-5.2-.1-2.1 1.6-3.8 3.7-3.8z"/>%3C/svg>\');\n}\n.mapbox-gl-draw_polygon {\n  background-image: url(\'data:image/svg+xml;utf8,%3Csvg xmlns="http://www.w3.org/2000/svg" width="20" height="20">%3Cpath d="m15 12.3v-4.6c.6-.3 1-1 1-1.7 0-1.1-.9-2-2-2-.7 0-1.4.4-1.7 1h-4.6c-.3-.6-1-1-1.7-1-1.1 0-2 .9-2 2 0 .7.4 1.4 1 1.7v4.6c-.6.3-1 1-1 1.7 0 1.1.9 2 2 2 .7 0 1.4-.4 1.7-1h4.6c.3.6 1 1 1.7 1 1.1 0 2-.9 2-2 0-.7-.4-1.4-1-1.7zm-8-.3v-4l1-1h4l1 1v4l-1 1h-4z"/>%3C/svg>\');\n}\n.mapbox-gl-draw_line {\n  background-image: url(\'data:image/svg+xml;utf8,%3Csvg xmlns="http://www.w3.org/2000/svg" width="20" height="20">%3Cpath d="m13.5 3.5c-1.4 0-2.5 1.1-2.5 2.5 0 .3 0 .6.2.9l-3.8 3.8c-.3-.1-.6-.2-.9-.2-1.4 0-2.5 1.1-2.5 2.5s1.1 2.5 2.5 2.5 2.5-1.1 2.5-2.5c0-.3 0-.6-.2-.9l3.8-3.8c.3.1.6.2.9.2 1.4 0 2.5-1.1 2.5-2.5s-1.1-2.5-2.5-2.5z"/>%3C/svg>\');\n}\n.mapbox-gl-draw_trash {\n  background-image: url(\'data:image/svg+xml;utf8,%3Csvg xmlns="http://www.w3.org/2000/svg" width="20" height="20">%3Cpath d="M10,3.4 c-0.8,0-1.5,0.5-1.8,1.2H5l-1,1v1h12v-1l-1-1h-3.2C11.5,3.9,10.8,3.4,10,3.4z M5,8v7c0,1,1,2,2,2h6c1,0,2-1,2-2V8h-2v5.5h-1.5V8h-3 v5.5H7V8H5z"/>%3C/svg>\');\n}\n.mapbox-gl-draw_uncombine {\n  background-image: url(\'data:image/svg+xml;utf8,%3Csvg xmlns="http://www.w3.org/2000/svg" width="20" height="20">%3Cpath d="m12 2c-.3 0-.5.1-.7.3l-1 1c-.4.4-.4 1 0 1.4l1 1c.4.4 1 .4 1.4 0l1-1c.4-.4.4-1 0-1.4l-1-1c-.2-.2-.4-.3-.7-.3zm4 4c-.3 0-.5.1-.7.3l-1 1c-.4.4-.4 1 0 1.4l1 1c.4.4 1 .4 1.4 0l1-1c.4-.4.4-1 0-1.4l-1-1c-.2-.2-.4-.3-.7-.3zm-7 1c-1 0-1 1-.5 1.5.3.3 1 1 1 1l-1 1s-.5.5 0 1 1 0 1 0l1-1 1 1c.5.5 1.5.5 1.5-.5v-4zm-5 3c-.3 0-.5.1-.7.3l-1 1c-.4.4-.4 1 0 1.4l4.9 4.9c.4.4 1 .4 1.4 0l1-1c.4-.4.4-1 0-1.4l-4.9-4.9c-.1-.2-.4-.3-.7-.3z"/>%3C/svg>\');\n}\n.mapbox-gl-draw_combine {\n  background-image: url(\'data:image/svg+xml;utf8,%3Csvg xmlns="http://www.w3.org/2000/svg" width="20" height="20">%3Cpath d="M12.1,2c-0.3,0-0.5,0.1-0.7,0.3l-1,1c-0.4,0.4-0.4,1,0,1.4l4.9,4.9c0.4,0.4,1,0.4,1.4,0l1-1 c0.4-0.4,0.4-1,0-1.4l-4.9-4.9C12.6,2.1,12.3,2,12.1,2z M8,8C7,8,7,9,7.5,9.5c0.3,0.3,1,1,1,1l-1,1c0,0-0.5,0.5,0,1s1,0,1,0l1-1l1,1 C11,13,12,13,12,12V8H8z M4,10c-0.3,0-0.5,0.1-0.7,0.3l-1,1c-0.4,0.4-0.4,1,0,1.4l1,1c0.4,0.4,1,0.4,1.4,0l1-1c0.4-0.4,0.4-1,0-1.4 l-1-1C4.5,10.1,4.3,10,4,10z M8,14c-0.3,0-0.5,0.1-0.7,0.3l-1,1c-0.4,0.4-0.4,1,0,1.4l1,1c0.4,0.4,1,0.4,1.4,0l1-1 c0.4-0.4,0.4-1,0-1.4l-1-1C8.5,14.1,8.3,14,8,14z"/>%3C/svg>\');\n}\n\n.mapboxgl-map.mouse-pointer .mapboxgl-canvas-container.mapboxgl-interactive {\n  cursor: pointer;\n}\n.mapboxgl-map.mouse-move .mapboxgl-canvas-container.mapboxgl-interactive {\n  cursor: move;\n}\n.mapboxgl-map.mouse-add .mapboxgl-canvas-container.mapboxgl-interactive {\n  cursor: crosshair;\n}\n.mapboxgl-map.mouse-move.mode-direct_select .mapboxgl-canvas-container.mapboxgl-interactive {\n  cursor: grab;\n  cursor: -moz-grab;\n  cursor: -webkit-grab;\n}\n.mapboxgl-map.mode-direct_select.feature-vertex.mouse-move .mapboxgl-canvas-container.mapboxgl-interactive {\n  cursor: move;\n}\n.mapboxgl-map.mode-direct_select.feature-midpoint.mouse-pointer .mapboxgl-canvas-container.mapboxgl-interactive {\n  cursor: cell;\n}\n.mapboxgl-map.mode-direct_select.feature-feature.mouse-move .mapboxgl-canvas-container.mapboxgl-interactive {\n  cursor: move;\n}\n.mapboxgl-map.mode-static.mouse-pointer  .mapboxgl-canvas-container.mapboxgl-interactive {\n  cursor: grab;\n  cursor: -moz-grab;\n  cursor: -webkit-grab;\n}\n\n.mapbox-gl-draw_boxselect {\n    pointer-events: none;\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 0;\n    height: 0;\n    background: rgba(0,0,0,.1);\n    border: 2px dotted #fff;\n    opacity: 0.5;\n}\n'],sourceRoot:""}]);const a=s},872380:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>s});var r=n(116785),i=n.n(r),o=n(823247);i()(o.Z,{insert:"head",singleton:!1});const s=o.Z.locals||{}},639875:(t,e,n)=>{"use strict";n.d(e,{Z:()=>i});const r=1e20;class i{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:r=.25,fontFamily:i="sans-serif",fontWeight:o="normal",fontStyle:s="normal"}={}){this.buffer=e,this.cutoff=r,this.radius=n;const a=this.size=t+4*e,c=this._createCanvas(a),u=this.ctx=c.getContext("2d",{willReadFrequently:!0});u.font=`${s} ${o} ${t}px ${i}`,u.textBaseline="alphabetic",u.textAlign="left",u.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:s,actualBoundingBoxRight:a}=this.ctx.measureText(t),c=Math.ceil(n),u=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(a-s))),l=Math.min(this.size-this.buffer,c+Math.ceil(i)),h=u+2*this.buffer,d=l+2*this.buffer,f=Math.max(h*d,0),g=new Uint8ClampedArray(f),p={data:g,width:h,height:d,glyphWidth:u,glyphHeight:l,glyphTop:c,glyphLeft:0,glyphAdvance:e};if(0===u||0===l)return p;const{ctx:m,buffer:b,gridInner:_,gridOuter:v}=this;m.clearRect(b,b,u,l),m.fillText(t,b,b+c);const y=m.getImageData(b,b,u,l);v.fill(r,0,f),_.fill(0,0,f);for(let t=0;t<l;t++)for(let e=0;e<u;e++){const n=y.data[4*(t*u+e)+3]/255;if(0===n)continue;const i=(t+b)*h+e+b;if(1===n)v[i]=0,_[i]=r;else{const t=.5-n;v[i]=t>0?t*t:0,_[i]=t<0?t*t:0}}o(v,0,0,h,d,h,this.f,this.v,this.z),o(_,b,b,u,l,h,this.f,this.v,this.z);for(let t=0;t<f;t++){const e=Math.sqrt(v[t])-Math.sqrt(_[t]);g[t]=Math.round(255-255*(e/this.radius+this.cutoff))}return p}}function o(t,e,n,r,i,o,a,c,u){for(let l=e;l<e+r;l++)s(t,n*o+l,o,i,a,c,u);for(let l=n;l<n+i;l++)s(t,l*o+e,1,r,a,c,u)}function s(t,e,n,i,o,s,a){s[0]=0,a[0]=-r,a[1]=r,o[0]=t[e];for(let c=1,u=0,l=0;c<i;c++){o[c]=t[e+c*n];const i=c*c;do{const t=s[u];l=(o[c]-o[t]+i-t*t)/(c-t)/2}while(l<=a[u]&&--u>-1);u++,s[u]=c,a[u]=l,a[u+1]=r}for(let r=0,c=0;r<i;r++){for(;a[c+1]<r;)c++;const i=s[c],u=r-i;t[e+r*n]=o[i]+u*u}}}}]);